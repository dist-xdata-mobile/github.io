(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{431:function(s,t,a){"use strict";a.r(t);var n=a(6),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"nginx-模块学习"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-模块学习"}},[s._v("#")]),s._v(" nginx 模块学习")]),s._v(" "),a("h3",{attrs:{id:"一、通过源码构建-nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、通过源码构建-nginx"}},[s._v("#")]),s._v(" 一、通过源码构建 nginx")]),s._v(" "),a("p",[s._v("使用该 "),a("code",[s._v("configure")]),s._v(" 命令配置构建。它定义了系统的各个方面，包括允许 nginx 用于连接处理的方法。最后它创建了一个 "),a("code",[s._v("Makefile")]),s._v(" 。")]),s._v(" "),a("p",[a("code",[s._v("configure")]),s._v(" 命令支持以下参数：")]),s._v(" "),a("ul",[a("li",[s._v("--help\n打印帮助信息")]),s._v(" "),a("li",[s._v("--prefix=path\n定义了一个存储 nginx 服务文件的目录。默认"),a("code",[s._v("/usr/local/nginx")])]),s._v(" "),a("li",[s._v("--sbin-path=path\n指定了 nginx 可执行文件的名字，该名字通常在安装的时候被使用，默认名是："),a("code",[s._v("prefix/sbin/nginx")])]),s._v(" "),a("li",[s._v("--modules-path=path\n定义了 nginx 动态模块安装的目录，默认是 ："),a("code",[s._v("prefix/modules")])]),s._v(" "),a("li",[s._v("--conf-path=path\n设置 "),a("code",[s._v("nginx.conf")]),s._v(" 配置文件的名字，如果需要，nginx 可以指定不同的配置文件启动，默认是 "),a("code",[s._v("prefix/conf/nginx.conf")])]),s._v(" "),a("li",[s._v("--error-log-path=path\n设置错误、警告的日志文件路径，安装之后可以在 "),a("code",[s._v("nginx.conf")]),s._v(" 配置文件中 "),a("code",[s._v("error_log")]),s._v(" 指令可以指定错误日志路径。默认的文件是："),a("code",[s._v("prefix/logs/nginx.pid")])]),s._v(" "),a("li",[s._v("--pid-path=path\n设置 "),a("code",[s._v("nginx.pid")]),s._v(" 文件的路径，该文件将用来存储主进程的进程 id。默认"),a("code",[s._v("prefix/logs/nginx.pid")])]),s._v(" "),a("li",[s._v("--lock-path=path\n设置 lock 文件的路径，安装完成之后也可以在 "),a("code",[s._v("nginx.conf")]),s._v("中直接通过 "),a("code",[s._v("lock_file")]),s._v(" 改变 lock 文件指向的路径。默认 "),a("code",[s._v("prefix/logs/nginx.pid")])]),s._v(" "),a("li",[s._v("--user=name\n设置未授权用户的名字，这些用户可以被 "),a("code",[s._v("worker")]),s._v(" 进程所使用。安装之后，这个名字可以被 "),a("code",[s._v("nginx.conf")]),s._v(" 配置文件中 "),a("code",[s._v("user")]),s._v(" 所改变。")]),s._v(" "),a("li",[s._v("--group=name\n设置组的名字，这些组的权限将会被 "),a("code",[s._v("worker")]),s._v(" 进程所使用。安装之后，这个名字可以被 "),a("code",[s._v("nginx.conf")]),s._v(" 配置文件中 "),a("code",[s._v("user")]),s._v(" 所改变。默认情况下，组名被设置为未授权用户的名字。")]),s._v(" "),a("li",[s._v("--build=name\n设置一个可选的 nginx build 名称。")]),s._v(" "),a("li",[s._v("--builddir=path\n设置一个构建目录。")]),s._v(" "),a("li",[s._v("--with-select_module")]),s._v(" "),a("li",[s._v("--without-select_module\n模块（使服务以 "),a("code",[s._v("select()")]),s._v(" 方法启动）有效或无效。如果 nginx 运行没有出现合适的方法，诸如：kquene，epull，or /dev/poll。")]),s._v(" "),a("li",[s._v("--with-poll_module")]),s._v(" "),a("li",[s._v("--without-poll_module\n模块（使服务以 "),a("code",[s._v("poll()")]),s._v(" 方法启动）有效或无效。如果 nginx 运行没有出现合适的方法，诸如：kquene，epull。")]),s._v(" "),a("li",[s._v("--with-threads\n使线程池的使用生效")]),s._v(" "),a("li",[s._v("--with-file-aio\n基于 "),a("code",[s._v("FreeBSD and Linux")]),s._v(" 的异步 IO 生效或失效。")]),s._v(" "),a("li",[s._v("--with-http_ssl_module\n构建支持 https 的服务模块。这个模块不是默认的。运行该模块"),a("code",[s._v("OpenSSL")]),s._v(" 库是必须的。")]),s._v(" "),a("li",[s._v("--with-http_image_filter_module")]),s._v(" "),a("li",[s._v("--with-http*image_filter_module=dynamic\n允许构建以 jpeg、gif、png 和 webp 格式转换图像的 "),a("code",[s._v("ngx*-http*-image*-filter_module")]),s._v(" 。默认情况下不生成此模块。")]),s._v(" "),a("li",[s._v("--with-http_geoip_module")]),s._v(" "),a("li",[s._v("--with-http_geoip_module=dynamic\n可以构建"),a("code",[s._v("ngx_http_geoip_module")]),s._v(" 根据客户端 ip 地址来创建创建变量，并且重新编译"),a("code",[s._v("MaxMind")]),s._v(" ，这个模块默认是不被创建的。")]),s._v(" "),a("li",[s._v("--with-http_sub_module\n可以构建"),a("code",[s._v("ngx_http_sub_module")]),s._v(" 模块，该模块可以将响应中指定的字符串被另一个替换，该模块默认是不被创建的。")]),s._v(" "),a("li",[s._v("--with-http_dav_module\n构建该模块提供通过"),a("code",[s._v("WebDAV")]),s._v(" 协议实现文件自动管理，该模块默认是不被创建的。")]),s._v(" "),a("li",[s._v("--with-http_flv_module\n构建该模块对服务端的 Flash Video (FLV)提供伪视频流技术，该模块默认是不会被构建的。")]),s._v(" "),a("li",[s._v("--with-http_mp4_module\n构建该模块对服务端的 MP4 文件提供伪视频流技术，该模块默认不被构建。")]),s._v(" "),a("li",[s._v("--with-http_gunzip_module\n构建该模块可以让解压响应头带有“Content-Encoding: gzip”的文件，而不需要客户端支持“gzip”编码方法。")]),s._v(" "),a("li",[s._v("--with-http_gzip_static_module\n构建该模块能够发送“.gz”后缀的预压缩文件取代常规文件。该模块默认不被构建。")]),s._v(" "),a("li",[s._v("--with-http_auth_request_module\n支持客户端依据之前请求结果授权，该模块默认不被构建。")]),s._v(" "),a("li",[s._v("--with-http_random_index_module\nenables building the ngx_http_random_index_module module that processes requests ending with the slash character (‘/’) and picks a random file in a directory to serve as an index file. This module is not built by default.")]),s._v(" "),a("li",[s._v("--with-http_secure_link_module")]),s._v(" "),a("li",[s._v("--with-http_degradation_module\n构建"),a("code",[s._v("ngx_http_degradation_module")]),s._v(" 模块，该模块默认未被构建。")]),s._v(" "),a("li",[s._v("--with-http_slice_module\n将一个请求分为若干子请求，每个子请求返回确定范围的响应。该模块实现针对响应数据较大数据的缓存。该模块默认是不被构建的。")]),s._v(" "),a("li",[s._v("--with-http_stub_status_module\n访问基础的状态信息，默认不被构建")]),s._v(" "),a("li",[s._v("--without-http_charset_module\n使"),a("code",[s._v("ngx_http_charset_module")]),s._v(" 失效，上述模块将指定字符集添加到“Content-Type”响应头当中，可以将响应的字符集转换成另一个字符集。")]),s._v(" "),a("li",[s._v("--with-stream")]),s._v(" "),a("li",[s._v("--with-stream=dynamic\n构建该模块可以普通的 TCP/UDP 代理和负载均衡，该模块默认不被构建。")]),s._v(" "),a("li",[s._v("--with-stream_ssl_module\n添加 SSL/TLS protocol support 协议支持，默认不被构建。")]),s._v(" "),a("li",[s._v("--with-stream_geoip_module")]),s._v(" "),a("li",[s._v("--with-stream_geoip_module=dynamic")])]),s._v(" "),a("p",[s._v("demo：")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("configure "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("sbin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pid")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("with"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http_ssl_module "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("with"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("pcre"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pcre"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.43")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("with"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("zlib"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("zlib"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".11")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("with"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("openssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("openssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v("b\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("编译实战：\n1、下载 nginx 源码 nginx-release-1.16.0.tar.gz\ndownloadUrl: wget http://nginx.org/download/nginx-1.16.0.tar.gz\n2、下载 zlib 源码 zlib-1.2.11.tar.gz\ndownloadUrl: http://www.zlib.net/\n3、下载 pcre 源码 pcre-8.43.tar.gz\ndownloadUrl: https://ftp.pcre.org/pub/pcre/\n3、下载 opensll 源码 openssl-OpenSSL_1_1_1-stable.zip\ndownloadUrl: https://github.com/openssl/openssl/tree/OpenSSL_1_1_1-stable\n4、解压各文件，和 nginx 同级目录，执行下列命令：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./configure --sbin-path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx/nginx --conf-path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx/nginx.conf --pid-path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx/nginx.pid --with-http_ssl_module --with-pcre"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/pcre-8.42 --with-zlib"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/zlib-1.2.11 --with-openssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/openssl-1.1.1b\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("附 nginx 目录：\n.\n├── client_body_temp [error opening dir]\n├── fastcgi.conf\n├── fastcgi.conf.default\n├── fastcgi_params\n├── fastcgi_params.default\n├── fastcgi_temp [error opening dir]\n├── html\n│ ├── 50x.html\n│ └── index.html\n├── koi-utf\n├── koi-win\n├── logs\n│ ├── access.log\n│ └── error.log\n├── mime.types\n├── mime.types.default\n├── nginx\n├── nginx.conf\n├── nginx.conf.default\n├── nginx.pid\n├── proxy_temp [error opening dir]\n├── scgi_params\n├── scgi_params.default\n├── scgi_temp [error opening dir]\n├── uwsgi_params\n├── uwsgi_params.default\n├── uwsgi_temp [error opening dir]\n└── win-utf")]),s._v(" "),a("h3",{attrs:{id:"一、使用者手册"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、使用者手册"}},[s._v("#")]),s._v(" 一、使用者手册")]),s._v(" "),a("p",[s._v("该手册对 nginx 作简要介绍，并描述了 nginx 可以做的任务，使用该手册的前提是读者已在 pc 安装了 nginx。如果没有，请查看安装 nginx 页面。这个手册描述了如何启动和关闭 nginx、如何重新加载配置、描述其配置文件的配置文件架构、描述设置静态服务器的配置、如何配置代理服务、如何用"),a("code",[s._v("FastCGI application")]),s._v(" 来连接。\nnginx 有一个 "),a("code",[s._v("master")]),s._v(" 集成和多个\n"),a("code",[s._v("worker")]),s._v(" 进程。"),a("code",[s._v("master")]),s._v(" 主要作用是读取和解析配置以及维持"),a("code",[s._v("worker")]),s._v(" 进程。"),a("code",[s._v("worker")]),s._v(" 进程是处理真实的请求进程。nginx 依赖事件驱动模型（event-based）和操作系统来高效地分发请求到"),a("code",[s._v("worker")]),s._v(" 进程中。"),a("code",[s._v("worker")]),s._v(" 进程地数量被定义在配置文件中，可以通过调整 cpu 核心的数量来修改（详见"),a("code",[s._v("worker_processes")]),s._v("）。\n默认，配置文件名"),a("code",[s._v("nginx.conf")]),s._v(" ，被放置在\n"),a("code",[s._v("/usr/local/nginx/conf")]),s._v(", "),a("code",[s._v("/etc/nginx")]),s._v(", or "),a("code",[s._v("/usr/local/etc/nginx")]),s._v(" 。")]),s._v(" "),a("h4",{attrs:{id:"启动、关闭、重新加载配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动、关闭、重新加载配置"}},[s._v("#")]),s._v(" 启动、关闭、重新加载配置")]),s._v(" "),a("p",[s._v("直接通过可执行文件启动 nginx。一旦启动，就可以通过可执行文件传参 "),a("code",[s._v("-s")]),s._v(" 的方式来控制 nginx。使用语法如下：")]),s._v(" "),a("blockquote",[a("p",[s._v("nginx -s signal")])]),s._v(" "),a("p",[s._v("signal，有如下参数：")]),s._v(" "),a("ul",[a("li",[s._v("stop - 快速关闭")]),s._v(" "),a("li",[s._v("quit - 优雅关闭")]),s._v(" "),a("li",[s._v("reload - 加载配置文件")]),s._v(" "),a("li",[s._v("reopen - 重新打开日志文件\n例如，停止 nginx 进程，要等待"),a("code",[s._v("worker")]),s._v(" 进程完成当前的请求，可以使用如下命令：")])]),s._v(" "),a("blockquote",[a("p",[s._v("nginx -s quit\n注意：该命令执行应该使用开启该 nginx 的用户。")])]),s._v(" "),a("p",[s._v("配置文件的改变只能通过 nginx 重新加载配置或重启 nginx 生效。重新加载配置，执行如下：")]),s._v(" "),a("blockquote",[a("p",[s._v("nginx -s reload")])]),s._v(" "),a("p",[s._v("一旦"),a("code",[s._v("master")]),s._v(" 进程接收到了重新加载配置的信号，它会校验配置文件语法，并尝试去应用配置。如果配置成功，"),a("code",[s._v("master")]),s._v(" 会创建新的"),a("code",[s._v("worker")]),s._v(" 并通知旧的"),a("code",[s._v("worker")]),s._v(" 进程去关闭。否则，"),a("code",[s._v("master")]),s._v(" 进程会回滚当前的改变到历史配置，继续使用旧的配置。旧"),a("code",[s._v("worker")]),s._v(" 进程接收到命令去关闭，会停止接收新的请求并将现有的请求处理完成后，才完成退出动作。")]),s._v(" "),a("p",[s._v("使用 Unix 的工具 kill 工具信号也可以发给 nginx 进程。这种情况，带有进程 id 的信号直接发送给一个进程。这个进程 id 是被 nginx "),a("code",[s._v("master")]),s._v("进程所重写，默认情况下 "),a("code",[s._v("nginx.pid")]),s._v(" 在目录\n"),a("code",[s._v("/usr/local/nginx/logs")]),s._v(" 或者 "),a("code",[s._v("/var/run")]),s._v("。例如，如果 master 进程 id 是 1628，发送退出信号去优雅地关闭 nginx，可执行：")]),s._v(" "),a("blockquote",[a("p",[s._v("kill -s QUIT 1628")])]),s._v(" "),a("p",[s._v("为了获取 nginx 进程 id 地列表，"),a("code",[s._v("ps")]),s._v(" 工具被使用，例如：")]),s._v(" "),a("blockquote",[a("p",[s._v("ps -ax | grep nginx")])]),s._v(" "),a("p",[s._v("更多信号发送到 nginx，详看"),a("code",[s._v("Controlling nginx")])]),s._v(" "),a("h4",{attrs:{id:"配置文件结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件结构"}},[s._v("#")]),s._v(" 配置文件结构")]),s._v(" "),a("p",[s._v("nginx 包含很多模块，而这些模块是在配置文件中被特定地指令所控制。指令包括简单指令和指令块。一个简单地指令包含被空格分隔的名字和参数，以分号(;)结尾。指令块有和简单指令一样的结构，除了没有分号结尾以及额外的指令被花括号所包括({ and })。如果指令块在指令中有其他指令，则称之为上下文(例如 events, http, server, 和 location)。\n指令被放置到所有 context 是被当作在"),a("code",[s._v("main")]),s._v(" 上下文中。"),a("code",[s._v("events")]),s._v(" 和"),a("code",[s._v("http")]),s._v(" 指令是在"),a("code",[s._v("main")]),s._v(" 上下文中，"),a("code",[s._v("server")]),s._v(" 指令在"),a("code",[s._v("http")]),s._v(" 上下文中，"),a("code",[s._v("location")]),s._v(" 在"),a("code",[s._v("server")]),s._v(" 上下文中。剩下的一行"),a("code",[s._v("#")]),s._v(" 注释。")]),s._v(" "),a("h4",{attrs:{id:"静态资源服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#静态资源服务"}},[s._v("#")]),s._v(" 静态资源服务")]),s._v(" "),a("p",[s._v("web 服务器最重要的一个任务就是发布一个文件服务（像图片或者静态 html 文件）。你能够实现将本地文件映射到网络 url，可以直接通过请求访问文件。下面的示例是要实现"),a("code",[s._v("/data/www")]),s._v(" (存放 html 静态资源) 和 "),a("code",[s._v("/data/images")]),s._v(" (包含图片)，这需要编辑配置文件，在 http 指令块下 server 指令块下 添加两个 location 指令块。。\n首先创建 "),a("code",[s._v("/data/www")]),s._v(" 目录，然后放一个 html 文件，然后再在"),a("code",[s._v("/data/images")]),s._v(" 文件夹下放置些图片供测试。\n接下来，打开配置文件，默认的配置已经包含了几个 "),a("code",[s._v("server")]),s._v(" 块的示例，将注释打开创建一个新的"),a("code",[s._v("server")]),s._v(" 指令块。")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("通常这个配置文件会包含多个"),a("code",[s._v("server")]),s._v(" 块，而这些"),a("code",[s._v("server")]),s._v(" 是通过它们监听的端口和服务名称来加以区分。一旦 nginx 确定哪一个"),a("code",[s._v("server")]),s._v(" 处理请求，它会测试请求头中的参数和"),a("code",[s._v("location")]),s._v(" 中配置的"),a("code",[s._v("server")]),s._v(" 中定义是否匹配。\n添加"),a("code",[s._v("location")]),s._v("块到"),a("code",[s._v("server")]),s._v(" 块当中。")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("这个"),a("code",[s._v("locaiton")]),s._v(" 块定义了“/”前缀和请求的 URI 做匹配。对于匹配的请求，这个 URI 将会被添加到"),a("code",[s._v("root")]),s._v("指令中重定向路径的后面，上述 demo 即是转向 "),a("code",[s._v("/data/www")]),s._v(" ，以形成本地文件系统上所请求的路径。如果匹配多个 location 块，则 nginx 选择具有最长前缀的块。location 上面提供长度为 1 的最短前缀，因此只有当所有其他 location 块都无法提供匹配时，才会使用此块。")]),s._v(" "),a("p",[s._v("接下来添加第二个 "),a("code",[s._v("location")]),s._v(" 块")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("它将会匹配以"),a("code",[s._v("/images/")]),s._v(" 开头的请求路径（location"),a("code",[s._v("/")]),s._v(" 也能匹配上，但是匹配前缀更短）。")]),s._v(" "),a("p",[s._v("而最终的"),a("code",[s._v("server")]),s._v(" 块的配置如下：")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("上述已经运行的配置监听 80 端口，可以铜鼓"),a("code",[s._v("http://localhost/")]),s._v("加以访问。为了响应 url 以"),a("code",[s._v("/images/")]),s._v(" 开头的请求，nginx 服务端将会发送"),a("code",[s._v("/data/images")]),s._v(" 目录下的文件。例如为了响应"),a("code",[s._v("http://localhost/images/example.png")]),s._v("，nginx 会发送"),a("code",[s._v("/data/images/example.png")]),s._v("文件。如果这个文件不存在，就会返回 404 错误。以"),a("code",[s._v("/images/")]),s._v(" 开头的 URIs 路径将会映射到"),a("code",[s._v("/data/www")]),s._v("目录下。为了响应请求"),a("code",[s._v("http://localhost/some/example.html")]),s._v("， nginx 将会发送"),a("code",[s._v("/data/www/some/example.html")]),s._v("文件。为了使新的配置生效，需要发送"),a("code",[s._v("reload")]),s._v("信号到 nginx 的 master 进程。通过执行：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("nginx -s reload\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果加载出现了问题，你可以在"),a("code",[s._v("access.log")]),s._v("和"),a("code",[s._v("error.log")]),s._v("中查找问题。文件路径"),a("code",[s._v("/usr/local/nginx/logs")]),s._v(" 或 "),a("code",[s._v("/var/log/nginx")]),s._v("。")]),s._v(" "),a("h4",{attrs:{id:"设置一个简单的代理服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置一个简单的代理服务"}},[s._v("#")]),s._v(" 设置一个简单的代理服务")]),s._v(" "),a("p",[s._v("代理服务是 nginx 最常使用的一个功能，就是意味着 nginx 作为一个服务器接收请求，让他们去访问被代理的服务器，从被代理的服务器检索响应，并将他们转发到客户端。\n我们将会配置一个基础的代理服务，请求的图片文件都来自于本地目录，其他请求发送到一个被代理的服务器。在这个例子中，两个服务都会被定义到一个简单的 nginx 实例中。\n首先，通过添加一个或多个"),a("code",[s._v("server")]),s._v("块来定义被代理的服务。")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("up1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("上述配置监听 8080 端口，并且映射所有请求到"),a("code",[s._v("/data/up1")]),s._v("目录。创建这个目录，并把"),a("code",[s._v("index.html")]),s._v("文件放进去。注意"),a("code",[s._v("root")]),s._v(" 指令需要放置到"),a("code",[s._v("location")]),s._v("块中。这个"),a("code",[s._v("root")]),s._v("生效要求"),a("code",[s._v("location")]),s._v("块被选择，并且"),a("code",[s._v("location")]),s._v("块中没有"),a("code",[s._v("root")]),s._v("指令。")]),s._v(" "),a("p",[s._v("接下来使用来自现在的配置，修改它作为一个代理服务器。在第一个 location 块，配置"),a("code",[s._v("proxy_pass")]),s._v("指令，参数配置协议、名称、端口以及被代理的服务。")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("我们将修改第二个"),a("code",[s._v("location")]),s._v("块，它将会映射请求以"),a("code",[s._v("/images/")]),s._v("开头的请求到本地磁盘"),a("code",[s._v("/data/images")]),s._v(" 目录下，为了使之匹配图片资源，可配置如下：")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" \\"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gif"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpg"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("这个参数正则匹配所有以"),a("code",[s._v(".gif")]),s._v("、"),a("code",[s._v(".jpg")]),s._v("或者 "),a("code",[s._v(".png结尾的")]),s._v("URIs。一个正则表达式应该以"),a("code",[s._v("~")]),s._v("开头，该请求将会被映射到目录"),a("code",[s._v("/data/images")]),s._v("下。\n当 nginx 选择了一个"),a("code",[s._v("location")]),s._v("块来服务一个请求，首先它会校验"),a("code",[s._v("location")]),s._v("指令指定的前缀，记住"),a("code",[s._v("location")]),s._v("指令匹配最长路径，然后校验正则。如果匹配到了正则，nginx 将会挑选该"),a("code",[s._v("location")]),s._v("块，否则会选择之前记下来的模块。\n最终的配置如下：")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" \\"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gif"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpg"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("启动 FastCGI 代理\nnginx 也经常被使用路由请求到"),a("code",[s._v("FastCGI")]),s._v("服务器，"),a("code",[s._v("FastCGI")]),s._v("服务器可以运行多种框架和编程语言，比如"),a("code",[s._v("PHP")]),s._v("。\n最基础简单的配置，使用"),a("code",[s._v("fastcgi_pass")]),s._v("取代"),a("code",[s._v("proxy_pass")]),s._v("，改变参数到 9000。在 php 中，"),a("code",[s._v("SCRIPT_FILENAME")]),s._v("被使用决定脚本名称，"),a("code",[s._v("QUERY_STRING")]),s._v("设置请求参数，结果配置如下：")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fastcgi_pass")]),s._v("  localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fastcgi_param")]),s._v(" SCRIPT_FILENAME "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$document_root")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$fastcgi_script_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fastcgi_param")]),s._v(" QUERY_STRING    "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$query_string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" \\"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("gif"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("jpg"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("png"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("images"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);