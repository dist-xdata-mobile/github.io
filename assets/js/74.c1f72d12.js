(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{461:function(t,e,s){"use strict";s.r(e);var a=s(6),_=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"数据库计算应用-postgresql-postgis"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据库计算应用-postgresql-postgis"}},[t._v("#")]),t._v(" 数据库计算应用-PostgreSQL,PostGIS")]),t._v(" "),s("blockquote",[s("p",[t._v("作者:胡飞玲 时间： 2020-10-16")])]),t._v(" "),s("h2",{attrs:{id:"_1-postegresql-postgis-介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-postegresql-postgis-介绍"}},[t._v("#")]),t._v(" 1. PostegreSQL ,PostGIS 介绍")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("PostgreSQL 介绍")]),t._v(" "),s("p",[t._v("1）开源数据库系统，从加州大学伯克利分校写的 POSTGRES 软件包发展而来的。有二十多年的历史。")]),t._v(" "),s("p",[t._v("2）PostgreSQL 是由一个由众多开发人员和公司组成的全球社区来开发它。")]),t._v(" "),s("p",[t._v("3）支持所有主流操作系统，包括 Linux、Unix（AIX、BSD、HP-UX、SGI IRIX、Mac OS X、Solaris 和 Tru64）和 Windows")]),t._v(" "),s("p",[t._v("4）支持 2008 标准的数据类型，包括整型、数值型、布尔型、字节型、字符型、日期型、时间间隔型和时间型，它也支持存储二进制的大对像，包括图片、声音和视频")]),t._v(" "),s("p",[t._v("5）高级开发语言有原生的编程接口，如 C/C++、Java、.Net、Perl、Python、Ruby、Tcl 和 ODBC 以及其他语言等")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/8d57c2498dce1ae4ea78e946fde4cad4/image-20200812112753071.png",alt:"image-20200812112753071"}})]),t._v(" "),s("p",[t._v("PostgreSQL 的特点：")]),t._v(" "),s("ul",[s("li",[t._v("被证明的默认情况下的强大的"),s("strong",[t._v("可靠性")]),t._v("和"),s("strong",[t._v("事务完整性")]),t._v("（ACID）")]),t._v(" "),s("li",[t._v("严谨地支持"),s("strong",[t._v("SQL 标准")]),t._v("（完整 SQL92)")]),t._v(" "),s("li",[t._v("可插、拔的"),s("strong",[t._v("类型扩展")]),t._v("和"),s("strong",[t._v("功能扩展")])]),t._v(" "),s("li",[t._v("面向社区的发展模式（开源）")]),t._v(" "),s("li",[t._v("不限制列大小（可用"),s("strong",[t._v("元组")]),t._v("）以支持大型 GIS 对象")]),t._v(" "),s("li",[t._v("通用索引结构（Generic Index Structure - GIST）允许"),s("strong",[t._v("R-Tree 索引")])]),t._v(" "),s("li",[t._v("易于添加自定义功能")])])]),t._v(" "),s("li",[s("p",[t._v("PostGIS 介绍")]),t._v(" "),s("p",[t._v("PostGIS 是对象关系型数据库 PostgreSQL 的一个插件，通过向 PostgreSQL 添加对"),s("strong",[t._v("空间数据类型")]),t._v("、"),s("strong",[t._v("空间索引")]),t._v("和"),s("strong",[t._v("空间函数")]),t._v("的支持，将 PostgreSQL 数据库管理系统转换为"),s("strong",[t._v("空间数据库")]),t._v("。")]),t._v(" "),s("p",[t._v("PostGIS 遵循 OpenGIS 的规范,是最著名的开源 GIS 数据库。")]),t._v(" "),s("p",[s("strong",[t._v("需要 PostgreSQL9.1 以上版本才支持 PostGIS.")])]),t._v(" "),s("p",[s("strong",[t._v("PostGIS 能做的事情：")])]),t._v(" "),s("p",[t._v("1.空间数据存储 2.空间数据输出 3.空间数据访问 4.空间数据编辑 5.空间数据处理 6.空间数据关系判断和测量 7.空间拓扑实现")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/23d5e74731e90270e880b17560c1e7c2/image-20200812132421130.png",alt:"image-20200812132421130"}})])])]),t._v(" "),s("h2",{attrs:{id:"_2-postgresql，postgis-版本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-postgresql，postgis-版本"}},[t._v("#")]),t._v(" 2. PostgreSQL，PostGIS 版本")]),t._v(" "),s("p",[s("strong",[t._v("PostgreSQL 版本：")])]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/fba7db397e7f5534463372d2f0305ef6/image-20200812113641096.png",alt:"image-20200812113641096"}}),t._v(" "),s("p",[s("strong",[t._v("PostgreGIS 版本：")])]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/987c3de72beec6e71bef4ab5b5f94af5/image-20200812144417776.png",alt:"image-20200812144417776"}}),t._v(" "),s("p",[s("strong",[t._v("PostgreSQL 与 PostgreGIS 版本对应关系：")])]),t._v(" "),s("p",[s("img",{attrs:{src:"images%5Cimage-20200812145748515.png",alt:"image-20200812145748515"}})]),t._v(" "),s("p",[s("strong",[t._v("Arcgis 与 PostgreSQL 支持版本")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("ArcGIS")]),t._v(" "),s("th",[t._v("PostgreSQL(PostGIS) 64 位")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("ArcGIS 10.8.x")]),t._v(" "),s("td",[t._v("11.5(postgis 2.5.1) \\ 10.10(postgis2.4) \\ 9.6.15( postgis2.3)")])]),t._v(" "),s("tr",[s("td",[t._v("ArcGIS 10.7.x")]),t._v(" "),s("td",[t._v("11.2*( postgis2.5.1*) \\ 10.7(postgis2.4) \\ 9.6.12(postgis 2.3) \\ 9.5.12( postgis2.2*)")])]),t._v(" "),s("tr",[s("td",[t._v("ArcGIS 10.6.x")]),t._v(" "),s("td",[t._v("10.3( postgis2.4) \\ 9.6.8(postgis2.3) \\ 9.5.12( postgis2.2) \\ 9.4.8( postgis2.2)")])]),t._v(" "),s("tr",[s("td",[t._v("ArcGIS 10.5.x")]),t._v(" "),s("td",[t._v("9.5.3( postgis2.2) \\ 9.4.8(postgis2.2) \\ 9.3.13( postgis2.2)")])]),t._v(" "),s("tr",[s("td",[t._v("ArcGIS 10.4.x")]),t._v(" "),s("td",[t._v("9.4.5(postgis 2.2) \\ 9.3.10(postgis2.2) \\ 9.2.14( postgis2.1)")])]),t._v(" "),s("tr",[s("td",[t._v("ArcGIS 10.3.x")]),t._v(" "),s("td",[t._v("9.3.5(postgis 2.1) \\ 9.2.9(postgis2.0) \\ 9.1.14( postgis2.0)")])]),t._v(" "),s("tr",[s("td",[t._v("ArcGIS 10.2.x")]),t._v(" "),s("td",[t._v("9.2.2( postgis2.0) \\ 9.1.3(postgis2.0) \\ 9.0.5(postgis1.5.1)")])]),t._v(" "),s("tr",[s("td",[t._v("ArcGIS 10.1.x")]),t._v(" "),s("td",[t._v("9.1.3( postgis2.0*) \\ 9.0.5(postgis1.5.1)")])])])]),t._v(" "),s("p",[s("strong",[t._v("SuperMap 与 PostgreSQL 支持版本")])]),t._v(" "),s("p",[t._v("SuperMap SDX+ for PostgreSQL 对 PostgreSQL 8.2 版本不支持，建议安装 8.3 及以上版本。")]),t._v(" "),s("h2",{attrs:{id:"_3-postegresql-postgis-安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-postegresql-postgis-安装"}},[t._v("#")]),t._v(" 3. PostegreSQL ,PostGIS 安装")]),t._v(" "),s("p",[t._v("PostgreSQL 下载：https://www.enterprisedb.com/downloads/postgres-postgresql-downloads")]),t._v(" "),s("p",[t._v("PostGIS 下载： http://download.osgeo.org/postgis/windows/")]),t._v(" "),s("p",[t._v("PostgreSQL 安装：")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("安装很简单，直接下一步下一步就可以。不同版本中不太一样，如 10 版本可以选择安装")])]),t._v(" "),s("li",[s("p",[t._v("其中有一步要设置系统管理员（postgres）登录密码。数据库端口")]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/85ff4dedaf8180124fa4d36b9ffa12db/image-20200812164242605.png",alt:"image-20200812164242605"}}),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/d06940f20369eaf488a8c6d7a2c2b3fd/image-20200813093431136.png",alt:"image-20200813093431136"}})]),t._v(" "),s("li",[s("p",[t._v("语言")]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/89fb5831c2460c3b88cf137cd63fb03c/image-20200813093524386.png",alt:"image-20200813093524386"}})]),t._v(" "),s("li",[s("p",[t._v("如果是更高版本会带有 pgadmin 的安装选项，9.6 没有。")])]),t._v(" "),s("li",[s("p",[t._v("安装完成后选中复选框再按完成，则会立即运行 Application Stack Builder，可用于下载和安装附加的工具、驱动程序和应用程序如 PostGIS。")]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/363571277d58e58c46b6bfa5939d1ee7/image-20200812164437364.png",alt:"image-20200812164437364"}})])]),t._v(" "),s("p",[s("strong",[t._v("PostGIS 安装：")])]),t._v(" "),s("ol",[s("li",[s("p",[t._v("如上步中 Stack Builder 运行后，选择安装目标软件为 PostgreSQL 9.6 on port 5432。然后在安装程序选择对话框中选择 PostGIS 2.3。")]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/c0c6e9c0072d08a50f8106ab10cec772/image-20200812165207270.png",alt:"image-20200812165207270"}}),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/c8be26796e76ac72ccbe2730fddf23e4/image-20200812165228334.png",alt:"image-20200812165228334"}})]),t._v(" "),s("li",[s("p",[t._v('勾选以后 Stack Builder 会下载 PostGIS 2.3 的安装程序。下载后就会安装，在设置安装组件时，最好选择"'),s("strong",[t._v("Create spatial database")]),t._v('"，以便在创建数据库时可以以此作为模板。对于其他步骤的设置都选择默认值即可')])])]),t._v(" "),s("p",[t._v("如果上步安装不成功，则需要单独下载 postgis 安装包")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("如果要创建空间库，要以管理员运行安装包。会默认选中安装 postgresql 安装目录下")]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/aa520f9814b48f3db75be0a5a9ad6ec4/image-20200813103952139.png",alt:"image-20200813103952139"}})]),t._v(" "),s("li",[s("p",[t._v("输入 postgresql 系统管理员密码")]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/3d687e5c4fc26481e66b7185d4592a01/image-20200813104045852.png",alt:"image-20200813104045852"}})]),t._v(" "),s("li",[s("p",[t._v("如果勾选了自动创建空间库，后续填写空间名称")])])]),t._v(" "),s("h2",{attrs:{id:"_4-postgresql-客户端工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-postgresql-客户端工具"}},[t._v("#")]),t._v(" 4. PostgreSQL 客户端工具")]),t._v(" "),s("p",[t._v("用户普遍会使用 pgAdmin 来启动 PostgreSQL。它具有强大的社区支持和丰富的资源。")]),t._v(" "),s("p",[t._v("追求更好的 UI、以及可视化的编辑器，那么 DBeaver 和 OmniDB 作为开源的解决方案，会是您的理想选择。")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("pgAdmin(https://www.pgadmin.org/)")]),t._v(" "),s("strong",[t._v("免费且开源")])]),t._v(" "),s("p",[t._v("pgAdmin 是首款 PostgreSQL GUI 工具。，目前最新版本 4.24。有 Windows、Linux 和 Mac OS 版本")]),t._v(" "),s("p",[s("strong",[t._v("优点：")])]),t._v(" "),s("ul",[s("li",[t._v("可以对所有常见的 PostgreSQL 对象进行创建、查看和编辑。")]),t._v(" "),s("li",[t._v("提供具有语法高亮显示功能的图形化查询与计划任务。")]),t._v(" "),s("li",[t._v("其仪表板可以让您监视到包括：数据库锁、已连接的会话、就绪的事务在内的各项服务器活动。")]),t._v(" "),s("li",[t._v("由于"),s("strong",[t._v("pgAdmin 是一个 Web 应用，因此您可以将其部署到任何服务器上，并远程访问它")]),t._v("。")]),t._v(" "),s("li",[t._v("pgAdmin UI 提供各种可拆分的面板，您可以根据自己的喜好进行重排。")]),t._v(" "),s("li",[t._v("其程序语言调试器可以帮助您调试代码。")]),t._v(" "),s("li",[t._v("pgAdmin 的可移植版本，可以让用户轻松地在机器之间移动数据。")])]),t._v(" "),s("p",[s("strong",[t._v("缺点：")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("与其他付费版 GUI 工具相比，其 UI 较为缓慢、且不直观。")])]),t._v(" "),s("li",[s("p",[t._v("pgAdmin 比较消耗系统资源。")])])])])]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[s("p",[s("strong",[t._v("DBeaver(https://dbeaver.io/)")])]),t._v(" "),s("p",[t._v("跨平台 PostgreSQL GUI 工具，有免费和企业两个版本。免费版比 pgadmin 好用")]),t._v(" "),s("p",[t._v("支持所有流行的数据库，包括：MySQL、MariaDB、Sybase、SQLite、Oracle、SQL Server、DB2、MS Access、Firebird、Teradata、以及 Derby。")]),t._v(" "),s("p",[s("strong",[t._v("优点：")])]),t._v(" "),s("ul",[s("li",[t._v("可视化的查询构建器可以帮助您，在无需掌握过多 SQL 相关知识的情况下，构建出复杂的 SQL 查询。")]),t._v(" "),s("li",[t._v("可以使用多种数据视图，来支持不同的用户需求。")]),t._v(" "),s("li",[t._v("提供方便的数据导航。")]),t._v(" "),s("li",[t._v("在 DBeaver 中，您可以生成近似于真实的伪数据，以用于测试系统。")]),t._v(" "),s("li",[t._v("提供针对所有选定表和视图的全文数据搜索，能将搜索结果显示为已过滤的表和视图。")]),t._v(" "),s("li",[t._v("能够在各个数据库系统表中，进行行间元数据的搜索。")]),t._v(" "),s("li",[t._v("可导入、导出为 CSV、HTML、XML、JSON、XLS、XLSX 等多种文件格式的数据。")]),t._v(" "),s("li",[t._v("通过将密码存储在受主密码保护的存储区域中，以提高数据库的安全性。")]),t._v(" "),s("li",[t._v("能够自动为数据库及其机构模式生成 ER 图。")]),t._v(" "),s("li",[t._v("其企业版提供了特殊的在线支持系统。")])]),t._v(" "),s("p",[s("strong",[t._v("缺点：")])]),t._v(" "),s("ul",[s("li",[t._v("与一些昂贵的 GUI 工具(例如 Navicat 和 DataGrip)相比，它在处理大型数据集时，可能会比较慢。")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("OmniDB(https://omnidb.org/en/downloads-en)")])]),t._v(" "),s("p",[t._v("与 pgAdmin 和 DBeaver 相比，OmniDB 缺乏社区的支持")]),t._v(" "),s("p",[t._v("OmniDB 的功能不及 Navicat 和 DataGrip 的付费版那样丰富。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("Navicat(https://www.navicat.com/en/products/navicat-for-postgresql) 收费")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("DataGrip(http://jetbrains.com/datagrip/) 收费")])]),t._v(" "),s("p",[t._v("DataGrip 支持包括：SQL Server、MySQL、Oracle、SQLite、Azure 数据库、DB2、H2、MariaDB、Cassandra、HyperSQL、以及 Apache Derby 在内的各种大量数据库管理系统。DataGrip 也支持 Windows、Linux 和 Mac OS，三大主要操作系统。")])])]),t._v(" "),s("h2",{attrs:{id:"_5-postgresql-基础概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-postgresql-基础概念"}},[t._v("#")]),t._v(" 5. PostgreSQL 基础概念")]),t._v(" "),s("h3",{attrs:{id:"_5-1-逻辑结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-逻辑结构"}},[t._v("#")]),t._v(" 5.1 逻辑结构")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/3ca7589b492e85dcadb759ea2e57a7cc/image-20200813155501247.png",alt:"image-20200813155501247"}}),t._v(" "),s("p",[t._v("最上层是实例，实例中允许创建多个数据库，每个数据库中可以创建多个 schema，每个 schema 下面可以创建多个对象。对象包括表、物化视图、操作符、索引、视图、序列、函数、... 等等。")]),t._v(" "),s("p",[t._v("表空间，用户，角色不在这个结构里面；是独立之外的 object")]),t._v(" "),s("h4",{attrs:{id:"_5-1-1-表空间"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-1-表空间"}},[t._v("#")]),t._v(" 5.1.1 表空间")]),t._v(" "),s("p",[t._v("在 PostgreSQL 中，表空间是一个目录，里面存储的是它所包含的数据库的各种物理文件。")]),t._v(" "),s("p",[s("strong",[t._v("表空间的作用")]),t._v(":")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("控制控制磁盘的布局")]),t._v(" "),s("p",[t._v("比如将表空间创建在服务器的不同分区，如果初始化集群所在分区已经用光，可以方便的其他分区上创建表空间已达到扩容的目的。")])]),t._v(" "),s("li",[s("p",[t._v("优化性能")]),t._v(" "),s("p",[t._v("比如不太常用的表可以建立在便宜的硬盘上，如用来存储用于进行归档文件的表")]),t._v(" "),s("p",[t._v("对于频繁访问的数据可以存储在性能较高、较快的磁盘分区")])])]),t._v(" "),s("p",[s("strong",[t._v("官方建议：一个表空间中不要存储多个数据库")])]),t._v(" "),s("h4",{attrs:{id:"_5-1-2-用户-角色"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-2-用户-角色"}},[t._v("#")]),t._v(" 5.1.2 用户/角色")]),t._v(" "),s("p",[t._v("PostgreSQL 里没有区分用户和角色，在 PostgreSQL 两者区别仅在于用户比角色多了登陆权限。如果给角色赋予了登陆的权限，两者就一样了。")]),t._v(" "),s("p",[t._v("用以下 sql 语句创建的，是没有权限")]),t._v(" "),s("p",[s("code",[t._v("CREATE ROLE roletest PASSWORD 'pass';")])]),t._v(" "),s("p",[s("code",[t._v("CREATE User usertest PASSWORD 'pass';")])]),t._v(" "),s("p",[t._v("等同于用户的角色创建："),s("code",[t._v("CREATE ROLE kanon PASSWORD 'kanon' LOGIN;")])]),t._v(" "),s("h4",{attrs:{id:"_5-1-3-数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-3-数据库"}},[t._v("#")]),t._v(" 5.1.3 数据库")]),t._v(" "),s("p",[t._v("在 PostgreSQL 中，数据库的创建是通过克隆数据库模板来实现的，这与 SQL SERVER 是同样的机制。")]),t._v(" "),s("p",[s("strong",[t._v("新建的数据库对所有的用户都有连接权限,还可以在对应的 public-schema 下可以创建 object；不管是不是超级用户、属主用户；这样很不安全，要实现隔离,我们可以回收数据库权限；只有超级用户、属主用户可以连。")])]),t._v(" "),s("div",{staticClass:"language-plain line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("revoke CONNECT ON DATABASE db1 from public;\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h4",{attrs:{id:"_5-1-4-模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-4-模式"}},[t._v("#")]),t._v(" 5.1.4 模式")]),t._v(" "),s("p",[t._v("模式（schema）是对数据库（database）逻辑分割，类似数据集概念")]),t._v(" "),s("p",[t._v("**模式作用：**将不同的模式指派该不同的角色，可以实现权限分离，又可以通过授权，实现模式间对象的共享，而 public 模式可以存储大家都需要访问的对象。")]),t._v(" "),s("p",[s("strong",[t._v("模式特点：")])]),t._v(" "),s("ul",[s("li",[t._v("每创建一个数据库，会默认创建一个模式--public")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("数据库中一个对象的完整名称为 SCHEMA.object")])]),t._v(" "),s("li",[s("p",[t._v("通过 DATABASE 的 search_path 来确定 SCHEMA 的搜索顺序")]),t._v(" "),s("p",[t._v("查看当前数据库搜索路径(sql 语句):")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("SHOW search_path;\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("设置新的搜索路径(sql 语句):")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('SET search_path TO "$user", public;\n')])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("默认每个人都在 public 模式上有 CREATE 权限，所以连接到数据库上的用户都可以在 public 创建对象。\n这个权限可以撤销："),s("code",[t._v("REVOKE CREATE ON public FROM PUBLIC;")])]),t._v(" "),s("p",[t._v("第一个 public 是 SCHEMA，第二个 PUBLIC 是指所有用户。")])])]),t._v(" "),s("p",[s("strong",[t._v("官方建议")]),t._v("："),s("strong",[t._v('在管理员创建一个具体数据库后，应该为所有可以连接到该数据库的用户分别创建一个与用户名相同的模式，然后，将 search_path 设置为"$user"， 这样，任何当某个用户连接上来后，会默认将查找或者定义的对象都定位到与之同名的模式中。这是一个好的设计架构。')])]),t._v(" "),s("h4",{attrs:{id:"_5-1-5-数据库对象"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-5-数据库对象"}},[t._v("#")]),t._v(" 5.1.5 数据库对象")]),t._v(" "),s("p",[t._v("包括表、物化视图、操作符、索引、视图、序列、函数")]),t._v(" "),s("ul",[s("li")]),t._v(" "),s("h3",{attrs:{id:"_5-3-权限体系"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-权限体系"}},[t._v("#")]),t._v(" 5.3 权限体系")]),t._v(" "),s("p",[t._v("在数据库中所有的权限都和角色（用户）挂钩，public 是一个特殊角色，代表所有人。\n超级用户是有允许任意操作对象的，普通用户只能操作自己创建的对象。\n另外有一些对象是有赋予给 public 角色默认权限的，所以建好之后，所以人都有这些默认权限。")]),t._v(" "),s("img",{staticStyle:{zoom:"30%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/e3c6fa49aa90d01783404787b0c4b9cb/image-20200813171501018.png",alt:"image-20200813171501018"}}),t._v(" "),s("ol",[s("li",[s("p",[t._v("实例级别的权限由 pg_hba.conf 来控制")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('# TYPE  DATABASE        USER            ADDRESS                 METHOD\n# "local" is for Unix domain socket connections only\nlocal   all             all                                     trust\n# IPv4 local connections:\nhost    all             all             127.0.0.1/32            trust\nhost all postgres 0.0.0.0/0 reject\nhost all all 0.0.0.0/0 md5\n')])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("p",[t._v("允许任何本地用户无密码连接任何数据库\n不允许 postgres 用户从任何外部地址连接任何数据库\n允许其他任何用户从外部地址通过密码连接任何数据库")])]),t._v(" "),s("li",[s("p",[t._v("数据库权限")]),t._v(" "),s("p",[t._v("数据库级别的权限，包括允许连接数据库，允许在数据库中创建 schema。\n默认情况下，数据库在创建后，允许 public 角色连接，即允许任何人连接。\n默认情况下，数据库在创建后，不允许除了超级用户和 owner 之外的任何人在数据库中创建 schema。\n默认情况下，数据库在创建后，会自动创建名为 public 的 schema，这个 schema 的 all 权限已经赋予给 public 角色，即允许任何人在里面创建对象。")])]),t._v(" "),s("li",[s("p",[t._v("模式权限")]),t._v(" "),s("p",[t._v("schema 级别的权限，包括允许查看 schema 中的对象，允许在 schema 中创建对象。\n默认情况下新建的 schema 的权限不会赋予给 public 角色，因此除了超级用户和 owner，任何人都没有权限查看 schema 中的对象或者在 schema 中新建对象。")]),t._v(" "),s("p",[t._v("注意：不要把自己的对象创建到别人的 schema 下面")])]),t._v(" "),s("li",[s("p",[t._v("数据库对象权限")]),t._v(" "),s("p",[t._v("对象级别的权限，每种类型的对象权限属性都不一样")]),t._v(" "),s("p",[t._v("以表为例，有 SELECT | INSERT | UPDATE | DELETE | TRUNCATE | REFERENCES | TRIGGER 这些权限。")]),t._v(" "),s("p",[t._v("其他具体参考：https://www.postgresql.org/docs/9.5/sql-grant.html")])]),t._v(" "),s("li",[s("p",[t._v("表空间权限")])]),t._v(" "),s("li",[s("p",[t._v("如何查看对象的权限情况")]),t._v(" "),s("ul",[s("li",[t._v("查询用户 user 的权限 select * from INFORMATION_SCHEMA.role_table_grants where grantee='user';")])])])]),t._v(" "),s("h3",{attrs:{id:"_5-2-数值类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-数值类型"}},[t._v("#")]),t._v(" 5.2 数值类型")]),t._v(" "),s("p",[t._v("PostgreSQL 提 供了丰富的数据类型。用户可以使用 CREATE TYPE 命令在数据库中创建新的数据类型。")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("字符类型")]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/064ea2b7aa104156abe88c9efdbe7143/image-20200814170050098.png",alt:"image-20200814170050098"}})]),t._v(" "),s("li",[s("p",[t._v("数值类型")]),t._v(" "),s("img",{staticStyle:{zoom:"25%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/98972d72799cbb9820e438b99d2e8074/image-20200814170124612.png",alt:"image-20200814170124612"}})]),t._v(" "),s("li",[s("p",[t._v("日期类型")]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/2e8b536f0cbed73f3b1a775b2f88bdb7/image-20200814170222040.png",alt:"image-20200814170222040"}})]),t._v(" "),s("li",[s("p",[t._v("几何类型")]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/3fc9f6d9f8f27be5892f1c2adbed52cc/image-20200814170639568.png",alt:"image-20200814170639568"}})]),t._v(" "),s("li",[s("p",[t._v("其他，参考：https://www.runoob.com/postgresql/postgresql-data-type.html")])])]),t._v(" "),s("h3",{attrs:{id:"_5-4-其他配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-其他配置"}},[t._v("#")]),t._v(" 5.4 其他配置")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("最大连接数")]),t._v(" "),s("p",[t._v("PostgreSQL\\9.2\\data\\postgresql.conf，改完重启，这个最大连接数是针对 PG 整个服务")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/29c6c820cedc7e37bfa7c37ed2c1c45d/image-20200814112348918.png",alt:"image-20200814112348918"}})]),t._v(" "),s("li",[s("p",[t._v("允许数据库远程访问")]),t._v(" "),s("p",[t._v("1）允许数据库服务器监听来自任何主机的连接请求：postgresql.conf")]),t._v(" "),s("p",[t._v("允许数据库服务器监听来自任何主机的连接请求")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("修改``#listen_addresses = 'localhost' 为 listen_addresses='*'\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("2）信任远程连接：pg_hba.conf")]),t._v(" "),s("p",[t._v("数值取值范围为：0,8,16,24,32 　即表示掩码 bit 的个数，　 例如：　　\n　　　　　 32 -> 192.168.1.1/32 表示必须是来自这个 IP 地址的访问才合法；\n　　　　　 24 -> 192.168.1.0/24 表示只要来自 192.168.1.0 ~ 192.168.1.255 的都合法；\n　　　　　 16 -> 192.168.0.0/16 表示只要来自 192.168.0.0 ~ 192.168.255.255 的都合法；\n　　　　　 8 -> 192.0.0.0/16 表示只要来自 192.0.0.0 ~ 192.255.255.255 的都合法；\n　　　　　 0 -> 0.0.0.0/0 表示全部 IP 地址都合法，/左边的 IP 地址随便了只要是合法的 IP 地址即可；")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("修改如下内容，信任指定服务器连接\n# IPv4 local connections:\nhost  all      all   127.0.0.1/32   ident\nhost  all      all   192.168.137.1/32（需要连接的服务器IP） trust\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])])])]),t._v(" "),s("h2",{attrs:{id:"_6-postgresql，postgis-实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-postgresql，postgis-实践"}},[t._v("#")]),t._v(" 6. PostgreSQL，PostGIS 实践")]),t._v(" "),s("h3",{attrs:{id:"_6-1-业务库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-业务库"}},[t._v("#")]),t._v(" 6.1 业务库")]),t._v(" "),s("p",[t._v("创建表空间，创建用户(可多个)，创建数据库, 创建模式（于用户同名）")]),t._v(" "),s("p",[t._v("如果需要多个模式数据库隔离：一个数据库所有者，一个模式一个用户（建同名）")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("配置允许远程连接")])]),t._v(" "),s("p",[t._v("配置 pg_hba.conf，修改 PostgreSQ 的 pg_hba.conf 文件，添加“host all all 0.0.0.0/0 md5”")]),t._v(" "),s("p",[t._v("配置 postgresql.conf，修改 listen_addresses='*'")]),t._v(" "),s("p",[t._v("PostgreSQL 默认是不允许远程连接的，需要修改配置文件")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("创建表空间")])]),t._v(" "),s("p",[t._v("定义表空间名称，路径（绝对路径），目录必须先存在，在创建表空间前先建一个同名目录")]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/f8f843a7e9f679812756e6ac6c81c4f6/image-20200814101202272.png",alt:"image-20200814101202272"}}),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"images\\image-20200814101847426.png",alt:"image-20200814101847426"}}),t._v(" "),s("p",[t._v("测试了下，每次初始创建，都在下面生成了这样一个目录。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("创建用户")])]),t._v(" "),s("p",[t._v("一个数据库一个模式分配一个用户，实现数据隔离。如果没有多个，就可以默认用 public 模式")]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/75a5593d41367a309f48e8832f6c9972/image-20200814105707480.png",alt:"image-20200814105707480"}}),t._v(" "),s("p",[t._v("创建好后：")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/ab6825a7e292bbfdef5841466b81d903/image-20200813135645639.png",alt:"image-20200813135645639"}}),t._v(" "),s("p",[t._v("**删除：**如果有对象授权了该用户，该用户无法删除")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("创建数据库")])]),t._v(" "),s("p",[t._v("PostgreSQL 创建数据库可以用以下三种方式：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("1、使用 CREATE DATABASE dbname; SQL 语句来创建。")]),t._v(" "),s("p",[t._v("​ 用 CREATE DATABASE test1；创建好的数据库，owner 为 posgres ，其他属性如下图")])])]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/3d8bc0d41a6e7c1eecc4a2664b18f0a5/image-20200814134406481.png",alt:"image-20200814134406481"}})])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("2、使用 createdb 命令来创建。")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("createdb -h localhost -p 5432 -U postgres test1\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("以上命令我们使用了超级用户 postgres 登录到主机地址为 localhost，端口号为 5432 的 PostgreSQL 数据库中并创建 test1 数据库")])]),t._v(" "),s("li",[s("p",[t._v("3、使用 pgAdmin 工具")]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/e14c6b1d65657d9860b4ba88dfdb6036/image-20200814140201539.png",alt:"image-20200814140201539"}})])]),t._v(" "),s("p",[s("strong",[t._v("控制权限：")])]),t._v(" "),s("p",[t._v("​ 通过上述方式创建的数据库对所有用户都连接权限，所以要去掉，只让超级管理员和数据库所有者能操作")]),t._v(" "),s("p",[t._v("​ "),s("strong",[t._v("revoke CONNECT ON DATABASE test from public;")])]),t._v(" "),s("p",[t._v("​ 给一个数据库添加多个用户操作权限，如后续建多个模式情况：")]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/b9d0c99a1196249f29b108f2cc276f56/image-20200814143951742.png",alt:"image-20200814143951742"}}),t._v(" "),s("p",[t._v("但是上述授权，只让授权用户对 public 模式有操作权限，其他模式则默认没有权限的")]),t._v(" "),s("p",[t._v("**删除：**如果因为占用无法删除，要断开其他所有连接和打开页面")]),t._v(" "),s("ol",{attrs:{start:"5"}},[s("li",[s("p",[s("strong",[t._v("创建模式")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("sql 语句创建：")])]),t._v(" "),s("li",[s("p",[t._v("pgadmin 创建：")])])]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/0a083389b8690fd64ccee568da6a52b5/image-20200814145233033.png",alt:"image-20200814145233033"}}),t._v(" "),s("p",[t._v("创建的模式，如果没有给其他用户授权，则无法创建和使用数据库对象")])])]),t._v(" "),s("ol",{attrs:{start:"6"}},[s("li",[s("strong",[t._v("模式下创建数据库对象")])])]),t._v(" "),s("ul",[s("li",[t._v("表：如果有必要，表可以给其他用户单独授权")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("序列：自增序列")]),t._v(" "),s("p",[t._v("pg 自增序列和 oralcle 类似，先创建序列，可以 pgadmin 图形创建，也可以 sql 语句创建")]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/07caad1f7dc3a7889ff8b4c576c627fb/image-20200814165249942.png",alt:"image-20200814165249942"}}),t._v(" "),s("p",[t._v("读取序列：")]),t._v(" "),s("p",[t._v("SELECT nextval('gys.mytable_myid_seq');")]),t._v(" "),s("p",[t._v("为字段设置自增序列：")]),t._v(" "),s("p",[t._v("alter table gys.mytable alter column myid set default nextval('gys.mytable_myid_seq');")])]),t._v(" "),s("li",[s("p",[t._v("索引")])])]),t._v(" "),s("h3",{attrs:{id:"_6-2-空间库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-空间库"}},[t._v("#")]),t._v(" 6.2 空间库")]),t._v(" "),s("h4",{attrs:{id:"_6-2-1-postgis-空间库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-1-postgis-空间库"}},[t._v("#")]),t._v(" 6.2.1 PostGIS 空间库")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("建一个普通的数据库 postgistest")])]),t._v(" "),s("li",[s("p",[t._v("加载 PostGIS 扩展")]),t._v(" "),s("p",[t._v("在数据库 postgistest 上加载"),s("strong",[t._v("PostGIS 空间扩展")]),t._v("，在当前数据库的"),s("strong",[t._v("查询工具")]),t._v("中执行")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("CREATE EXTENSION postgis;\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("通过运行 PostGIS 函数来确认是否安装了 PostGIS：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("SELECT postgis_full_version();\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/a04ab357629b9b406a0a76ff3ea317a6/image-20200814173634325.png",alt:"image-20200814173634325"}}),t._v(" "),s("p",[t._v("安装了 postgis 后，在 public 模式下默认增加了一张系统表")]),t._v(" "),s("p",[s("strong",[t._v("系统表：spatial_ref_sys 表")]),t._v("：OGC 规范的空间参考")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("字段")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("srid")]),t._v(" "),s("td",[t._v("空间参考的 Well-Known ID")])]),t._v(" "),s("tr",[s("td",[t._v("srtext")]),t._v(" "),s("td",[t._v("存放的是以字符串描述的空间参考")])]),t._v(" "),s("tr",[s("td",[t._v("proj4text")]),t._v(" "),s("td",[t._v("存放的则是以字符串描述的 PROJ.4 投影定义（PostGIS 使用 PROJ.4 实现投影）")])])])])])]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[s("p",[t._v("在 PostGIS 中创建一个空间表")]),t._v(" "),s("p",[t._v("包含两步，第一步创建一个一般表，第二步给这个表添加几何字段")]),t._v(" "),s("p",[t._v("如再给 public 模式下 cities 表添加一个名为 shape 的几何字段（二维点）：")])])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("   select AddGeometryColumn('public', 'cities', 'shape', 4326, 'POINT', 2)\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("strong",[t._v("系统表：geometry_columns 表")]),t._v("：当前数据库中所有几何字段的信息")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("字段")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("f_table_schema")]),t._v(" "),s("td",[t._v("空间表所在的模式")])]),t._v(" "),s("tr",[s("td",[t._v("f_table_name")]),t._v(" "),s("td",[t._v("空间表的表名")])]),t._v(" "),s("tr",[s("td",[t._v("f_geometry_column")]),t._v(" "),s("td",[t._v("空间表中几何字段的名称")])]),t._v(" "),s("tr",[s("td",[t._v("srid")]),t._v(" "),s("td",[t._v("空间表的空间参考")])])])]),t._v(" "),s("p",[s("img",{attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/f11bd5746b668f7b8e48fa79b9ebb394/image-20200817094927378.png",alt:"image-20200817094927378"}})]),t._v(" "),s("h4",{attrs:{id:"_6-2-2-arcgis-空间库-pg"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-2-arcgis-空间库-pg"}},[t._v("#")]),t._v(" 6.2.2 ArcGIS 空间库 (PG)")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("部署环境")]),t._v(" "),s("p",[s("strong",[t._v("1) 拷贝 dll 到 PostgreQL")])])])]),t._v(" "),s("p",[t._v("在 ArcMap 的安装目录下找到 \\DatabaseSupport\\PostgreSQL\\9.5，windows 及 linux 用户分别将对应文件夹内的文件拷贝到 Postgresql 安装目录下的\\lib 文件夹内。")]),t._v(" "),s("p",[s("strong",[t._v("2) 拷贝 PostgreSQL 客户端文件到 arcgis")]),t._v("（有的版本不用拷贝，因为 desktop 下自带）")]),t._v(" "),s("p",[t._v("为了让 ArcMap 连接数据库的需要把连接 postgres 的 32 位的客户端的 dl 五个 dll（libeay32.dll、libiconv-2.dll、libintl-8.dll、libpq.dll 和、ssleay32.dll）放到 Arcmap 的 bin 目录下。")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/f7fa150d369b428392e0845dd57c6547/image-20200819110151735.png",alt:"image-20200819110151735"}}),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[s("p",[t._v("修改配置文件,允许远程连接（arcgis 和数据库不在同一台机器上）")]),t._v(" "),s("p",[t._v("配置 pg_hba.conf，修改 PostgreSQ 的 pg_hba.conf 文件，添加“host all all 0.0.0.0/0 md5”")]),t._v(" "),s("p",[t._v("配置 postgresql.conf，修改 listen_addresses='*'")]),t._v(" "),s("p",[t._v("PostgreSQL 默认是不允许远程连接的，需要修改配置文件")])]),t._v(" "),s("li",[s("p",[t._v("创建企业级空间数据库")]),t._v(" "),s("p",[t._v("toolboxes->System Toolboxes->Data Management tool=>Geodatabase Administration=>create Enterprise Geodatabase")]),t._v(" "),s("img",{staticStyle:{zoom:"40%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/6e3770d4d32f162613c632f276f4d571/image-20200818100105456.png",alt:"image-20200818100105456"}}),t._v(" "),s("p",[t._v("创建企业级数据库以后，在原先数据库下，会创建 sde 模式，并且创建 sde 用户，授权该数据库下模式")]),t._v(" "),s("p",[s("strong",[t._v("连接，用户要以 sde 连接")]),t._v("，否则创建要素类提示 Database user name and current user schema do not match")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/e89bb1d64402b096d973559d7cbcb77d/image-20200818171534352.png",alt:"image-20200818171534352"}})])]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[s("p",[t._v("新增一个空间数据库")]),t._v(" "),s("p",[t._v("如何在一个已有的企业数据库服务器上新增一个空间库")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("创建同名表空间，创建普通数据库，"),s("strong",[t._v("数据库的所有者设成 SDE")]),t._v("，表空间设置")])]),t._v(" "),s("li",[s("p",[t._v("Arcgis Catalog 中以 sde 用户连接到新建的数据库，右键 Enable Geodatabase，授权文件选择 ecp 格式")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/adf0e79bae1e7b99d449435bac076dc4/image-20200820113042941.png",alt:"image-20200820113042941"}}),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/cef77e1a2fd6b972108eb934f876af77/image-20200820113145929.png",alt:"image-20200820113145929"}})])])])]),t._v(" "),s("h4",{attrs:{id:"_6-2-3-超图空间库-pg"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-3-超图空间库-pg"}},[t._v("#")]),t._v(" 6.2.3 超图空间库 (PG)")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("pgadmin 创建数据库")])]),t._v(" "),s("li",[s("p",[t._v("超图 Desktop，新建数据库数据源，选择 PostgreSQL 类型数据库")])]),t._v(" "),s("li",[s("p",[t._v("在连接好的数据源下，可以新建图层")]),t._v(" "),s("p",[t._v("创建完空间库以后，会新建一个 sdx 模式")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/feecf666f99fba3e86c43a324b208b6f/image-20200817180741702.png",alt:"image-20200817180741702"}})])]),t._v(" "),s("h4",{attrs:{id:"_6-2-4-超图空间库-postgis"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-4-超图空间库-postgis"}},[t._v("#")]),t._v(" 6.2.4 超图空间库(PostGIS)")]),t._v(" "),s("ul",[s("li",[t._v("pgadmin 创建数据库")]),t._v(" "),s("li",[t._v("加载 PostGIS 扩展")]),t._v(" "),s("li",[t._v("超图 Desktop，新建数据库数据源，选择 PostGIS 类型数据库")]),t._v(" "),s("li",[t._v("在连接好的数据源下，可以新建图层")])]),t._v(" "),s("h4",{attrs:{id:"_6-2-5-超图空间库-postgresql-和-postgis-的差异"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-5-超图空间库-postgresql-和-postgis-的差异"}},[t._v("#")]),t._v(" "),s("strong",[t._v("6.2.5 超图空间库 PostgreSQL 和 PostGIS 的差异")])]),t._v(" "),s("p",[t._v("1.据量小的情况下，两者的读写上差别不大，数据量越大，postgresql 要略优于 postgis。")]),t._v(" "),s("p",[t._v("2.查询 postgis 会优于 postgresql。")]),t._v(" "),s("p",[t._v("3.查询和空间分析，postgresql 优于 postgis")]),t._v(" "),s("h2",{attrs:{id:"_7-postgresql-数据库表存储解析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-postgresql-数据库表存储解析"}},[t._v("#")]),t._v(" 7. PostgreSQL 数据库表存储解析")]),t._v(" "),s("h4",{attrs:{id:"_7-1-postgresql-系统表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-postgresql-系统表"}},[t._v("#")]),t._v(" 7.1 PostgreSQL 系统表")]),t._v(" "),s("p",[t._v("系统表：数据库——目录——PostgreSQL（pg_catalog）下")]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/a0e074aabb58146bbadb2cc2ff7ba25a/image-20200814093305552.png",alt:"image-20200814093305552"}}),t._v(" "),s("p",[t._v("参考：https://www.yiibai.com/manual/postgresql/catalogs.html")]),t._v(" "),s("p",[t._v("数据库中的所有表：pg_tables")]),t._v(" "),s("p",[t._v("查询所有角色列表：视图 pg_roles 可以查看所有的角色列表")]),t._v(" "),s("p",[s("strong",[t._v("Information_schema")]),t._v("：（隐藏的）")]),t._v(" "),s("p",[t._v("自动的存在于每个 database 中，里面包含了数据库中所有对象的定义信息。")]),t._v(" "),s("p",[t._v("查找表信息：SELECT * FROM information_schema.tables WHERE table_name='geometry_columns';")]),t._v(" "),s("p",[t._v("某个表的所有字段：select * from information_schema.columns where table_schema='public' and table_name ='your_table_name';")]),t._v(" "),s("h4",{attrs:{id:"_7-2-postgis-系统表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-postgis-系统表"}},[t._v("#")]),t._v(" 7.2 PostGIS 系统表")]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/824de4733a95e373fa11425e77bc4bd8/image-20200820140151727.png",alt:"image-20200820140151727"}}),t._v(" "),s("p",[t._v("增加了很多空间数据管理函数")]),t._v(" "),s("h4",{attrs:{id:"_7-3-arcgis-库表内部存储"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-arcgis-库表内部存储"}},[t._v("#")]),t._v(" 7.3 ArcGIS 库表内部存储")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("ArcGIS 下查看内容：")]),t._v(" "),s("p",[s("strong",[t._v("图层命名格式：数据库.sde.图层名称")])]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/153dd9cf360aecfea3620cefe6f4ddc7/image-20200820104559504.png",alt:"image-20200820104559504"}})]),t._v(" "),s("li",[s("p",[t._v("PgAdmin 里看到数据库存储")])])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("public 模式")]),t._v(" "),s("th",[t._v("SDE 模式")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("img",{staticStyle:{zoom:"50%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/f405c5a64746d4f659fda84a7343d7f1/image-20200820114234037.png",alt:"image-20200820114234037"}})]),t._v(" "),s("td",[s("img",{staticStyle:{zoom:"50%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/120cd8588ec302609b45799da53c9c80/image-20200820114401363.png",alt:"image-20200820114401363"}})])])])]),t._v(" "),s("p",[t._v("1）如果是单纯的空间库：系统表和图层表都存储在 sde 模式下，public 模式下存了坐标系表")]),t._v(" "),s("p",[t._v("2）sde 模式下，以 gdb 和 sde 开头存储的系统表")]),t._v(" "),s("p",[t._v("3）如果是业务库和空间库一起，那其他普通表存储在 public 模式下")]),t._v(" "),s("ul",[s("li")]),t._v(" "),s("h4",{attrs:{id:"_7-4-超图-postgresql-内部存储"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-4-超图-postgresql-内部存储"}},[t._v("#")]),t._v(" 7.4 超图 PostgreSQL 内部存储")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("超图里看到内容：")]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/ff395f33543db68dd9f1608a5a15a4c9/image-20200820135421765.png",alt:"image-20200820135421765"}})]),t._v(" "),s("li",[s("p",[t._v("pgadmin 里看到内容：")])])]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/6d098864f93e65efa0fd4a1fc8c1321b/image-20200820135017049.png",alt:"image-20200820135017049"}}),t._v(" "),s("p",[t._v("​ 1）新建空间库以后，空间库增加 sde 模式，下面存了一系列系统表")]),t._v(" "),s("p",[t._v("​ 2） 图层没有用单个表存储，而是分开存的，图层列表存在 sdx.smregister 里")]),t._v(" "),s("p",[t._v("​ 3） 图层属性数据存储在 smtablename 这列对应的表里，比如图中 smdtv_1")]),t._v(" "),s("h4",{attrs:{id:"_7-5-超图-postgis-内部存储"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-5-超图-postgis-内部存储"}},[t._v("#")]),t._v(" 7.5 超图 PostGIS 内部存储")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("超图桌面端看到内容：")]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/87403c04ef82414fe8bd60f9b31f69c8/image-20200820140039740.png",alt:"image-20200820140039740"}})]),t._v(" "),s("li",[s("p",[t._v("pgadmin 看到内容：")])])]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/dd2d9a842e4b1d6a567015ed3b34b6c1/image-20200820135639457.png",alt:"image-20200820135639457"}}),t._v(" "),s("p",[t._v("​ 1）新建空间库以后，空间库没有增加模式，所有内容都存在 public 模式下")]),t._v(" "),s("p",[t._v("​ 2） 一个图层一个表，属性存在图层表里")]),t._v(" "),s("h2",{attrs:{id:"_8-数据库备份还原"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-数据库备份还原"}},[t._v("#")]),t._v(" 8. 数据库备份还原")]),t._v(" "),s("h3",{attrs:{id:"_8-1-业务库备份还原"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-业务库备份还原"}},[t._v("#")]),t._v(" "),s("strong",[t._v("8.1 业务库备份还原")])]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("方式一：用 pgadmin 里的备份，恢复")])]),t._v(" "),s("p",[t._v("优点：操作方便")]),t._v(" "),s("p",[t._v("缺点：数据库慢慢庞大的时候，经常出错，备份的文件过程中出错的几率相当大，手动调节空间有限")]),t._v(" "),s("img",{staticStyle:{zoom:"33%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/4f9ecf867b4f17465a33211aaebdb133/image-20200819112855818.png",alt:"image-20200819112855818"}}),t._v(" "),s("p",[t._v("注意：在文件名，选择的时候，导出文件名需要在文本框手动加上文件名，创建按钮才不会置灰")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("方式二（推荐）：用 postgresql 内置工具， pg_dump.exe，psql.exe")])])])]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("备份： pg_dump.exe")])]),t._v(" "),s("p",[t._v("开始-运行-cmd 弹出 dos 控制台；然后 在控制台里，进入 PostgreSQL 安装目录 bin 下，然后执行以下命令")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("pg_dump -h 164.82.233.54 -U postgres databasename > C:\\databasename.bak\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])])]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/a6185124857c37f8fa47141393937ddf/image-20200819135108137.png",alt:"image-20200819135108137"}}),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("还原：")])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("psql -h localhost -U postgres -d databasename <  C:\\databasename.bak\n如： psql -h localhost -U postgres -d dcp < c:\\dcp.bak\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335//fellow-travellers/picgorepo/uploads/ba73b257c2b7d41ce52b7b48770bae05/image-20200821110014642.png",alt:"image-20200821110014642"}})])]),t._v(" "),s("h3",{attrs:{id:"_8-2-空间库备份还原"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-空间库备份还原"}},[t._v("#")]),t._v(" "),s("strong",[t._v("8.2 空间库备份还原")])]),t._v(" "),s("p",[t._v("arcgis：和 oracle 数据库一样操作，拷贝到 gdb，mdb 等文件型数据源里")]),t._v(" "),s("p",[t._v("supermap：超图客户端有备份数据库操作，数据集另存 udbx 等文件")]),t._v(" "),s("h2",{attrs:{id:"_9-postgis-操作-geometry-方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-postgis-操作-geometry-方法"}},[t._v("#")]),t._v(" 9. PostGIS 操作 geometry 方法")]),t._v(" "),s("p",[s("strong",[t._v("WKT 定义几何对象格式：")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("几何类型")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("WKT 格式")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("点")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("POINT(0 0)")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("线")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("LINESTRING(0 0,1 1,1 2)")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("面")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("POLYGON((0 0,4 0,4 4,0 4,0 0),(1 1, 2 1, 2 2, 1 2,1 1))")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("多点")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("MULTIPOINT(0 0,1 2)")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("多线")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("MULTILINESTRING((0 0,1 1,1 2),(2 3,3 2,5 4))")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("多面")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("MULTIPOLYGON(((0 0,4 0,4 4,0 4,0 0),(1 1,2 1,2 2,1 2,1 1)), ((-1 -1,-1 -2,-2 -2,-2 -1,-1 -1)))")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("几何集合")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("GEOMETRYCOLLECTION(POINT(2 3),LINESTRING((2 3,3 4)))")])])])]),t._v(" "),s("p",[t._v("样例：")]),t._v(" "),s("p",[t._v("SELECT ST_PointFromText('POINT(116.39088 39.90763)',4326);")]),t._v(" "),s("p",[t._v("SELECT ST_GeomFromText('LINESTRING(0 0,1 1,1 2)', 26910)")]),t._v(" "),s("p",[s("strong",[t._v("常用函数：")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("功能")]),t._v(" "),s("th",[t._v("函数")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("wkt 转 geometry")]),t._v(" "),s("td",[t._v("st_geomfromtext(wkt,wkid)")])]),t._v(" "),s("tr",[s("td",[t._v("geometry 转 wkt")]),t._v(" "),s("td",[t._v("st_astext(geom)")])]),t._v(" "),s("tr",[s("td",[t._v("获取点对象 x、y 坐标值")]),t._v(" "),s("td",[t._v("st_x(geom)、st_y(geom)")])]),t._v(" "),s("tr",[s("td",[t._v("获取线/面对象四至")]),t._v(" "),s("td",[t._v("st_xmin(geom)、st_ymin(geom)、st_xmax(geom)、st_ymax(geom)")])]),t._v(" "),s("tr",[s("td",[t._v("计算两点之间距离")]),t._v(" "),s("td",[t._v("st_distance(geom,geom) / st_distance(wkt,wkt)")])]),t._v(" "),s("tr",[s("td",[t._v("计算线的长度")]),t._v(" "),s("td",[t._v("st_length(geom) / st_length(wkt)")])]),t._v(" "),s("tr",[s("td",[t._v("计算面积")]),t._v(" "),s("td",[t._v("st_area(geom) / st_area(wkt)")])]),t._v(" "),s("tr",[s("td",[t._v("缓冲区计算")]),t._v(" "),s("td",[t._v("st_buffer(geom,distance) / st_buffer(wkt,distance)")])])])]),t._v(" "),s("p",[s("strong",[t._v("管理函数：")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("功能")]),t._v(" "),s("th",[t._v("函数")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("添加几何字段")]),t._v(" "),s("td",[t._v("AddGeometryColumn(, , , , , )")])]),t._v(" "),s("tr",[s("td",[t._v("删除几何字段")]),t._v(" "),s("td",[t._v("DropGeometryColumn(, , )")])]),t._v(" "),s("tr",[s("td",[t._v("检查数据库几何字段并在 geometry_columns 中归档")]),t._v(" "),s("td",[t._v("Probe_Geometry_Columns()")])]),t._v(" "),s("tr",[s("td",[t._v("给几何对象设置空间参考（在通过一个范围做空间查询时常用）")]),t._v(" "),s("td",[t._v("ST_SetSRID(geometry, integer)")])])])]),t._v(" "),s("p",[s("strong",[t._v("几何对象关系函数 ：")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("功能")]),t._v(" "),s("th",[t._v("函数")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("获取两个几何对象间的距离")]),t._v(" "),s("td",[t._v("ST_Distance(geometry, geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("如果两个几何对象间距离在给定值范围内"),s("br"),t._v("则返回 TRUE")]),t._v(" "),s("td",[t._v("ST_DWithin(geometry, geometry, float)")])]),t._v(" "),s("tr",[s("td",[t._v("判断两个几何对象是否相等")]),t._v(" "),s("td",[t._v("ST_Equals(geometry, geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("判断两个几何对象是否分离")]),t._v(" "),s("td",[t._v("ST_Disjoint(geometry, geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("判断两个几何对象是否相交")]),t._v(" "),s("td",[t._v("ST_Intersects(geometry, geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("判断两个几何对象的边缘是否接触")]),t._v(" "),s("td",[t._v("ST_Touches(geometry, geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("判断两个几何对象是否互相穿过")]),t._v(" "),s("td",[t._v("ST_Crosses(geometry, geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("判断 A 是否被 B 包含")]),t._v(" "),s("td",[t._v("ST_Within(geometry A, geometry B)")])]),t._v(" "),s("tr",[s("td",[t._v("判断两个几何对象是否是重叠")]),t._v(" "),s("td",[t._v("ST_Overlaps(geometry, geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("判断 A 是否包含 B")]),t._v(" "),s("td",[t._v("ST_Contains(geometry A, geometry B)")])]),t._v(" "),s("tr",[s("td",[t._v("判断 A 是否覆盖 B")]),t._v(" "),s("td",[t._v("ST_Covers(geometry A, geometry B)")])]),t._v(" "),s("tr",[s("td",[t._v("判断 A 是否被 B 所覆盖")]),t._v(" "),s("td",[t._v("ST_CoveredBy(geometry A, geometry B)")])]),t._v(" "),s("tr",[s("td",[t._v("通过 DE-9IM 矩阵判断两个几何对象的关系是否成立")]),t._v(" "),s("td",[t._v("ST_Relate(geometry, geometry, intersectionPatternMatrix)")])]),t._v(" "),s("tr",[s("td",[t._v("获得两个几何对象的关系（DE-9IM 矩阵）")]),t._v(" "),s("td",[t._v("ST_Relate(geometry, geometry)")])])])]),t._v(" "),s("p",[s("strong",[t._v("几何对象处理函数：")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("功能")]),t._v(" "),s("th",[t._v("函数")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("获取几何对象的中心")]),t._v(" "),s("td",[t._v("ST_Centroid(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("面积量测")]),t._v(" "),s("td",[t._v("ST_Area(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("长度量测")]),t._v(" "),s("td",[t._v("ST_Length(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("返回曲面上的一个点")]),t._v(" "),s("td",[t._v("ST_PointOnSurface(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("获取边界")]),t._v(" "),s("td",[t._v("ST_Boundary(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("获取缓冲后的几何对象")]),t._v(" "),s("td",[t._v("ST_Buffer(geometry, double, [integer])")])]),t._v(" "),s("tr",[s("td",[t._v("获取多几何对象的外接对象")]),t._v(" "),s("td",[t._v("ST_ConvexHull(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("获取两个几何对象相交的部分")]),t._v(" "),s("td",[t._v("ST_Intersection(geometry, geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("将经度小于 0 的值加 360 使所有经度值在 0-360 间")]),t._v(" "),s("td",[t._v("ST_Shift_Longitude(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("获取两个几何对象不相交的部分（A、B 可互换）")]),t._v(" "),s("td",[t._v("ST_SymDifference(geometry A, geometry B)")])]),t._v(" "),s("tr",[s("td",[t._v("从 A 去除和 B 相交的部分后返回")]),t._v(" "),s("td",[t._v("ST_Difference(geometry A, geometry B)")])]),t._v(" "),s("tr",[s("td",[t._v("返回两个几何对象的合并结果")]),t._v(" "),s("td",[t._v("ST_Union(geometry, geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("返回一系列几何对象的合并结果")]),t._v(" "),s("td",[t._v("ST_Union(geometry set)")])]),t._v(" "),s("tr",[s("td",[t._v("用较少的内存和较长的时间完成合并操作")]),t._v(" "),s("td",[t._v("ST_MemUnion(geometry set)")])])])]),t._v(" "),s("p",[s("strong",[t._v("几何对象存取函数：")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("功能")]),t._v(" "),s("th",[t._v("函数")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("获取几何对象的空间参考 ID")]),t._v(" "),s("td",[t._v("ST_SRID(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("获取几何对象的 WKB 描述")]),t._v(" "),s("td",[t._v("ST_AsBinary(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("获取几何对象的 WKT 描述")]),t._v(" "),s("td",[t._v("ST_AsText(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("获取几何对象的维数")]),t._v(" "),s("td",[t._v("ST_Dimension(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("获取几何对象的边界范围")]),t._v(" "),s("td",[t._v("ST_Envelope(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("判断几何对象是否为空")]),t._v(" "),s("td",[t._v("ST_IsEmpty(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("判断几何对象是否不包含特殊点（比如自相交）")]),t._v(" "),s("td",[t._v("ST_IsSimple(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("判断几何对象是否闭合")]),t._v(" "),s("td",[t._v("ST_IsClosed(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("判断曲线是否闭合并且不包含特殊点")]),t._v(" "),s("td",[t._v("ST_IsRing(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("获取多几何对象中的对象个数")]),t._v(" "),s("td",[t._v("ST_NumGeometries(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("获取多几何对象中第 N 个对象")]),t._v(" "),s("td",[t._v("ST_GeometryN(geometry,int)")])]),t._v(" "),s("tr",[s("td",[t._v("获取几何对象中的点个数")]),t._v(" "),s("td",[t._v("ST_NumPoints(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("获取几何对象的第 N 个点")]),t._v(" "),s("td",[t._v("ST_PointN(geometry,integer)")])]),t._v(" "),s("tr",[s("td",[t._v("获取多边形的外边缘")]),t._v(" "),s("td",[t._v("ST_ExteriorRing(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("获取多边形内边界个数")]),t._v(" "),s("td",[t._v("ST_NumInteriorRings(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("获取多边形的第 N 个内边界")]),t._v(" "),s("td",[t._v("ST_InteriorRingN(geometry,integer)")])]),t._v(" "),s("tr",[s("td",[t._v("获取线的终点")]),t._v(" "),s("td",[t._v("ST_EndPoint(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("获取线的起始点")]),t._v(" "),s("td",[t._v("ST_StartPoint(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("获取几何对象的类型")]),t._v(" "),s("td",[t._v("GeometryType(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("即 POINTM 对象会被判断为 point")]),t._v(" "),s("td",[t._v("ST_GeometryType(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("获取点的 X 坐标")]),t._v(" "),s("td",[t._v("ST_X(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("获取点的 Y 坐标")]),t._v(" "),s("td",[t._v("ST_Y(geometry)")])]),t._v(" "),s("tr",[s("td",[t._v("获取点的 Z 坐标")]),t._v(" "),s("td",[t._v("ST_Z(geometry)")])])])]),t._v(" "),s("p",[s("strong",[t._v("几何对象构造函数 ：")]),t._v("\n参考语义：\nText：WKT\nWKB：WKB\nGeom:Geometry\nM:Multi\nBd:BuildArea\nColl:Collection ST_GeomFromText(text,[])")]),t._v(" "),s("p",[t._v("ST_LineFromText(text,[])\nST_LinestringFromText(text,[])\nST_PolyFromText(text,[])\nST_PolygonFromText(text,[])\nST_MPointFromText(text,[])\nST_MLineFromText(text,[])\nST_MPolyFromText(text,[])\nST_GeomCollFromText(text,[])\nST_GeomFromWKB(bytea,[])\nST_GeometryFromWKB(bytea,[])\nST_PointFromWKB(bytea,[])\nST_LineFromWKB(bytea,[])\nST_LinestringFromWKB(bytea,[])\nST_PolyFromWKB(bytea,[])\nST_PolygonFromWKB(bytea,[])\nST_MPointFromWKB(bytea,[])\nST_MLineFromWKB(bytea,[])\nST_MPolyFromWKB(bytea,[])\nST_GeomCollFromWKB(bytea,[])\nST_BdPolyFromText(text WKT, integer SRID)\nST_BdMPolyFromText(text WKT, integer SRID)")]),t._v(" "),s("h2",{attrs:{id:"_10-资源网站"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10-资源网站"}},[t._v("#")]),t._v(" 10. 资源网站")]),t._v(" "),s("ol",[s("li",[t._v("PostgreSQL 中文社区：http://www.postgres.cn/index.php/v2/home")]),t._v(" "),s("li",[t._v("PostgreSQL 手册： http://www.postgres.cn/docs/12/index.html")]),t._v(" "),s("li",[t._v("PostgreSQL 官网： https://www.postgresql.org/")]),t._v(" "),s("li",[t._v("PostGIS 官网：http://www.postgis.net/")]),t._v(" "),s("li",[t._v("PostGIS 下载： http://download.osgeo.org/postgis/windows/")]),t._v(" "),s("li",[t._v("PostgreSQL 下载：https://www.enterprisedb.com/downloads/postgres-postgresql-downloads")]),t._v(" "),s("li",[t._v("PgAdmin 官网：https://www.pgadmin.org/")]),t._v(" "),s("li",[t._v("PgAdmin 下载：https://www.pgadmin.org/download/pgadmin-4-windows/")]),t._v(" "),s("li",[t._v("PostGIS 技术文章：https://blog.csdn.net/qq_35732147/article/details/85256640")])])])}),[],!1,null,null,null);e.default=_.exports}}]);