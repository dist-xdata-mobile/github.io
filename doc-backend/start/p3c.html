<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>p3c规范 | Fellow Travellers</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/assets/img/favicon.ico">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <meta name="description" content="Fellow-Travellers documents for tech3D / mobile / calc / back-end">
    <link rel="preload" href="/assets/css/0.styles.d4a3a82a.css" as="style"><link rel="preload" href="/assets/js/app.16cdc938.js" as="script"><link rel="preload" href="/assets/js/3.4f14b16d.js" as="script"><link rel="preload" href="/assets/js/1.02cf7ae9.js" as="script"><link rel="preload" href="/assets/js/55.368817a9.js" as="script"><link rel="prefetch" href="/assets/js/10.f5269c4e.js"><link rel="prefetch" href="/assets/js/100.c7e247ff.js"><link rel="prefetch" href="/assets/js/101.b60225bc.js"><link rel="prefetch" href="/assets/js/102.adacab9e.js"><link rel="prefetch" href="/assets/js/103.32cd0f3b.js"><link rel="prefetch" href="/assets/js/104.1fd9ea1d.js"><link rel="prefetch" href="/assets/js/105.5bfce959.js"><link rel="prefetch" href="/assets/js/106.44ca9c1d.js"><link rel="prefetch" href="/assets/js/107.9ee3fdbe.js"><link rel="prefetch" href="/assets/js/108.2e6ba386.js"><link rel="prefetch" href="/assets/js/109.12b4497c.js"><link rel="prefetch" href="/assets/js/11.9161989f.js"><link rel="prefetch" href="/assets/js/110.d255fdda.js"><link rel="prefetch" href="/assets/js/111.64c62930.js"><link rel="prefetch" href="/assets/js/112.6a427f04.js"><link rel="prefetch" href="/assets/js/113.5ec41ed5.js"><link rel="prefetch" href="/assets/js/114.d289af71.js"><link rel="prefetch" href="/assets/js/115.b052778b.js"><link rel="prefetch" href="/assets/js/116.f20d5acd.js"><link rel="prefetch" href="/assets/js/117.759b608c.js"><link rel="prefetch" href="/assets/js/118.a00460b4.js"><link rel="prefetch" href="/assets/js/119.021cbb12.js"><link rel="prefetch" href="/assets/js/12.e1aacb47.js"><link rel="prefetch" href="/assets/js/120.5bd8b71f.js"><link rel="prefetch" href="/assets/js/121.3e722ff2.js"><link rel="prefetch" href="/assets/js/122.a825e6c4.js"><link rel="prefetch" href="/assets/js/123.ff402ce6.js"><link rel="prefetch" href="/assets/js/124.287761b7.js"><link rel="prefetch" href="/assets/js/125.b4048370.js"><link rel="prefetch" href="/assets/js/126.bef086fd.js"><link rel="prefetch" href="/assets/js/127.a0784eab.js"><link rel="prefetch" href="/assets/js/128.66f3cbc1.js"><link rel="prefetch" href="/assets/js/129.aef33c57.js"><link rel="prefetch" href="/assets/js/13.faee7a70.js"><link rel="prefetch" href="/assets/js/130.0fbb1019.js"><link rel="prefetch" href="/assets/js/131.61f2146b.js"><link rel="prefetch" href="/assets/js/132.3d912bd8.js"><link rel="prefetch" href="/assets/js/133.b688ed34.js"><link rel="prefetch" href="/assets/js/134.59d26e48.js"><link rel="prefetch" href="/assets/js/135.2d1de6ca.js"><link rel="prefetch" href="/assets/js/136.82c509c1.js"><link rel="prefetch" href="/assets/js/137.aa6f5b18.js"><link rel="prefetch" href="/assets/js/138.8f50bb93.js"><link rel="prefetch" href="/assets/js/139.83f80acb.js"><link rel="prefetch" href="/assets/js/14.5e1b322f.js"><link rel="prefetch" href="/assets/js/140.255a8042.js"><link rel="prefetch" href="/assets/js/141.a7ad537d.js"><link rel="prefetch" href="/assets/js/142.b0c92d9c.js"><link rel="prefetch" href="/assets/js/143.f15b1f80.js"><link rel="prefetch" href="/assets/js/144.813a5a2e.js"><link rel="prefetch" href="/assets/js/145.b7069ddf.js"><link rel="prefetch" href="/assets/js/146.9fcc40e8.js"><link rel="prefetch" href="/assets/js/147.654c12e8.js"><link rel="prefetch" href="/assets/js/148.d2104b86.js"><link rel="prefetch" href="/assets/js/149.16115bff.js"><link rel="prefetch" href="/assets/js/15.c64a0296.js"><link rel="prefetch" href="/assets/js/150.e19d3aa4.js"><link rel="prefetch" href="/assets/js/151.e1e9732d.js"><link rel="prefetch" href="/assets/js/152.e4d9ed7c.js"><link rel="prefetch" href="/assets/js/153.720bddec.js"><link rel="prefetch" href="/assets/js/154.6d76f159.js"><link rel="prefetch" href="/assets/js/155.56639bb5.js"><link rel="prefetch" href="/assets/js/156.1b1456ad.js"><link rel="prefetch" href="/assets/js/157.41735b3f.js"><link rel="prefetch" href="/assets/js/158.2f7e2a71.js"><link rel="prefetch" href="/assets/js/159.8ecf5123.js"><link rel="prefetch" href="/assets/js/16.f13c1a4b.js"><link rel="prefetch" href="/assets/js/160.dd6f3d5e.js"><link rel="prefetch" href="/assets/js/161.ba4d9a7f.js"><link rel="prefetch" href="/assets/js/162.297aea0d.js"><link rel="prefetch" href="/assets/js/163.e34450b7.js"><link rel="prefetch" href="/assets/js/164.34381886.js"><link rel="prefetch" href="/assets/js/165.d4c2775d.js"><link rel="prefetch" href="/assets/js/166.c4c9cefb.js"><link rel="prefetch" href="/assets/js/167.d323a0a9.js"><link rel="prefetch" href="/assets/js/168.c20012b9.js"><link rel="prefetch" href="/assets/js/169.3cfddb83.js"><link rel="prefetch" href="/assets/js/17.e99ac461.js"><link rel="prefetch" href="/assets/js/170.3d3526f6.js"><link rel="prefetch" href="/assets/js/171.bba7cce9.js"><link rel="prefetch" href="/assets/js/172.8fbda3bd.js"><link rel="prefetch" href="/assets/js/173.1532f8d6.js"><link rel="prefetch" href="/assets/js/174.638e5e0a.js"><link rel="prefetch" href="/assets/js/175.d8d82e12.js"><link rel="prefetch" href="/assets/js/176.4b3a122c.js"><link rel="prefetch" href="/assets/js/177.3d9e6e89.js"><link rel="prefetch" href="/assets/js/178.58b1bf9b.js"><link rel="prefetch" href="/assets/js/179.3fc5f21a.js"><link rel="prefetch" href="/assets/js/18.2df0d7da.js"><link rel="prefetch" href="/assets/js/180.436cb2b1.js"><link rel="prefetch" href="/assets/js/181.dadcbdd8.js"><link rel="prefetch" href="/assets/js/182.d7f00bd5.js"><link rel="prefetch" href="/assets/js/183.b6a49ebe.js"><link rel="prefetch" href="/assets/js/184.72f1e1df.js"><link rel="prefetch" href="/assets/js/185.a30e0b04.js"><link rel="prefetch" href="/assets/js/186.a89aa666.js"><link rel="prefetch" href="/assets/js/187.c7601a79.js"><link rel="prefetch" href="/assets/js/188.47d25cdd.js"><link rel="prefetch" href="/assets/js/189.a5220877.js"><link rel="prefetch" href="/assets/js/19.74c2fe85.js"><link rel="prefetch" href="/assets/js/190.7fea63c8.js"><link rel="prefetch" href="/assets/js/191.79188b69.js"><link rel="prefetch" href="/assets/js/192.91858bc5.js"><link rel="prefetch" href="/assets/js/193.f8c9dc11.js"><link rel="prefetch" href="/assets/js/194.db5d514f.js"><link rel="prefetch" href="/assets/js/195.a21dfa21.js"><link rel="prefetch" href="/assets/js/196.3deca662.js"><link rel="prefetch" href="/assets/js/197.a26c6a57.js"><link rel="prefetch" href="/assets/js/198.199de2a9.js"><link rel="prefetch" href="/assets/js/199.3a93f5fd.js"><link rel="prefetch" href="/assets/js/20.37ef7b5a.js"><link rel="prefetch" href="/assets/js/200.2e0ca284.js"><link rel="prefetch" href="/assets/js/201.43159287.js"><link rel="prefetch" href="/assets/js/202.47ac18b9.js"><link rel="prefetch" href="/assets/js/21.8edf360c.js"><link rel="prefetch" href="/assets/js/22.681f9ff8.js"><link rel="prefetch" href="/assets/js/23.102f38f3.js"><link rel="prefetch" href="/assets/js/24.0d068097.js"><link rel="prefetch" href="/assets/js/25.b8c6fba0.js"><link rel="prefetch" href="/assets/js/26.b76fcccf.js"><link rel="prefetch" href="/assets/js/27.b95d8356.js"><link rel="prefetch" href="/assets/js/28.425d53a0.js"><link rel="prefetch" href="/assets/js/29.49ae4d56.js"><link rel="prefetch" href="/assets/js/30.268326de.js"><link rel="prefetch" href="/assets/js/31.d1322ccd.js"><link rel="prefetch" href="/assets/js/32.6baff7b9.js"><link rel="prefetch" href="/assets/js/33.91599495.js"><link rel="prefetch" href="/assets/js/34.7d1e8694.js"><link rel="prefetch" href="/assets/js/35.a28b2867.js"><link rel="prefetch" href="/assets/js/36.926c21b7.js"><link rel="prefetch" href="/assets/js/37.00738964.js"><link rel="prefetch" href="/assets/js/38.c07a024e.js"><link rel="prefetch" href="/assets/js/39.23ab4214.js"><link rel="prefetch" href="/assets/js/4.79366a86.js"><link rel="prefetch" href="/assets/js/40.47c89362.js"><link rel="prefetch" href="/assets/js/41.0e9b77b3.js"><link rel="prefetch" href="/assets/js/42.e93c36a9.js"><link rel="prefetch" href="/assets/js/43.8e4bef73.js"><link rel="prefetch" href="/assets/js/44.f5808021.js"><link rel="prefetch" href="/assets/js/45.3afe2dae.js"><link rel="prefetch" href="/assets/js/46.f597a77f.js"><link rel="prefetch" href="/assets/js/47.11f2d487.js"><link rel="prefetch" href="/assets/js/48.7fef6ef8.js"><link rel="prefetch" href="/assets/js/49.b2d21efe.js"><link rel="prefetch" href="/assets/js/5.9ee91412.js"><link rel="prefetch" href="/assets/js/50.5832583c.js"><link rel="prefetch" href="/assets/js/51.54c00e7a.js"><link rel="prefetch" href="/assets/js/52.bd5535f0.js"><link rel="prefetch" href="/assets/js/53.0d38f84a.js"><link rel="prefetch" href="/assets/js/54.65144b95.js"><link rel="prefetch" href="/assets/js/56.04e15523.js"><link rel="prefetch" href="/assets/js/57.b41a7dc6.js"><link rel="prefetch" href="/assets/js/58.0f0d92dd.js"><link rel="prefetch" href="/assets/js/59.e7dddc9e.js"><link rel="prefetch" href="/assets/js/6.b921ef33.js"><link rel="prefetch" href="/assets/js/60.4038bd0b.js"><link rel="prefetch" href="/assets/js/61.5d51e956.js"><link rel="prefetch" href="/assets/js/62.786b095c.js"><link rel="prefetch" href="/assets/js/63.9da19a49.js"><link rel="prefetch" href="/assets/js/64.48f50f07.js"><link rel="prefetch" href="/assets/js/65.0fd7ee4a.js"><link rel="prefetch" href="/assets/js/66.5d68a363.js"><link rel="prefetch" href="/assets/js/67.f4882da2.js"><link rel="prefetch" href="/assets/js/68.224daefc.js"><link rel="prefetch" href="/assets/js/69.420801b1.js"><link rel="prefetch" href="/assets/js/7.e128bbee.js"><link rel="prefetch" href="/assets/js/70.1e62f96f.js"><link rel="prefetch" href="/assets/js/71.62f9fa7c.js"><link rel="prefetch" href="/assets/js/72.ad20df74.js"><link rel="prefetch" href="/assets/js/73.e16fef7c.js"><link rel="prefetch" href="/assets/js/74.c1f72d12.js"><link rel="prefetch" href="/assets/js/75.e1f28980.js"><link rel="prefetch" href="/assets/js/76.2c304c87.js"><link rel="prefetch" href="/assets/js/77.7265d1f0.js"><link rel="prefetch" href="/assets/js/78.c7c2fdd3.js"><link rel="prefetch" href="/assets/js/79.0be55b5d.js"><link rel="prefetch" href="/assets/js/8.b17d0b27.js"><link rel="prefetch" href="/assets/js/80.3c460019.js"><link rel="prefetch" href="/assets/js/81.972b58cd.js"><link rel="prefetch" href="/assets/js/82.6c4d50e0.js"><link rel="prefetch" href="/assets/js/83.89ff3b39.js"><link rel="prefetch" href="/assets/js/84.5629cfb0.js"><link rel="prefetch" href="/assets/js/85.78a9bc3f.js"><link rel="prefetch" href="/assets/js/86.b429e7fb.js"><link rel="prefetch" href="/assets/js/87.5c3ba926.js"><link rel="prefetch" href="/assets/js/88.52737753.js"><link rel="prefetch" href="/assets/js/89.696bb63f.js"><link rel="prefetch" href="/assets/js/9.0874a43d.js"><link rel="prefetch" href="/assets/js/90.60296dbe.js"><link rel="prefetch" href="/assets/js/91.2d2fd4df.js"><link rel="prefetch" href="/assets/js/92.d860f080.js"><link rel="prefetch" href="/assets/js/93.b341ebd9.js"><link rel="prefetch" href="/assets/js/94.ebd37258.js"><link rel="prefetch" href="/assets/js/95.15dbfc06.js"><link rel="prefetch" href="/assets/js/96.041d049b.js"><link rel="prefetch" href="/assets/js/97.e22ed305.js"><link rel="prefetch" href="/assets/js/98.2e23ad42.js"><link rel="prefetch" href="/assets/js/99.e886cd85.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d4a3a82a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar shadow"><div class="con-btns-header"><a href="/" class="home-link router-link-active"><div class="con-logo"><!----> <span class="site-name">Fellow Travellers</span></div></a> <div class="links"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link" data-v-e7cf42d2>主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">三维</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-tech3d/start/" class="nav-link" data-v-e7cf42d2>入门手册</a></li><li class="dropdown-item"><!----> <a href="/doc-tech3d/language/Micro-frontend_Start.html" class="nav-link" data-v-e7cf42d2>开发语言</a></li><li class="dropdown-item"><!----> <a href="/doc-tech3d/production/" class="nav-link" data-v-e7cf42d2>产品</a></li><li class="dropdown-item"><!----> <a href="/doc-tech3d/codelab/Principle_of_Visualizatio_for_WebGL.html" class="nav-link" data-v-e7cf42d2>专题</a></li><li class="dropdown-item"><!----> <a href="/doc-tech3d/other/SuperMap_Questions_and_Answer.html" class="nav-link" data-v-e7cf42d2>其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-frontend/start/" class="nav-link" data-v-e7cf42d2>入门手册</a></li><li class="dropdown-item"><!----> <a href="/doc-frontend/base/EC_ScopChain_Closure.html" class="nav-link" data-v-e7cf42d2>开发基础</a></li><li class="dropdown-item"><!----> <a href="/doc-frontend/web-gis/" class="nav-link" data-v-e7cf42d2>WebGIS开发</a></li><li class="dropdown-item"><!----> <a href="/doc-frontend/solution/" class="nav-link" data-v-e7cf42d2>解决方案</a></li><li class="dropdown-item"><!----> <a href="/doc-frontend/best-practice/" class="nav-link" data-v-e7cf42d2>最佳实践</a></li><li class="dropdown-item"><!----> <a href="/doc-frontend/arithmetic/QuickSort.html" class="nav-link" data-v-e7cf42d2>算法</a></li><li class="dropdown-item"><!----> <a href="/doc-tech3d/other/" class="nav-link" data-v-e7cf42d2>其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">移动</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-mobile/start/" class="nav-link" data-v-e7cf42d2>入门手册</a></li><li class="dropdown-item"><!----> <a href="/doc-mobile/dataResource/sourceCodeLib.html" class="nav-link" data-v-e7cf42d2>数据资源</a></li><li class="dropdown-item"><!----> <a href="/doc-mobile/product/nativeApp.html" class="nav-link" data-v-e7cf42d2>产品分型</a></li><li class="dropdown-item"><!----> <a href="/doc-mobile/appStore/" class="nav-link" data-v-e7cf42d2>应用商店</a></li><li class="dropdown-item"><!----> <a href="/doc-mobile/other/designDocument.html" class="nav-link" data-v-e7cf42d2>其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">计算</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-calc3d/start/XinShouShouCe.html" class="nav-link" data-v-e7cf42d2>入门手册</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/gis/Base_ZBX_ZongJie.html" class="nav-link" data-v-e7cf42d2>GIS</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/database/Oracle_LostSysPassword.html" class="nav-link" data-v-e7cf42d2>数据库</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/language/" class="nav-link" data-v-e7cf42d2>开发语言</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/codelab/" class="nav-link" data-v-e7cf42d2>源码库</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/production/DDP_ArcGIS_BuShuShouCe.html" class="nav-link" data-v-e7cf42d2>产品</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/other/" class="nav-link" data-v-e7cf42d2>其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">后台</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-backend/start/" class="nav-link router-link-active" data-v-e7cf42d2>入门手册</a></li><li class="dropdown-item"><!----> <a href="/doc-backend/database/Mongoazyx.html" class="nav-link" data-v-e7cf42d2>数据库</a></li><li class="dropdown-item"><!----> <a href="/doc-backend/framework/Git.html" class="nav-link" data-v-e7cf42d2>开发基础</a></li><li class="dropdown-item"><!----> <a href="/doc-backend/production/" class="nav-link" data-v-e7cf42d2>产品</a></li><li class="dropdown-item"><!----> <a href="/doc-backend/other/" class="nav-link" data-v-e7cf42d2>其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">基础研发</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-base/dist-utils/API.html" class="nav-link" data-v-e7cf42d2>dist-utils</a></li><li class="dropdown-item"><!----> <a href="http://192.168.200.39:18088/EyeMapAPI/" target="_blank" rel="noopener noreferrer" class="nav-link" data-v-e7cf42d2>eyemap业务库</a></li><li class="dropdown-item"><!----> <a href="/doc-base/stylelint-config/" class="nav-link" data-v-e7cf42d2>stylelint-config</a></li></ul></div></div><div class="nav-item"><a href="/doc-share/SuperMap_Pipe3DStrategy.html" class="nav-link" data-v-e7cf42d2>分享</a></div><div class="nav-item"><a href="https://fellowtravellers.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link" data-v-e7cf42d2>社区</a></div><div class="nav-item"><a href="/doc-help/mdRule.html" class="nav-link" data-v-e7cf42d2>帮助</a></div></nav></div></div> <div class="con-redes-download"><a title="GitLab" href="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335/" target="_blank" rel="noopener noreferrer" class="repo-link flaticon-github"></a></div></header> <div class="sidebar-map"><div class="c-sidebar-map"><ul class="sidebar-links-map"><li><div class="sidebar-group first"><ul class="sidebar-group-items"><li><a href="/doc-backend/start/" aria-current="page" class="sidebar-link siderbar-map-item">快速入门</a></li><li><a href="/doc-backend/start/CodingStandard.html" class="sidebar-link siderbar-map-item">代码规范</a></li><li><a href="/doc-backend/start/IDEAInstruction.html" class="sidebar-link siderbar-map-item">IDEA 使用说明</a></li><li><a href="/doc-backend/start/p3c.html" aria-current="page" class="active sidebar-link siderbar-map-item">p3c规范</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#引言" class="sidebar-link siderbar-map-item">引言</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_1、命名风格" class="sidebar-link siderbar-map-item">1、命名风格</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_2、常量定义" class="sidebar-link siderbar-map-item">2、常量定义</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_3、代码格式" class="sidebar-link siderbar-map-item">3、代码格式</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_4、oop-规约" class="sidebar-link siderbar-map-item">4、OOP 规约</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_5、集合处理" class="sidebar-link siderbar-map-item">5、集合处理</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_6、并发处理" class="sidebar-link siderbar-map-item">6、并发处理</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_7、控制语句" class="sidebar-link siderbar-map-item">7、控制语句</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_0、错误码" class="sidebar-link siderbar-map-item">0、错误码</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_1、异常处理" class="sidebar-link siderbar-map-item">1、异常处理</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_2、日志规约" class="sidebar-link siderbar-map-item">2、日志规约</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_1、建表规约" class="sidebar-link siderbar-map-item">1、建表规约</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_2、索引规约" class="sidebar-link siderbar-map-item">2、索引规约</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_3、sql-语句" class="sidebar-link siderbar-map-item">3、SQL 语句</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_4、orm-映射" class="sidebar-link siderbar-map-item">4、ORM 映射</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_1、应用分层" class="sidebar-link siderbar-map-item">1、应用分层</a></li></ul></li></ul></div></li></ul> </div></div> <div class="sidebar"><div class="c-sidebar"> <div class="search-box"><input aria-label="Search" placeholder="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>入门手册</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/doc-backend/start/" aria-current="page" class="sidebar-link">快速入门</a></li><li><a href="/doc-backend/start/CodingStandard.html" class="sidebar-link">代码规范</a></li><li><a href="/doc-backend/start/IDEAInstruction.html" class="sidebar-link">IDEA 使用说明</a></li><li><a href="/doc-backend/start/p3c.html" aria-current="page" class="active sidebar-link">p3c规范</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#引言" class="sidebar-link">引言</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_1、命名风格" class="sidebar-link">1、命名风格</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_2、常量定义" class="sidebar-link">2、常量定义</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_3、代码格式" class="sidebar-link">3、代码格式</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_4、oop-规约" class="sidebar-link">4、OOP 规约</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_5、集合处理" class="sidebar-link">5、集合处理</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_6、并发处理" class="sidebar-link">6、并发处理</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_7、控制语句" class="sidebar-link">7、控制语句</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_0、错误码" class="sidebar-link">0、错误码</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_1、异常处理" class="sidebar-link">1、异常处理</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_2、日志规约" class="sidebar-link">2、日志规约</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_1、建表规约" class="sidebar-link">1、建表规约</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_2、索引规约" class="sidebar-link">2、索引规约</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_3、sql-语句" class="sidebar-link">3、SQL 语句</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_4、orm-映射" class="sidebar-link">4、ORM 映射</a></li><li class="sidebar-sub-header"><a href="/doc-backend/start/p3c.html#_1、应用分层" class="sidebar-link">1、应用分层</a></li></ul></li></ul></div></li></ul> </div></div> <!----> <!----> <div class="page"><div class="content-pagex content content__default"><h2 id="引言"><a href="#引言" class="header-anchor">#</a> 引言</h2> <blockquote><p>离娄之明，公输子之巧，不以规矩，不能成方圆。 —— 战国·邹·孟轲《孟子·离娄上》</p></blockquote> <h1 id="一、编程规约"><a href="#一、编程规约" class="header-anchor">#</a> 一、编程规约</h1> <h2 id="_1、命名风格"><a href="#_1、命名风格" class="header-anchor">#</a> 1、命名风格</h2> <h3 id="_1-1-如果模块、接口、类、方法使用了设计模式，在命名时体现出具体模式。"><a href="#_1-1-如果模块、接口、类、方法使用了设计模式，在命名时体现出具体模式。" class="header-anchor">#</a> 1.1 如果模块、接口、类、方法使用了设计模式，在命名时体现出具体模式。</h3> <h3 id="_1-2-jdk8-中接口允许有默认实现，那么这个-default-方法，是对所有实现类都有价值的默认实现"><a href="#_1-2-jdk8-中接口允许有默认实现，那么这个-default-方法，是对所有实现类都有价值的默认实现" class="header-anchor">#</a> 1.2 JDK8 中接口允许有默认实现，那么这个 default 方法，是对<strong>所有实现类</strong>都有价值的默认实现</h3> <h3 id="_1-3-实体与方法命名规范："><a href="#_1-3-实体与方法命名规范：" class="header-anchor">#</a> 1.3 实体与方法命名规范：</h3> <p>A) Service/DAO 层方法命名规约</p> <ul><li>1、获取单个对象的方法用 get 作前缀。</li> <li>2、获取多个对象的方法用 list 作前缀。</li> <li>3、获取统计值的方法用 count 作前缀。</li> <li>4、插入的方法用 save/insert 作前缀。</li> <li>5、删除的方法用 remove/delete 作前缀。</li> <li>6、修改的方法用 update 作前缀。</li></ul> <p>B) 领域模型命名规约</p> <ul><li>1、数据对象:xxxDO，xxx 即为数据表名。</li> <li>2、数据传输对象:xxxDTO，xxx 为业务领域相关的名称。</li> <li>3、展示对象:xxxVO，xxx 一般为网页名称。</li> <li>4、POJO 是 DO/DTO/BO/VO 的统称，禁止命名成 xxxPOJO。</li></ul> <h3 id="_1-4-pojo-类中的任何布尔类型的变量，都不要加-is-前缀，否则部分框架解析会引起序列-化错误。"><a href="#_1-4-pojo-类中的任何布尔类型的变量，都不要加-is-前缀，否则部分框架解析会引起序列-化错误。" class="header-anchor">#</a> 1.4 POJO 类中的任何布尔类型的变量，都不要加 is 前缀，否则部分框架解析会引起序列 化错误。</h3> <p>反例：定义为基本数据类型 Boolean isDeleted 的属性，它的方法也是 isDeleted()，框架在反向解析的时“误以为”对应的属性名称是 deleted，导致属性获取不到，进而抛出异常。</p> <h3 id="_1-5-避免在父子类中定义相同命名的变量，会降低可读性"><a href="#_1-5-避免在父子类中定义相同命名的变量，会降低可读性" class="header-anchor">#</a> 1.5 避免在父子类中定义相同命名的变量，会降低可读性</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfusingName</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> stock<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">ConfusingName</span> <span class="token punctuation">{</span>
    <span class="token comment">// 不允许与父类的成员变量名称相同</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> stock<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_1-6-避免在一个方法中的不同代码块中采用相同命名的变量"><a href="#_1-6-避免在一个方法中的不同代码块中采用相同命名的变量" class="header-anchor">#</a> 1.6 避免在一个方法中的不同代码块中采用相同命名的变量</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> alibaba<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> money <span class="token operator">=</span> <span class="token number">666</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 在同一方法体中，不允许与其它代码块中的 money 命名相同</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> money <span class="token operator">=</span> <span class="token number">15978</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_1-7-在常量与变量的命名时，表示类型的名词放在词尾，以提升辨识度。"><a href="#_1-7-在常量与变量的命名时，表示类型的名词放在词尾，以提升辨识度。" class="header-anchor">#</a> 1.7 在常量与变量的命名时，表示类型的名词放在词尾，以提升辨识度。</h3> <p>正例:startTime / workQueue / nameList / TERMINATED_THREAD_COUNT</p> <p>反例:startedAt / QueueOfWork / listName / COUNT_TERMINATED_THREAD</p> <h2 id="_2、常量定义"><a href="#_2、常量定义" class="header-anchor">#</a> 2、常量定义</h2> <h3 id="_2-1-不要使用一个常量类维护所有常量，按常量功能进行归类，分开维护。"><a href="#_2-1-不要使用一个常量类维护所有常量，按常量功能进行归类，分开维护。" class="header-anchor">#</a> 2.1 不要使用一个常量类维护所有常量，按常量功能进行归类，分开维护。</h3> <p>大而全的常量类，非得使用查找功能才能定位到修改的常量，<strong>不利于理解和维护</strong>。</p> <p>正例:缓存相关常量放在类 CacheConsts 下;系统配置相关常量放在类 ConfigConsts 下。</p> <h3 id="_2-2-常量的复用层次有五层-跨应用共享常量、应用内共享常量、子工程内共享常量、包-内共享常量、类内共享常量。"><a href="#_2-2-常量的复用层次有五层-跨应用共享常量、应用内共享常量、子工程内共享常量、包-内共享常量、类内共享常量。" class="header-anchor">#</a> 2.2 常量的复用层次有五层:跨应用共享常量、应用内共享常量、子工程内共享常量、包 内共享常量、类内共享常量。</h3> <ul><li>1、跨应用共享常量:放置在二方库中（通用模块），通常是 client.jar 中的 constant 目录下。</li> <li>2、应用内共享常量（应用间通用）:放置在一方库（base 包）中，通常是子模块中的 constant 目录下。</li> <li>3、子工程内部共享常量:即在当前子工程的 constant 目录下。</li> <li>4、包内共享常量:即在当前包下单独的 constant 目录下。</li> <li>5、类内共享常量:直接在类内部 private static final 定义。</li></ul> <h3 id="_2-3-如果变量值仅在一个固定范围内变化用-enum-类型来定义。"><a href="#_2-3-如果变量值仅在一个固定范围内变化用-enum-类型来定义。" class="header-anchor">#</a> 2.3 如果变量值仅在一个固定范围内变化用 enum 类型来定义。</h3> <p>春夏秋冬</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">SeasonEnum</span> <span class="token punctuation">{</span>
   <span class="token function">SPRING</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token function">SUMMER</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token function">AUTUMN</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token function">WINTER</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">int</span> seq<span class="token punctuation">;</span>
   <span class="token class-name">SeasonEnum</span><span class="token punctuation">(</span><span class="token keyword">int</span> seq<span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>seq <span class="token operator">=</span> seq<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_2-4-不允许任何魔法值-即未经预先定义的常量-直接出现在代码中。"><a href="#_2-4-不允许任何魔法值-即未经预先定义的常量-直接出现在代码中。" class="header-anchor">#</a> 2.4 不允许任何魔法值(即未经预先定义的常量)直接出现在代码中。</h3> <h2 id="_3、代码格式"><a href="#_3、代码格式" class="header-anchor">#</a> 3、代码格式</h2> <h3 id="_3-1-单行字符数限制不超过-120-个，超出需要换行"><a href="#_3-1-单行字符数限制不超过-120-个，超出需要换行" class="header-anchor">#</a> 3.1 单行字符数限制不超过 120 个，超出需要换行</h3> <ul><li>1、方法调用的点符号与下文一起换行。</li> <li>2、方法调用时，多个参数，需要换行时，在逗号后进行。</li></ul> <h3 id="_3-2-不同逻辑、不同语义、不同业务的代码之间插入一个空行分隔开来以提升可读性。"><a href="#_3-2-不同逻辑、不同语义、不同业务的代码之间插入一个空行分隔开来以提升可读性。" class="header-anchor">#</a> 3.2 不同逻辑、不同语义、不同业务的代码之间插入<strong>一个</strong>空行分隔开来以提升可读性。</h3> <h2 id="_4、oop-规约"><a href="#_4、oop-规约" class="header-anchor">#</a> 4、OOP 规约</h2> <h3 id="_4-1-接口过时必须加-deprecated-注解，并清晰地说明采用的新接口或者新服务是什么。"><a href="#_4-1-接口过时必须加-deprecated-注解，并清晰地说明采用的新接口或者新服务是什么。" class="header-anchor">#</a> 4.1 接口过时必须加@Deprecated 注解，并清晰地说明采用的新接口或者新服务是什么。</h3> <h3 id="_4-2-object-的-equals-方法容易抛空指针异常，应使用常量或确定有值的对象来调用-equals。"><a href="#_4-2-object-的-equals-方法容易抛空指针异常，应使用常量或确定有值的对象来调用-equals。" class="header-anchor">#</a> 4.2 Object 的 equals 方法容易抛空指针异常，应使用常量或确定有值的对象来调用 equals。</h3> <p>正例:&quot;test&quot;.equals(object);</p> <p>反例:object.equals(&quot;test&quot;);</p> <p>说明:推荐使用 <code>java.util.Objects#equals</code>(JDK7 引入的工具类)</p> <h3 id="_4-3-包装类对象之间值的比较，全部使用-equals-方法比较。"><a href="#_4-3-包装类对象之间值的比较，全部使用-equals-方法比较。" class="header-anchor">#</a> 4.3 包装类对象之间值的比较，全部使用 equals 方法比较。</h3> <p>注：浮点类型除外</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">float</span> a <span class="token operator">=</span> <span class="token number">1.0f</span> <span class="token operator">-</span> <span class="token number">0.9f</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> b <span class="token operator">=</span> <span class="token number">0.9f</span> <span class="token operator">-</span> <span class="token number">0.8f</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 预期进入此代码快，执行其它业务逻辑</span>
    <span class="token comment">// 但事实上 a==b 的结果为 false</span>
<span class="token punctuation">}</span>

<span class="token class-name">Float</span> x <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Float</span> y <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 预期进入此代码快，执行其它业务逻辑</span>
    <span class="token comment">// 但事实上 equals 的结果为 false</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_4-4-定义-do-dto-vo-等-pojo-类时，不要设定任何属性默认值。"><a href="#_4-4-定义-do-dto-vo-等-pojo-类时，不要设定任何属性默认值。" class="header-anchor">#</a> 4.4 定义 DO/DTO/VO 等 POJO 类时，不要设定任何属性默认值。</h3> <p>反例:POJO 类的 gmtCreate 默认值为 new Date();但是这个属性在数据提取时并没有置入具体值，在更新其它字段时又<strong>附带更新了此字段</strong>，导致创建时间被修改成当前时间。</p> <h3 id="_4-5-构造方法里面禁止加入任何业务逻辑，如果有初始化逻辑，请放在-init-方法中"><a href="#_4-5-构造方法里面禁止加入任何业务逻辑，如果有初始化逻辑，请放在-init-方法中" class="header-anchor">#</a> 4.5 构造方法里面禁止加入任何业务逻辑，如果有初始化逻辑，请放在 init 方法中</h3> <h3 id="_4-6-pojo-类必须写-tostring-方法。如果继承了另一个-pojo-类，注意在前面加一下-super-tostring。"><a href="#_4-6-pojo-类必须写-tostring-方法。如果继承了另一个-pojo-类，注意在前面加一下-super-tostring。" class="header-anchor">#</a> 4.6 POJO 类必须写 toString 方法。如果继承了另一个 POJO 类，注意在前面加一下 super.toString。</h3> <p>说明:在方法执行抛出异常时，可以直接调用 POJO 的 toString()方法打印其属性值，便于排 查问题。</p> <h3 id="_4-7-类内方法定义的顺序依次是-公有方法或保护方法-私有方法-getter-setter-方法。"><a href="#_4-7-类内方法定义的顺序依次是-公有方法或保护方法-私有方法-getter-setter-方法。" class="header-anchor">#</a> 4.7 类内方法定义的顺序依次是:公有方法或保护方法 &gt; 私有方法 &gt; getter/setter 方法。</h3> <p>说明:<strong>公有方法是类的调用者和维护者最关心的方法</strong>，首屏展示最好;保护方法虽然只是子类关心，也可能是“模板设计模式”下的核心方法;而私有方法外部一般不需要特别关心，是一个黑盒实现;因为承载的信息价值较低，所有 Service 和 DAO 的 getter/setter 方法放在类体最后。</p> <p>不过也可以学习 jdk 的源码，将私有/受保护方法放到第一个使用到这个方法的方法下面。</p> <h3 id="_4-8-setter-方法中，参数名称与类成员变量名称一致，this-成员名-参数名。在-getter-setter-方法中，不要增加业务逻辑，增加排查问题的难度。"><a href="#_4-8-setter-方法中，参数名称与类成员变量名称一致，this-成员名-参数名。在-getter-setter-方法中，不要增加业务逻辑，增加排查问题的难度。" class="header-anchor">#</a> 4.8 setter 方法中，参数名称与类成员变量名称一致，this.成员名 = 参数名。在 getter/setter 方法中，不要增加业务逻辑，增加排查问题的难度。</h3> <p>get/set 的目的是将变量封装起来，按照上面说的，你可能会觉得直接 obj.变量名获取或设置值不就好了吗，但是有一种情况只允许 get 不许 set，比如：单例模式，构造的时候赋默认值</p> <h3 id="_4-9-循环体内，字符串的连接方式，使用-stringbuilder-的-append-方法进行扩展。"><a href="#_4-9-循环体内，字符串的连接方式，使用-stringbuilder-的-append-方法进行扩展。" class="header-anchor">#</a> 4.9 循环体内，字符串的连接方式，使用 StringBuilder 的 append 方法进行扩展。</h3> <p>说明:反编译出的字节码文件显示每次循环都会 new 出一个 StringBuilder 对象，然后进行 append 操作，最后通过 toString 方法返回 String 对象，造成内存资源浪费。</p> <p>String a = &quot;abc&quot; + &quot;bcd&quot; + &quot;efg&quot; 会创建出 5 个对象</p> <h3 id="_4-10-final-可以声明类、成员变量、方法、以及本地变量，下列情况使用-final-关键字"><a href="#_4-10-final-可以声明类、成员变量、方法、以及本地变量，下列情况使用-final-关键字" class="header-anchor">#</a> 4.10 final 可以声明类、成员变量、方法、以及本地变量，下列情况使用 final 关键字:</h3> <ul><li>1、不允许被继承的类，如:String 类。</li> <li>2、不允许修改引用的域对象，如:POJO 类的域变量。</li> <li>3、不允许被重写的方法，如:POJO 类的 setter 方法。</li> <li>4、不允许运行过程中重新赋值的局部变量。</li> <li>5、避免上下文重复使用一个变量，使用 final 描述可以强制重新定义一个变量，方便更好 地进行重构。</li></ul> <p>eg1. 由于 String 中的 char[]是 final 的，所以 b 创建好了之后，a 再修改不会导致 b 修改</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> a <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span>
<span class="token class-name">String</span> b <span class="token operator">=</span> <span class="token string">&quot;123&quot;</span> <span class="token operator">+</span> a

a <span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span>
<span class="token function">sout</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>

<span class="token operator">&gt;&gt;</span> <span class="token number">123</span>a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>eg2. 被 final 修饰的不能修改引用的指针，但是可以修改指针指向的对象的数据</p> <p><img src="https://upload-images.jianshu.io/upload_images/13787512-dbaf80b94049825a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p> <h3 id="_4-11-什么时候使用静态变量和方法"><a href="#_4-11-什么时候使用静态变量和方法" class="header-anchor">#</a> 4.11 什么时候使用静态变量和方法</h3> <p>静态成员变量：当所有对象中的成员变量的数值相同时，此成员变量可以用 static 修饰</p> <p>静态方法：当一个函数中没有调用静态变量时，此方法可以用 static 修饰；否则，此方法不能用 static 修饰</p> <h3 id="_4-12-什么时候使用内部类"><a href="#_4-12-什么时候使用内部类" class="header-anchor">#</a> 4.12 什么时候使用内部类</h3> <ul><li>1、内部类方法可以访问该类定义所在作用域中的数据，包括被 private 修饰的私有数据</li> <li>2、内部类可以<strong>对同一包中的其他类</strong>隐藏起来</li> <li>3、内部类可以实现 java <strong>单继承</strong>的缺陷</li></ul> <p>使用：</p> <ul><li>1、一个类中的一些代码在这个类中和外部类都可以使用，可以使用内部类规范在一起</li> <li>2、新建线程的时候</li></ul> <h3 id="_4-13-避免通过一个类的对象引用访问此类的静态变量或静态方法，无谓增加编译器解析成-本，直接用类名来访问即可。"><a href="#_4-13-避免通过一个类的对象引用访问此类的静态变量或静态方法，无谓增加编译器解析成-本，直接用类名来访问即可。" class="header-anchor">#</a> 4.13 避免通过一个类的对象引用访问此类的静态变量或静态方法，无谓增加编译器解析成 本，直接用类名来访问即可。</h3> <h3 id="_4-14-关于基本数据类型与包装数据类型的使用标准如下"><a href="#_4-14-关于基本数据类型与包装数据类型的使用标准如下" class="header-anchor">#</a> 4.14 关于基本数据类型与包装数据类型的使用标准如下:</h3> <ol><li>【强制】所有的 POJO 类属性必须使用包装数据类型。</li> <li>【强制】RPC 方法的返回值和参数必须使用包装数据类型。</li> <li>【推荐】所有的局部变量使用基本数据类型。</li></ol> <h3 id="_4-15-定义-do-dto-vo-等-pojo-类时，不要设定任何属性默认值。"><a href="#_4-15-定义-do-dto-vo-等-pojo-类时，不要设定任何属性默认值。" class="header-anchor">#</a> 4.15 定义 DO/DTO/VO 等 POJO 类时，不要设定任何属性默认值。</h3> <p>反例：POJO 类的 createTime 默认值为 new Date()，但是这个属性在数据提取时并没有置入具体值，在 更新其它字段时又附带更新了此字段，导致创建时间被修改成当前时间。</p> <h3 id="_4-16-构造方法里面禁止加入任何业务逻辑，如果有初始化逻辑，请放在-init-方法中。"><a href="#_4-16-构造方法里面禁止加入任何业务逻辑，如果有初始化逻辑，请放在-init-方法中。" class="header-anchor">#</a> 4.16 构造方法里面禁止加入任何业务逻辑，如果有初始化逻辑，请放在 init 方法中。</h3> <p>Spring 0.9 版本中 BeanFactory 等代码的初始化逻辑全部写在构造方法中，看的时候心里全是 mmp，所以不要这样写了。</p> <h3 id="_4-17-getter-setter-方法中，不要增加业务逻辑，增加排查问题的难度。"><a href="#_4-17-getter-setter-方法中，不要增加业务逻辑，增加排查问题的难度。" class="header-anchor">#</a> 4.17 getter/setter 方法中，不要增加业务逻辑，增加排查问题的难度。</h3> <h2 id="_5、集合处理"><a href="#_5、集合处理" class="header-anchor">#</a> 5、集合处理</h2> <h3 id="_5-1-如果对象要放入-set-中或作为-map-的-key，那么要重写-hashcode-和-equals-方法"><a href="#_5-1-如果对象要放入-set-中或作为-map-的-key，那么要重写-hashcode-和-equals-方法" class="header-anchor">#</a> 5.1 如果对象要放入 Set 中或作为 Map 的 key，那么要重写 hashCode 和 equals 方法</h3> <p><a href="https://blog.csdn.net/javazejian/article/details/51348320" target="_blank" rel="noopener noreferrer">只要重写 equals，就必须重写 hashCode<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>== 是比较内存地址</p> <h3 id="_5-2-使用工具类-arrays-aslist-把数组转换成集合时，不能使用其修改集合相关的方法，它的-add-remove-clear-方法会抛出-unsupportedoperationexception-异常。"><a href="#_5-2-使用工具类-arrays-aslist-把数组转换成集合时，不能使用其修改集合相关的方法，它的-add-remove-clear-方法会抛出-unsupportedoperationexception-异常。" class="header-anchor">#</a> 5.2 使用工具类 Arrays.asList()把数组转换成集合时，不能使用其修改集合相关的方法，它的 add/remove/clear 方法会抛出 UnsupportedOperationException 异常。</h3> <p>说明:asList 的返回对象是一个 <strong>Arrays 内部类</strong>，并没有实现集合的修改方法。</p> <p>Arrays.asList 体现的是适配器模式，只是转换接口，<strong>后台的数据仍是数组</strong>。</p> <p><img src="https://upload-images.jianshu.io/upload_images/13787512-6bdea38097a52a5e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p> <p><img src="https://upload-images.jianshu.io/upload_images/13787512-2ae32abd35cbd774.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p> <h3 id="_5-3-泛型通配符-extends-t-来接收返回的数据，此写法的泛型集合不能使用-add-方-法，而-super-t-不能使用-get-方法，作为接口调用赋值时易出错。"><a href="#_5-3-泛型通配符-extends-t-来接收返回的数据，此写法的泛型集合不能使用-add-方-法，而-super-t-不能使用-get-方法，作为接口调用赋值时易出错。" class="header-anchor">#</a> 5.3 泛型通配符&lt;? extends T&gt;来接收返回的数据，此写法的泛型集合不能使用 add 方 法，而&lt;? super T&gt;不能使用 get 方法，作为接口调用赋值时易出错。</h3> <p>扩展说一下 PECS(Producer Extends Consumer Super)原则:</p> <ul><li>第一、频繁往外读取内 容的，适合用&lt;? extends T&gt;。</li> <li>第二、经常往里插入的，适合用&lt;? super T&gt;。</li></ul> <h3 id="_5-4-注意-map-类集合-k-v-能不能存储-null-值的情况"><a href="#_5-4-注意-map-类集合-k-v-能不能存储-null-值的情况" class="header-anchor">#</a> 5.4 注意 Map 类集合 K/V 能不能存储 null 值的情况</h3> <p><img src="https://upload-images.jianshu.io/upload_images/13787512-70caf2ceb808c41e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p> <p>jdk1.8 中聚合成 map 的方法</p> <p>Map&lt;String, String&gt; attribute = modelCalculationResults.stream().collect(Collectors.toMap(ModelCalculationResult::getKey, ModelCalculationResult::getValue));</p> <p>问题：由于调用的是 merge 方法，对 key、value 判空，所以 value 为空的时候会报错；若想装逼，可以使用下面的这种：
Map&lt;String, String&gt; attribute = modelCalculationResults.stream().collect(HashMap::new, (map, modelCalculationResult) -&gt; map.put(modelCalculationResult.getKey(), modelCalculationResult.getValue()), HashMap::putAll);</p> <h3 id="_5-5-不要在-foreach-循环里进行元素的-remove-add-操作。remove-元素请使用-iterator-方式。"><a href="#_5-5-不要在-foreach-循环里进行元素的-remove-add-操作。remove-元素请使用-iterator-方式。" class="header-anchor">#</a> 5.5 不要在 foreach 循环里进行元素的 remove/add 操作。remove 元素请使用 Iterator 方式。</h3> <p>Iterator 是工作在一个独立的线程中，并且拥有一个 mutex（互斥） 锁</p> <p><img src="https://upload-images.jianshu.io/upload_images/13787512-74b283417c59b222.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p> <p><img src="https://upload-images.jianshu.io/upload_images/13787512-ab2f9b4d68ade1a5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p> <p>问题：为什么下面这种方式不会抛出异常？</p> <p>答：因为移除的整好是倒数第二个元素；抛出异常的操作是在继续向下循环时调用<code>next方法</code>时抛出，而移除了倒数第二个元素，<code>hasNext方法</code>返回的 false，就不在向下循环了，从而不会抛出异常。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> objects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

objects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
objects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;x1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
objects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;x2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> object <span class="token operator">:</span> objects<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;object = &quot;</span> <span class="token operator">+</span> object<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>object<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;x1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        objects<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&quot;x1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_5-6-使用-entryset-遍历-map-类集合-kv，而不是-keyset-方式进行遍历。"><a href="#_5-6-使用-entryset-遍历-map-类集合-kv，而不是-keyset-方式进行遍历。" class="header-anchor">#</a> 5.6 使用 entrySet 遍历 Map 类集合 KV，而不是 keySet 方式进行遍历。</h3> <p>说明:keySet 其实是<strong>遍历了 2 次</strong>，一次是转为 Iterator 对象，另一次是从 hashMap 中取出 key 所对应的 value。而 entrySet 只是遍历了一次就把 key 和 value 都放到了 entry 中，效 率更高。如果是 JDK8，使用 Map.foreach 方法。
正例:values()返回的是 V 值集合，是一个 list 集合对象;keySet()返回的是 K 值集合，是 一个 Set 集合对象;entrySet()返回的是 K-V 值组合集合。</p> <h3 id="_5-7-集合的有序性（sort）和稳定性（order）"><a href="#_5-7-集合的有序性（sort）和稳定性（order）" class="header-anchor">#</a> 5.7 集合的有序性（sort）和稳定性（order）</h3> <p>集合的有序、无序是指插入元素时，保持插入的顺序性，也就是先插入的元素优先放入集合的前面部分。</p> <p>而排序是指插入元素后，集合中的元素是否自动排序。（例如升序排序）</p> <p>HashMap、 HashSet、 HashTable 等 基于哈希存储方式的集合是无序的。其它的集合都是有序的。</p> <p>而 TreeMap TreeSet 等集合是排序的。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">TreeSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> integers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

integers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
integers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
integers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
integers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

integers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>x <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;x = &quot;</span> <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">&gt;&gt;</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_5-8-在使用-collectors-tomap-方法时，要使用-3-个参数的那个方法。"><a href="#_5-8-在使用-collectors-tomap-方法时，要使用-3-个参数的那个方法。" class="header-anchor">#</a> 5.8 在使用 Collectors#toMap() 方法时，要使用 3 个参数的那个方法。</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 反例：</span>

<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> departments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token string">&quot;iERP&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;iERP&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;EIBU&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 抛出 IllegalStateException 异常</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>departments<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">hashCode</span><span class="token punctuation">,</span> str <span class="token operator">-&gt;</span> str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 正例：</span>
<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> departments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token string">&quot;iERP&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;iERP&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;EIBU&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>departments<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">hashCode</span><span class="token punctuation">,</span> str <span class="token operator">-&gt;</span> str<span class="token punctuation">,</span> <span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> v2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_5-9-在使用-collectors-tomap-方法时，记得对-value-判空，否则会报空指针"><a href="#_5-9-在使用-collectors-tomap-方法时，记得对-value-判空，否则会报空指针" class="header-anchor">#</a> 5.9 在使用 Collectors#toMap() 方法时，记得对 value 判空，否则会报空指针</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> attribute <span class="token operator">=</span> modelCalculationResults<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">ModelCalculationResult</span><span class="token operator">::</span><span class="token function">getKey</span><span class="token punctuation">,</span> <span class="token class-name">ModelCalculationResult</span><span class="token operator">::</span><span class="token function">getValue</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>问题：由于调用的是 merge 方法，对 key、value 判空，所以 value 为空的时候会报错；若想装逼，可以使用下面的这种：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> attribute <span class="token operator">=</span> modelCalculationResults<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>map<span class="token punctuation">,</span> modelCalculationResult<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>modelCalculationResult<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> modelCalculationResult<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">HashMap</span><span class="token operator">::</span><span class="token function">putAll</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注：null 可以做 key</p> <h3 id="_5-10-collections-类返回的对象，如-emptylist-singletonlist-等都是-immutable-list，不可对其进行添加或者删除元素的操作。"><a href="#_5-10-collections-类返回的对象，如-emptylist-singletonlist-等都是-immutable-list，不可对其进行添加或者删除元素的操作。" class="header-anchor">#</a> 5.10 Collections 类返回的对象，如:emptyList()/singletonList()等都是 immutable list，不可对其进行添加或者删除元素的操作。</h3> <p>反例：如果查询无结果，返回 Collections.emptyList()空集合对象，调用方一旦进行了添加元素的操作，就会触发 UnsupportedOperationException 异常。</p> <p>所以为空的话如果调用方可以对结果进行操作，那么还是返回 new ArrayList&lt;&gt;(0) 吧。</p> <h3 id="_5-11-对-list-sublist-方法返回的-sublist-对象进行操作，会对源-list-产生影响，反之一样。"><a href="#_5-11-对-list-sublist-方法返回的-sublist-对象进行操作，会对源-list-产生影响，反之一样。" class="header-anchor">#</a> 5.11 对 List#subList() 方法返回的 SubList 对象进行操作，会对源 List 产生影响，反之一样。</h3> <h3 id="_5-12-如果要将集合转为数组，必须使用-collection-toarray-t-array-方法"><a href="#_5-12-如果要将集合转为数组，必须使用-collection-toarray-t-array-方法" class="header-anchor">#</a> 5.12 如果要将集合转为数组，必须使用 Collection#toArray(T[] array) 方法</h3> <p>直接使用 toArray 无参方法存在问题，此方法返回值只能是 Object[]类，若强转其它类型数组将出现 ClassCastException 错误。</p> <h2 id="_6、并发处理"><a href="#_6、并发处理" class="header-anchor">#</a> 6、并发处理</h2> <h3 id="_6-1-创建线程或线程池时请指定有意义的线程名称，方便出错时回溯。"><a href="#_6-1-创建线程或线程池时请指定有意义的线程名称，方便出错时回溯。" class="header-anchor">#</a> 6.1 创建线程或线程池时请指定有意义的线程名称，方便出错时回溯。</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TimerTaskThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">TimerTaskThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;TimerTaskThread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_6-2-线程池不允许使用-executors-去创建，而是通过-threadpoolexecutor-的方式，这样的处理方式让写的同学更加明确线程池的运行规则，规避资源耗尽的风险。"><a href="#_6-2-线程池不允许使用-executors-去创建，而是通过-threadpoolexecutor-的方式，这样的处理方式让写的同学更加明确线程池的运行规则，规避资源耗尽的风险。" class="header-anchor">#</a> 6.2 线程池不允许使用 Executors 去创建，而是通过 ThreadPoolExecutor 的方式，这样的处理方式让写的同学更加明确线程池的运行规则，规避资源耗尽的风险。</h3> <p>说明:Executors 返回的线程池对象的弊端如下:</p> <p>1)FixedThreadPool 和 SingleThreadPool:</p> <ul><li><p>允许的请求队列长度为 Integer.MAX_VALUE，可能会堆积大量的请求，从而导致 OOM（Out Of Memory 内存溢出）。</p> <p>2)CachedThreadPool 和 ScheduledThreadPool:</p></li> <li><p>允许的创建线程数量为 Integer.MAX_VALUE，可能会创建大量的线程，从而导致 OOM。</p></li></ul> <h3 id="_6-3-simpledateformat-是线程不安全的类，一般不要定义为-static-变量，如果定义为-static，必须加锁，或者使用-dateutils-工具类。"><a href="#_6-3-simpledateformat-是线程不安全的类，一般不要定义为-static-变量，如果定义为-static，必须加锁，或者使用-dateutils-工具类。" class="header-anchor">#</a> 6.3 SimpleDateFormat 是线程不安全的类，一般不要定义为 static 变量，如果定义为 static，必须加锁，或者使用 DateUtils 工具类。</h3> <p>正例:注意线程安全，使用 DateUtils。亦推荐如下处理:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DateFormat</span><span class="token punctuation">&gt;</span></span> df <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DateFormat</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">DateFormat</span> <span class="token function">initialValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>说明:如果是 JDK8 的应用，可以使用 Instant 代替 Date，LocalDateTime 代替 Calendar， DateTimeFormatter 代替 SimpleDateFormat，官方给出的解释:线程安全且不可变（使用 final 修饰的）</p> <h3 id="_6-4-多线程并行处理定时任务时，timer-运行多个-timetask-时，只要其中之一没有捕获抛出的异常，其它任务便会自动终止运行，使用-scheduledexecutorservice-则没有这个问题。"><a href="#_6-4-多线程并行处理定时任务时，timer-运行多个-timetask-时，只要其中之一没有捕获抛出的异常，其它任务便会自动终止运行，使用-scheduledexecutorservice-则没有这个问题。" class="header-anchor">#</a> 6.4 多线程并行处理定时任务时，Timer 运行多个 TimeTask 时，只要其中之一没有捕获抛出的异常，其它任务便会自动终止运行，使用 ScheduledExecutorService 则没有这个问题。</h3> <h3 id="_6-5-双重检查锁实现单例"><a href="#_6-5-双重检查锁实现单例" class="header-anchor">#</a> 6.5 双重检查锁实现单例</h3> <blockquote><p>双重检查锁定模式首先验证锁定条件(第一次检查)，只有通过锁定条件验证才<strong>真正的进行加锁逻辑</strong>并再次验证条件(第二次检查)。 —— <a href="https://zh.wikipedia.org/wiki/%E5%8F%8C%E9%87%8D%E6%A3%80%E6%9F%A5%E9%94%81%E5%AE%9A%E6%A8%A1%E5%BC%8F" target="_blank" rel="noopener noreferrer">Wiki<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Helper</span> helper <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Helper</span> <span class="token function">getHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>helper <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>helper <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    helper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Helper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> helper<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// other functions and members...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>直觉上，这个算法看起来像是该问题的有效解决方案。然而，这一技术还有许多需要避免的细微问题。例如，考虑下面的事件序列：</p> <ul><li><ol><li>线程 A 发现变量没有被初始化, 然后它获取锁并开始变量的初始化。</li></ol></li> <li><ol start="2"><li>由于某些编程语言的语义，编译器生成的代码允许在线程 A 执行完变量的初始化之前，将变量<strong>指向部分初始化的对象</strong>。</li></ol></li> <li><ol start="3"><li>线程 B 发现共享变量已经被初始化，并返回变量。由于线程 B 确信变量已被初始化，它没有获取锁。如果在 A 完成初始化之前共享变量对 B 可见（这是由于<strong>A 没有完成初始化或者因为一些初始化的值还没有覆盖 B 使用的内存</strong>(缓存一致性)），程序很可能会崩溃。</li></ol></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token class-name">Helper</span> helper <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Helper</span> <span class="token function">getHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Helper</span> result <span class="token operator">=</span> helper<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                result <span class="token operator">=</span> helper<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    helper <span class="token operator">=</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Helper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// other functions and members...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="_7、控制语句"><a href="#_7、控制语句" class="header-anchor">#</a> 7、控制语句</h2> <h3 id="_7-1-在高并发场景中，避免使用-等于-判断作为中断或退出的条件。-说明-如果并发控制没有处理好，容易产生等值判断被-击穿-的情况，使用大于或小于的区间-判断条件来代替。"><a href="#_7-1-在高并发场景中，避免使用-等于-判断作为中断或退出的条件。-说明-如果并发控制没有处理好，容易产生等值判断被-击穿-的情况，使用大于或小于的区间-判断条件来代替。" class="header-anchor">#</a> 7.1 在高并发场景中，避免使用”等于”判断作为中断或退出的条件。 说明:如果并发控制没有处理好，容易产生等值判断被“击穿”的情况，使用大于或小于的区间 判断条件来代替。</h3> <p>反例:判断剩余奖品数量等于 0 时，终止发放奖品，但因为并发处理错误导致奖品数量瞬间变成了负数，这样的话，活动无法终止。</p> <h3 id="_7-2-循环体中的语句要考量性能，以下操作尽量移至循环体外处理："><a href="#_7-2-循环体中的语句要考量性能，以下操作尽量移至循环体外处理：" class="header-anchor">#</a> 7.2 循环体中的语句要考量性能，以下操作尽量移至循环体外处理：</h3> <p>如定义对象、变量、获取数据库连接，进行不必要的 <strong>try-catch 操作</strong>(这个 try-catch 是否可以移至循环体外)。</p> <h3 id="_7-3-下列情形，需要进行参数校验"><a href="#_7-3-下列情形，需要进行参数校验" class="header-anchor">#</a> 7.3 下列情形，需要进行参数校验:</h3> <ul><li>1、调用频次低的方法。</li> <li>2、执行时间开销很大的方法。此情形中，参数校验时间几乎可以忽略不计，但如果因为参
数错、误导致中间执行回退，或者错误，那得不偿失。</li> <li>3、需要极高稳定性和可用性的方法。</li> <li>4、对外提供的开放接口，不管是 RPC/API/HTTP 接口。</li> <li>5、敏感权限入口。</li></ul> <h3 id="_7-4-下列情形，不需要进行参数校验"><a href="#_7-4-下列情形，不需要进行参数校验" class="header-anchor">#</a> 7.4 下列情形，不需要进行参数校验:</h3> <ul><li>1、极有可能被<strong>循环调用</strong>的方法。但<strong>在方法说明里必须注明外部参数检查要求</strong>。</li> <li>2、底层调用频度比较高的方法。毕竟是像纯净水过滤的最后一道，<strong>参数错误不太可能到底层才会暴露</strong>问题。一般 DAO 层与 Service 层都在同一个应用中，部署在同一台服务器中，所以 <strong>DAO 的参数校验</strong>，可以省略。</li> <li>3、<strong>被声明成 private 只会被自己代码所调用的方法</strong>，如果能够确定调用方法的代码传入参 数已经做过检查或者肯定不会有问题，此时可以不校验参数。</li></ul> <h3 id="_7-5-三目运算符-condition-表达式-1-表达式-2-中，高度注意表达式-1-和-2-在类型对齐时，可能抛出因自动拆箱导致的-npe-异常。"><a href="#_7-5-三目运算符-condition-表达式-1-表达式-2-中，高度注意表达式-1-和-2-在类型对齐时，可能抛出因自动拆箱导致的-npe-异常。" class="header-anchor">#</a> 7.5 三目运算符 condition? 表达式 1 : 表达式 2 中，高度注意表达式 1 和 2 在类型对齐时，可能抛出因自动拆箱导致的 NPE 异常。</h3> <p>以下两种场景会触发类型对齐的拆箱操作:</p> <ol><li>表达式 1 或表达式 2 的值只要有一个是原始类型</li> <li>表达式 1 或表达式 2 的值的类型不一致，会强制拆箱升级成表示范围更大的那个类型。</li></ol> <p>反例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Integer</span> c <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token class-name">Integer</span> d <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> c<span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// NPE</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>因为表达式 1 是基本类型，会导致 c 进行拆箱，即调用 c.intValue();</p> <p><a href="https://juejin.im/post/5eb36b345188255fb4057099" target="_blank" rel="noopener noreferrer">详细解释<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_7-6-条件判断语句中不要写特别复杂的逻辑，且最好不用使用-运算符"><a href="#_7-6-条件判断语句中不要写特别复杂的逻辑，且最好不用使用-运算符" class="header-anchor">#</a> 7.6 条件判断语句中不要写特别复杂的逻辑，且最好不用使用 ! 运算符</h3> <h1 id="二、异常日志"><a href="#二、异常日志" class="header-anchor">#</a> 二、异常日志</h1> <h2 id="_0、错误码"><a href="#_0、错误码" class="header-anchor">#</a> 0、错误码</h2> <h3 id="_0-1-错误码为字符串类型，共-5-位，分成两个部分-错误产生来源-四位数字编号。"><a href="#_0-1-错误码为字符串类型，共-5-位，分成两个部分-错误产生来源-四位数字编号。" class="header-anchor">#</a> 0.1 错误码为字符串类型，共 5 位，分成两个部分:错误产生来源+四位数字编号。</h3> <p>说明:错误产生来源分为 A/B/C，A 表示错误来源于用户，比如参数错误，用户安装版本过低，用户支付 超时等问题;B 表示错误来源于当前系统，往往是业务逻辑出错，或程序健壮性差等问题;C 表示错误来源于第三方服务，比如 CDN 服务出错，消息投递超时等问题;四位数字编号从 0001 到 9999，大类之间的步长间距预留 100。</p> <h2 id="_1、异常处理"><a href="#_1、异常处理" class="header-anchor">#</a> 1、异常处理</h2> <h3 id="_1-1-捕获异常是为了处理它，不要捕获了却什么都不处理而抛弃之，如果不想处理它，请将该异常抛给它的调用者。最外层的业务使用者，必须处理异常，将其转化为用户可以理解的内容。"><a href="#_1-1-捕获异常是为了处理它，不要捕获了却什么都不处理而抛弃之，如果不想处理它，请将该异常抛给它的调用者。最外层的业务使用者，必须处理异常，将其转化为用户可以理解的内容。" class="header-anchor">#</a> 1.1 捕获异常是为了处理它，不要捕获了却什么都不处理而抛弃之，如果不想处理它，请将该异常抛给它的调用者。最外层的业务使用者，必须处理异常，将其转化为用户可以理解的内容。</h3> <h3 id="_1-2-finally-块必须对资源对象、流对象进行关闭，有异常也要做-try-catch。"><a href="#_1-2-finally-块必须对资源对象、流对象进行关闭，有异常也要做-try-catch。" class="header-anchor">#</a> 1.2 finally 块必须对资源对象、流对象进行关闭，有异常也要做 try-catch。</h3> <p>说明:如果 JDK7 及以上，可以使用 try-with-resources 方式。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;{}的文件流获取成功！&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> inputStream<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;获取流失败,{}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_1-3-不要在-finally-块中使用-return。"><a href="#_1-3-不要在-finally-块中使用-return。" class="header-anchor">#</a> 1.3 不要在 finally 块中使用 return。</h3> <p>说明:finally 块中的 return 返回后方法结束执行，<strong>不会再执行 try 块中的 return 语句</strong>。</p> <h3 id="_1-4-方法的返回值可以为-null，不强制返回空集合，或者空对象等，必须添加注释充分说明什么情况下会返回-null-值。"><a href="#_1-4-方法的返回值可以为-null，不强制返回空集合，或者空对象等，必须添加注释充分说明什么情况下会返回-null-值。" class="header-anchor">#</a> 1.4 方法的返回值可以为 null，不强制返回空集合，或者空对象等，必须添加注释充分说明什么情况下会返回 null 值。</h3> <h3 id="_1-5-对于公司外的-http-api-开放接口必须使用-错误码-而应用内部推荐异常抛出-跨应用间-rpc-调用优先考虑使用-result-方式，封装-issuccess-方法、-错误码-、-错误简短信息-。"><a href="#_1-5-对于公司外的-http-api-开放接口必须使用-错误码-而应用内部推荐异常抛出-跨应用间-rpc-调用优先考虑使用-result-方式，封装-issuccess-方法、-错误码-、-错误简短信息-。" class="header-anchor">#</a> 1.5 对于公司外的 http/api 开放接口必须使用“错误码”;而应用内部推荐异常抛出; 跨应用间 RPC 调用优先考虑使用 Result 方式，封装 isSuccess()方法、“错误码”、“错误简短信息”。</h3> <p>说明:关于 RPC 方法返回方式使用 Result 方式的理由:</p> <ul><li>1、使用抛异常返回方式，调用方如果没有捕获到就会产生运行时错误。</li> <li>2、如果不加栈信息，只是 new 自定义异常，加入自己的理解的 error message，对于调用 端解决问题的帮助不会太多。如果加了栈信息，在频繁调用出错的情况下，数据序列化和传输 的性能损耗也是问题。</li></ul> <h2 id="_2、日志规约"><a href="#_2、日志规约" class="header-anchor">#</a> 2、日志规约</h2> <h3 id="_2-1-应用中的扩展日志-如打点、临时监控、访问日志等-命名方式"><a href="#_2-1-应用中的扩展日志-如打点、临时监控、访问日志等-命名方式" class="header-anchor">#</a> 2.1 应用中的扩展日志(如打点、临时监控、访问日志等)命名方式:</h3> <p>appName_logType_logName.log。</p> <ul><li>logType:日志类型，推荐分类有 stats/monitor/visit 等;</li> <li>logName:日志描述。这种命名的好处:通过文件名就可知道日志文件属于什么应用，什么类型，什么目的，也有利于归类查找。</li></ul> <p>正例:mppserver 应用中单独监控时区转换异常，如:</p> <p>mppserver_monitor_timeZoneConvert.log 说明:推荐对日志进行分类，如将错误日志和业务日志分开存放，便于开发人员查看，也便于通过日志对系统进行及时监控。</p> <h3 id="_2-2-异常信息应该包括两类信息-案发现场信息和异常堆栈信息。如果不处理，那么通过关键字-throws-往上抛出。"><a href="#_2-2-异常信息应该包括两类信息-案发现场信息和异常堆栈信息。如果不处理，那么通过关键字-throws-往上抛出。" class="header-anchor">#</a> 2.2 异常信息应该包括两类信息:案发现场信息和异常堆栈信息。如果不处理，那么通过关键字 throws 往上抛出。</h3> <p>正例:logger.error(各类参数或者对象 toString + &quot;_&quot; + e.getMessage(), e);</p> <h3 id="_2-3-谨慎地记录日志。生产环境禁止输出-debug-日志-有选择地输出-info-日志-如果使用-warn-来记录刚上线时的业务行为信息，一定要注意日志输出量的问题，避免把服务器磁盘撑爆，并记得及时删除这些观察日志。"><a href="#_2-3-谨慎地记录日志。生产环境禁止输出-debug-日志-有选择地输出-info-日志-如果使用-warn-来记录刚上线时的业务行为信息，一定要注意日志输出量的问题，避免把服务器磁盘撑爆，并记得及时删除这些观察日志。" class="header-anchor">#</a> 2.3 谨慎地记录日志。生产环境禁止输出 debug 日志;有选择地输出 info 日志;如果使用 warn 来记录刚上线时的业务行为信息，一定要注意日志输出量的问题，避免把服务器磁盘撑爆，并记得及时删除这些观察日志。</h3> <p>说明:大量地输出无效日志，不利于系统性能提升，也不利于快速定位错误点。记录日志时请</p> <p>思考:这些日志真的有人看吗?看到这条日志你能做什么?能不能给问题排查带来好处?</p> <h3 id="_2-4-可以使用-warn-日志级别来记录用户输入参数错误的情况，避免用户投诉时，无所适从。如非必要，请不要在此场景打出-error-级别，避免频繁报警。"><a href="#_2-4-可以使用-warn-日志级别来记录用户输入参数错误的情况，避免用户投诉时，无所适从。如非必要，请不要在此场景打出-error-级别，避免频繁报警。" class="header-anchor">#</a> 2.4 可以使用 warn 日志级别来记录用户输入参数错误的情况，避免用户投诉时，无所适从。如非必要，请不要在此场景打出 error 级别，避免频繁报警。</h3> <p>说明:注意日志输出的级别，error 级别只记录系统逻辑出错、异常或者重要的错误信息。</p> <h3 id="_2-5-日志打印时禁止直接用-json-工具将对象转换成-string"><a href="#_2-5-日志打印时禁止直接用-json-工具将对象转换成-string" class="header-anchor">#</a> 2.5 日志打印时禁止直接用 JSON 工具将对象转换成 String</h3> <p>打印日志时仅打印出业务相关属性值或者调用其对象的 toString()方法。</p> <h1 id="三、单元测试"><a href="#三、单元测试" class="header-anchor">#</a> 三、单元测试</h1> <p>优秀的单元测试</p> <p>(1)单元测试是“白盒测试”，应该覆盖各个分支流程、异常条件。（所以他会促进我们使用设计模式，而不是一堆 if/else）</p> <p>(2)单元测试面向的是一个单元(Unit)，是由 Java 中的一个类或者几个类组成的单元。</p> <p>(3)单元测试的运行速度一定要快!</p> <p>(4)单元测试一定是可重复执行的!</p> <p>(5)单元测试之间不能有相互依赖，应该是独立的!</p> <p>(6)单元测试代码和业务代码同等重要，要一并维护!</p> <h1 id="四、安全规约"><a href="#四、安全规约" class="header-anchor">#</a> 四、安全规约</h1> <p>略</p> <h1 id="五、mysql-数据库"><a href="#五、mysql-数据库" class="header-anchor">#</a> 五、MySQL 数据库</h1> <h2 id="_1、建表规约"><a href="#_1、建表规约" class="header-anchor">#</a> 1、建表规约</h2> <h3 id="_1-1-表达是与否概念的字段，必须使用-is-xxx-的方式命名，数据类型是-unsigned-tinyint-1-表示是，0-表示否-。"><a href="#_1-1-表达是与否概念的字段，必须使用-is-xxx-的方式命名，数据类型是-unsigned-tinyint-1-表示是，0-表示否-。" class="header-anchor">#</a> 1.1 表达是与否概念的字段，必须使用 is_xxx 的方式命名，数据类型是 unsigned tinyint (1 表示是，0 表示否)。</h3> <p>说明:任何字段如果为非负数，必须是 <strong>unsigned</strong>。</p> <p>正例:表达逻辑删除的字段名 is_deleted，1 表示删除，0 表示未删除。</p> <h3 id="_1-2-表名不使用复数名词。"><a href="#_1-2-表名不使用复数名词。" class="header-anchor">#</a> 1.2 表名不使用复数名词。</h3> <p>说明:表名应该仅仅<strong>表示表里面的实体内容</strong>，不应该表示实体数量，对应于 DO 类名也是单数 形式，符合表达习惯。</p> <h3 id="_1-3-主键索引名为-pk字段名-唯一索引名为-uk字段名-普通索引名则为-idx-字段名。"><a href="#_1-3-主键索引名为-pk字段名-唯一索引名为-uk字段名-普通索引名则为-idx-字段名。" class="header-anchor">#</a> 1.3 主键索引名为 pk<em>字段名;唯一索引名为 uk</em>字段名;普通索引名则为 idx_字段名。</h3> <p>说明:pk* 即 primary key;uk* 即 unique key;idx_ 即 index 的简称。</p> <h3 id="_1-4-小数类型为-decimal，禁止使用-float-和-double。"><a href="#_1-4-小数类型为-decimal，禁止使用-float-和-double。" class="header-anchor">#</a> 1.4 小数类型为 decimal，禁止使用 float 和 double。</h3> <p>说明:float 和 double 在存储的时候，存在精度损失的问题，很可能在值的比较时，得到不 正确的结果。如果存储的数据范围超过 decimal 的范围，建议将数据拆成整数和小数分开存储。</p> <p>也可以将单位设置的小一点（分）</p> <h3 id="_1-5-表必备三字段-id-gmt-create-gmt-modified。"><a href="#_1-5-表必备三字段-id-gmt-create-gmt-modified。" class="header-anchor">#</a> 1.5 表必备三字段:id, gmt_create, gmt_modified。</h3> <p>说明:其中 id 必为主键，类型为 unsigned bigint、单表时自增、步长为 1。gmt_create, gmt_modified 的类型均为 datetime 类型，前者现在时表示主动创建，后者过去分词表示被 动更新。</p> <h3 id="_1-6-表的命名最好是加上-业务名称-表的作用-。"><a href="#_1-6-表的命名最好是加上-业务名称-表的作用-。" class="header-anchor">#</a> 1.6 表的命名最好是加上“业务名称_表的作用”。</h3> <p>正例:alipay_task / force_project / trade_config</p> <h3 id="_1-7-字段允许适当冗余，以提高查询性能，但必须考虑数据一致。冗余字段应遵循"><a href="#_1-7-字段允许适当冗余，以提高查询性能，但必须考虑数据一致。冗余字段应遵循" class="header-anchor">#</a> 1.7 字段允许适当冗余，以提高查询性能，但必须考虑数据一致。冗余字段应遵循:</h3> <ul><li>1、不是频繁修改的字段。</li> <li>2、不是 varchar 超长字段，更不能是 text 字段。</li></ul> <p>正例:商品类目名称使用频率高，字段长度短，名称基本一成不变，可在相关联的表中冗余存 储类目名称，避免关联查询。</p> <h2 id="_2、索引规约"><a href="#_2、索引规约" class="header-anchor">#</a> 2、索引规约</h2> <h3 id="_2-1-业务上具有唯一特性的字段，即使是多个字段的组合，也必须建成唯一索引。"><a href="#_2-1-业务上具有唯一特性的字段，即使是多个字段的组合，也必须建成唯一索引。" class="header-anchor">#</a> 2.1 业务上具有唯一特性的字段，即使是多个字段的组合，也必须建成唯一索引。</h3> <p>说明:不要以为唯一索引影响了 insert/delete/update 的速度，这个速度损耗可以忽略，但提高查找速度是明显的;另外，即使在应用层做了非常完善的校验控制，只要没有唯一索引，根据墨菲定律（凡是可能出错的事就一定会出错），必然有脏数据产生。</p> <h3 id="_2-2-在-varchar-字段上建立索引时，必须指定索引长度，没必要对全字段建立索引，根据-实际文本区分度决定索引长度即可。"><a href="#_2-2-在-varchar-字段上建立索引时，必须指定索引长度，没必要对全字段建立索引，根据-实际文本区分度决定索引长度即可。" class="header-anchor">#</a> 2.2 在 varchar 字段上建立索引时，必须指定索引长度，没必要对全字段建立索引，根据 实际文本区分度决定索引长度即可。</h3> <p>说明:索引的长度与区分度是一对矛盾体，一般对字符串类型数据，长度为 20 的索引，区分度会高达 90%以上，可以使用 count(distinct left(列名, 索引长度))/count(*)的区分度来确定。</p> <p>索引就像字典一样；A 下面对应的一些单词，B 下面对应的一些单词...，而这个 ABC 再索引中就是它的长度，比如</p> <p>于 于佳 于佳鑫</p> <p>如果索引长度是 1 =&gt; 于:[于,于佳,于佳鑫]</p> <p>如果索引长度是 2 =&gt; 于:[于] 于佳: [于佳,于佳鑫]</p> <p>如果索引长度是 3 =&gt; 于:[于] 于佳: [于佳] 于佳鑫: [于佳鑫]</p> <p>以此类推，长度越长，查询速度越快（区分度越高），但是内存消耗也越高，所以要找一个平衡点。</p> <h3 id="_2-3-页面搜索严禁左模糊或者全模糊，如果需要请走搜索引擎来解决。"><a href="#_2-3-页面搜索严禁左模糊或者全模糊，如果需要请走搜索引擎来解决。" class="header-anchor">#</a> 2.3 页面搜索严禁左模糊或者全模糊，如果需要请走搜索引擎来解决。</h3> <p>说明:索引文件具有 <strong>B-Tree 的最左前缀匹配特性</strong>，如果左边的值未确定，那么无法使用此索引。</p> <h3 id="_2-4-如果有-order-by-的场景，请注意利用索引的有序性。"><a href="#_2-4-如果有-order-by-的场景，请注意利用索引的有序性。" class="header-anchor">#</a> 2.4 如果有 order by 的场景，请注意利用索引的<strong>有序性</strong>。</h3> <p>order by 最后的字段是<strong>组合索引</strong>的一部分，并且放在索引组合顺序的最后，避免出现 file_sort 的情况，影响查询性能。</p> <p>正例:</p> <p>where a=? and b=? order by c; 索引:a_b_c</p> <p>where a=? order by c</p> <p>反例:</p> <p>索引中有范围查找，那么索引有序性无法利用，如:WHERE a&gt;10 ORDER BY b; 索引 a_b 无法排序。</p> <p>where b=? order by c 由于最左原则不会使用索引</p> <h3 id="_2-5-利用延迟关联或者子查询优化超多分页场景。"><a href="#_2-5-利用延迟关联或者子查询优化超多分页场景。" class="header-anchor">#</a> 2.5 利用延迟关联或者子查询优化超多分页场景。</h3> <p>说明:MySQL 并不是跳过 offset 行，而是取 offset+N 行，然后返回放弃前 offset 行，返回 N 行，那当 offset 特别大的时候，效率就非常的低下，要么控制返回的总页数，要么对超过 特定阈值的页数进行 SQL 改写。</p> <p>正例:先快速定位需要获取的 id 段，然后再关联:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> a<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> 表 <span class="token number">1</span> a<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> id <span class="token keyword">from</span> 表 <span class="token number">1</span> <span class="token keyword">where</span> 条件 <span class="token keyword">LIMIT</span> <span class="token number">100000</span><span class="token punctuation">,</span><span class="token number">20</span> <span class="token punctuation">)</span> b <span class="token keyword">where</span> a<span class="token punctuation">.</span>id<span class="token operator">=</span>b<span class="token punctuation">.</span>id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-6-建组合索引的时候，区分度最高的在最左边。"><a href="#_2-6-建组合索引的时候，区分度最高的在最左边。" class="header-anchor">#</a> 2.6 建组合索引的时候，区分度最高的在最左边。</h3> <p>正例:如果 where a=? and b=? ，a 列的几乎接近于唯一值，那么只需要单建 idx_a 索引即 可。 说明:存在非等号和等号混合判断条件时，在建索引时，请把等号条件的列前置。如:where a&gt;? and b=? 那么即使 a 的区分度更高，也必须把 b 放在索引的最前列。</p> <h3 id="_2-7-创建索引时避免有如下极端误解"><a href="#_2-7-创建索引时避免有如下极端误解" class="header-anchor">#</a> 2.7 创建索引时避免有如下<strong>极端</strong>误解:</h3> <ul><li><ol><li>宁滥勿缺。认为一个查询就需要建一个索引。</li></ol></li> <li><ol start="2"><li>宁缺勿滥。认为索引会消耗空间、严重拖慢更新和新增速度。</li></ol></li> <li><ol start="3"><li>抵制惟一索引。认为业务的惟一性一律需要在应用层通过“先查后插”方式解决。</li></ol></li></ul> <h2 id="_3、sql-语句"><a href="#_3、sql-语句" class="header-anchor">#</a> 3、SQL 语句</h2> <h3 id="_3-1-不要使用-count-列名-或-count-常量-来替代-count-，count-是-sql92-定义的-标准统计行数的语法，跟数据库无关，跟-null-和非-null-无关。"><a href="#_3-1-不要使用-count-列名-或-count-常量-来替代-count-，count-是-sql92-定义的-标准统计行数的语法，跟数据库无关，跟-null-和非-null-无关。" class="header-anchor">#</a> 3.1 不要使用 count(列名)或 count(常量)来替代 count(<em>)，count(</em>)是 SQL92 定义的 标准统计行数的语法，跟数据库无关，跟 NULL 和非 NULL 无关。</h3> <p>说明:count(*)会统计值为 NULL 的行，而 count(列名)不会统计此列为 NULL 值的行。</p> <h3 id="_3-2-in-操作能避免则避免，若实在避免不了，需要仔细评估-in-后边的集合元素数量，控-制在-1000-个之内。"><a href="#_3-2-in-操作能避免则避免，若实在避免不了，需要仔细评估-in-后边的集合元素数量，控-制在-1000-个之内。" class="header-anchor">#</a> 3.2 in 操作能避免则避免，若实在避免不了，需要仔细评估 in 后边的集合元素数量，控 制在 1000 个之内。</h3> <h3 id="_3-3-数据订正-特别是删除、修改记录操作-时，要先-select，避免出现误删除，确认无误才能执行更新语句。"><a href="#_3-3-数据订正-特别是删除、修改记录操作-时，要先-select，避免出现误删除，确认无误才能执行更新语句。" class="header-anchor">#</a> 3.3 数据订正(特别是删除、修改记录操作)时，要先 select，避免出现误删除，确认无误才能执行更新语句。</h3> <h2 id="_4、orm-映射"><a href="#_4、orm-映射" class="header-anchor">#</a> 4、ORM 映射</h2> <p>由于讲的是 mybatis，日后再补</p> <p>不要写一个大而全的数据更新接口。传入为 POJO 类，不管是不是自己的目标更新字段，都进行 update table set c1=value1,c2=value2,c3=value3; 这是不对的。执行 SQL 时，不要更新无改动的字段，一是易出错;二是效率低;三是增加 binlog 存储。</p> <h1 id="六、工程结构"><a href="#六、工程结构" class="header-anchor">#</a> 六、工程结构</h1> <h2 id="_1、应用分层"><a href="#_1、应用分层" class="header-anchor">#</a> 1、应用分层</h2> <h3 id="_1-1-图中默认上层依赖于下层，箭头关系表示可直接依赖，如-开放接口层可以依赖于-web-层，也可以直接依赖于-service-层，依此类推"><a href="#_1-1-图中默认上层依赖于下层，箭头关系表示可直接依赖，如-开放接口层可以依赖于-web-层，也可以直接依赖于-service-层，依此类推" class="header-anchor">#</a> 1.1 图中默认上层依赖于下层，箭头关系表示可直接依赖，如:开放接口层可以依赖于 Web 层，也可以直接依赖于 Service 层，依此类推:</h3> <p><img src="https://upload-images.jianshu.io/upload_images/13787512-0336fb19601ef68a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p> <ul><li>开放接口层:可<strong>直接封装 Service 层方法暴露的 RPC 接口</strong>;通过 Web 封装成 http 接口;进行 网关安全控制、流量控制等。</li> <li>终端显示层:各个端的模板渲染并执行显示的层。当前主要是 velocity 渲染，JS 渲染， JSP 渲染，移动端展示等。</li> <li>Web 层:主要是对访问控制进行转发，各类基本参数校验，或者不复用的业务简单处理等。</li> <li>Service 层:<strong>相对具体</strong>的业务逻辑服务层。</li> <li>Manager 层:通用业务处理层，它有如下特征:（我们的 remote 包+ 我们的 service 层部分功能下降）
<ul><li><ol><li>对<strong>第三方平台封装的层</strong>，预处理返回结果及转化异常信息;</li></ol></li> <li><ol start="2"><li><strong>对 Service 层通用能力的下沉，如缓存方案、中间件通用处理;</strong></li></ol></li> <li><ol start="3"><li>与 DAO 层交互，对多个 DAO 的组合复用。</li></ol></li></ul></li> <li>DAO 层:数据访问层，与底层 MySQL、Oracle、Hbase 等进行数据交互。（我们的 dmn 层）</li> <li>外部接口或第三方平台:包括其它部门 RPC 开放接口，基础平台，其它公司的 HTTP 接口。（模型、指标、档案系统</li></ul> <h3 id="_1-2-分层领域模型规约"><a href="#_1-2-分层领域模型规约" class="header-anchor">#</a> 1.2 分层领域模型规约:</h3> <ul><li>DO(Data Object):<strong>与数据库表结构一一对应</strong>，通过 DAO 层向上传输数据源对象。</li> <li>DTO(Data Transfer Object):数据传输对象，<strong>Service 或 Manager 向外传输的对象</strong>。</li> <li>BO(Business Object):业务对象。由 Service 层输出的封装业务逻辑的对象。</li> <li>AO(ApplicationObject):应用对象。在 Web 层与 Service 层之间抽象的复用对象模型， 极为贴近展示层，复用度不高。</li> <li>VO(View Object):显示层对象，通常是 Web 向模板渲染引擎层传输的对象。</li> <li>Query:数据查询对象，<strong>各层接收上层的查询请求</strong>。注意超过 2 个参数的查询封装，禁止
使用 Map 类来传输。</li></ul> <p>。。。</p></div> <div class="content edit-link"><a href="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335/edit/master/docs/doc-backend/start/p3c.md" target="_blank" rel="noopener noreferrer">
      编辑此页面
    </a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="content page-nav"><p class="inner"><span class="prev"><a href="/doc-backend/start/IDEAInstruction.html" class="prev">&lt; IDEA 使用说明</a></span> <!----></p></div> <div class="footer">数据中心 研发二部</div></div></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.16cdc938.js" defer></script><script src="/assets/js/3.4f14b16d.js" defer></script><script src="/assets/js/1.02cf7ae9.js" defer></script><script src="/assets/js/55.368817a9.js" defer></script>
  </body>
</html>
