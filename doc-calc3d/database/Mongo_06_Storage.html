<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mongo 存储文件—GridFS | Fellow Travellers</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/assets/img/favicon.ico">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <meta name="description" content="Fellow-Travellers documents for tech3D / mobile / calc / back-end">
    <link rel="preload" href="/assets/css/0.styles.d4a3a82a.css" as="style"><link rel="preload" href="/assets/js/app.16cdc938.js" as="script"><link rel="preload" href="/assets/js/3.4f14b16d.js" as="script"><link rel="preload" href="/assets/js/1.02cf7ae9.js" as="script"><link rel="preload" href="/assets/js/67.f4882da2.js" as="script"><link rel="prefetch" href="/assets/js/10.f5269c4e.js"><link rel="prefetch" href="/assets/js/100.c7e247ff.js"><link rel="prefetch" href="/assets/js/101.b60225bc.js"><link rel="prefetch" href="/assets/js/102.adacab9e.js"><link rel="prefetch" href="/assets/js/103.32cd0f3b.js"><link rel="prefetch" href="/assets/js/104.1fd9ea1d.js"><link rel="prefetch" href="/assets/js/105.5bfce959.js"><link rel="prefetch" href="/assets/js/106.44ca9c1d.js"><link rel="prefetch" href="/assets/js/107.9ee3fdbe.js"><link rel="prefetch" href="/assets/js/108.2e6ba386.js"><link rel="prefetch" href="/assets/js/109.12b4497c.js"><link rel="prefetch" href="/assets/js/11.9161989f.js"><link rel="prefetch" href="/assets/js/110.d255fdda.js"><link rel="prefetch" href="/assets/js/111.64c62930.js"><link rel="prefetch" href="/assets/js/112.6a427f04.js"><link rel="prefetch" href="/assets/js/113.5ec41ed5.js"><link rel="prefetch" href="/assets/js/114.d289af71.js"><link rel="prefetch" href="/assets/js/115.b052778b.js"><link rel="prefetch" href="/assets/js/116.f20d5acd.js"><link rel="prefetch" href="/assets/js/117.759b608c.js"><link rel="prefetch" href="/assets/js/118.a00460b4.js"><link rel="prefetch" href="/assets/js/119.021cbb12.js"><link rel="prefetch" href="/assets/js/12.e1aacb47.js"><link rel="prefetch" href="/assets/js/120.5bd8b71f.js"><link rel="prefetch" href="/assets/js/121.3e722ff2.js"><link rel="prefetch" href="/assets/js/122.a825e6c4.js"><link rel="prefetch" href="/assets/js/123.ff402ce6.js"><link rel="prefetch" href="/assets/js/124.287761b7.js"><link rel="prefetch" href="/assets/js/125.b4048370.js"><link rel="prefetch" href="/assets/js/126.bef086fd.js"><link rel="prefetch" href="/assets/js/127.a0784eab.js"><link rel="prefetch" href="/assets/js/128.66f3cbc1.js"><link rel="prefetch" href="/assets/js/129.aef33c57.js"><link rel="prefetch" href="/assets/js/13.faee7a70.js"><link rel="prefetch" href="/assets/js/130.0fbb1019.js"><link rel="prefetch" href="/assets/js/131.61f2146b.js"><link rel="prefetch" href="/assets/js/132.3d912bd8.js"><link rel="prefetch" href="/assets/js/133.b688ed34.js"><link rel="prefetch" href="/assets/js/134.59d26e48.js"><link rel="prefetch" href="/assets/js/135.2d1de6ca.js"><link rel="prefetch" href="/assets/js/136.82c509c1.js"><link rel="prefetch" href="/assets/js/137.aa6f5b18.js"><link rel="prefetch" href="/assets/js/138.8f50bb93.js"><link rel="prefetch" href="/assets/js/139.83f80acb.js"><link rel="prefetch" href="/assets/js/14.5e1b322f.js"><link rel="prefetch" href="/assets/js/140.255a8042.js"><link rel="prefetch" href="/assets/js/141.a7ad537d.js"><link rel="prefetch" href="/assets/js/142.b0c92d9c.js"><link rel="prefetch" href="/assets/js/143.f15b1f80.js"><link rel="prefetch" href="/assets/js/144.813a5a2e.js"><link rel="prefetch" href="/assets/js/145.b7069ddf.js"><link rel="prefetch" href="/assets/js/146.9fcc40e8.js"><link rel="prefetch" href="/assets/js/147.654c12e8.js"><link rel="prefetch" href="/assets/js/148.d2104b86.js"><link rel="prefetch" href="/assets/js/149.16115bff.js"><link rel="prefetch" href="/assets/js/15.c64a0296.js"><link rel="prefetch" href="/assets/js/150.e19d3aa4.js"><link rel="prefetch" href="/assets/js/151.e1e9732d.js"><link rel="prefetch" href="/assets/js/152.e4d9ed7c.js"><link rel="prefetch" href="/assets/js/153.720bddec.js"><link rel="prefetch" href="/assets/js/154.6d76f159.js"><link rel="prefetch" href="/assets/js/155.56639bb5.js"><link rel="prefetch" href="/assets/js/156.1b1456ad.js"><link rel="prefetch" href="/assets/js/157.41735b3f.js"><link rel="prefetch" href="/assets/js/158.2f7e2a71.js"><link rel="prefetch" href="/assets/js/159.8ecf5123.js"><link rel="prefetch" href="/assets/js/16.f13c1a4b.js"><link rel="prefetch" href="/assets/js/160.dd6f3d5e.js"><link rel="prefetch" href="/assets/js/161.ba4d9a7f.js"><link rel="prefetch" href="/assets/js/162.297aea0d.js"><link rel="prefetch" href="/assets/js/163.e34450b7.js"><link rel="prefetch" href="/assets/js/164.34381886.js"><link rel="prefetch" href="/assets/js/165.d4c2775d.js"><link rel="prefetch" href="/assets/js/166.c4c9cefb.js"><link rel="prefetch" href="/assets/js/167.d323a0a9.js"><link rel="prefetch" href="/assets/js/168.c20012b9.js"><link rel="prefetch" href="/assets/js/169.3cfddb83.js"><link rel="prefetch" href="/assets/js/17.e99ac461.js"><link rel="prefetch" href="/assets/js/170.3d3526f6.js"><link rel="prefetch" href="/assets/js/171.bba7cce9.js"><link rel="prefetch" href="/assets/js/172.8fbda3bd.js"><link rel="prefetch" href="/assets/js/173.1532f8d6.js"><link rel="prefetch" href="/assets/js/174.638e5e0a.js"><link rel="prefetch" href="/assets/js/175.d8d82e12.js"><link rel="prefetch" href="/assets/js/176.4b3a122c.js"><link rel="prefetch" href="/assets/js/177.3d9e6e89.js"><link rel="prefetch" href="/assets/js/178.58b1bf9b.js"><link rel="prefetch" href="/assets/js/179.3fc5f21a.js"><link rel="prefetch" href="/assets/js/18.2df0d7da.js"><link rel="prefetch" href="/assets/js/180.436cb2b1.js"><link rel="prefetch" href="/assets/js/181.dadcbdd8.js"><link rel="prefetch" href="/assets/js/182.d7f00bd5.js"><link rel="prefetch" href="/assets/js/183.b6a49ebe.js"><link rel="prefetch" href="/assets/js/184.72f1e1df.js"><link rel="prefetch" href="/assets/js/185.a30e0b04.js"><link rel="prefetch" href="/assets/js/186.a89aa666.js"><link rel="prefetch" href="/assets/js/187.c7601a79.js"><link rel="prefetch" href="/assets/js/188.47d25cdd.js"><link rel="prefetch" href="/assets/js/189.a5220877.js"><link rel="prefetch" href="/assets/js/19.74c2fe85.js"><link rel="prefetch" href="/assets/js/190.7fea63c8.js"><link rel="prefetch" href="/assets/js/191.79188b69.js"><link rel="prefetch" href="/assets/js/192.91858bc5.js"><link rel="prefetch" href="/assets/js/193.f8c9dc11.js"><link rel="prefetch" href="/assets/js/194.db5d514f.js"><link rel="prefetch" href="/assets/js/195.a21dfa21.js"><link rel="prefetch" href="/assets/js/196.3deca662.js"><link rel="prefetch" href="/assets/js/197.a26c6a57.js"><link rel="prefetch" href="/assets/js/198.199de2a9.js"><link rel="prefetch" href="/assets/js/199.3a93f5fd.js"><link rel="prefetch" href="/assets/js/20.37ef7b5a.js"><link rel="prefetch" href="/assets/js/200.2e0ca284.js"><link rel="prefetch" href="/assets/js/201.43159287.js"><link rel="prefetch" href="/assets/js/202.47ac18b9.js"><link rel="prefetch" href="/assets/js/21.8edf360c.js"><link rel="prefetch" href="/assets/js/22.681f9ff8.js"><link rel="prefetch" href="/assets/js/23.102f38f3.js"><link rel="prefetch" href="/assets/js/24.0d068097.js"><link rel="prefetch" href="/assets/js/25.b8c6fba0.js"><link rel="prefetch" href="/assets/js/26.b76fcccf.js"><link rel="prefetch" href="/assets/js/27.b95d8356.js"><link rel="prefetch" href="/assets/js/28.425d53a0.js"><link rel="prefetch" href="/assets/js/29.49ae4d56.js"><link rel="prefetch" href="/assets/js/30.268326de.js"><link rel="prefetch" href="/assets/js/31.d1322ccd.js"><link rel="prefetch" href="/assets/js/32.6baff7b9.js"><link rel="prefetch" href="/assets/js/33.91599495.js"><link rel="prefetch" href="/assets/js/34.7d1e8694.js"><link rel="prefetch" href="/assets/js/35.a28b2867.js"><link rel="prefetch" href="/assets/js/36.926c21b7.js"><link rel="prefetch" href="/assets/js/37.00738964.js"><link rel="prefetch" href="/assets/js/38.c07a024e.js"><link rel="prefetch" href="/assets/js/39.23ab4214.js"><link rel="prefetch" href="/assets/js/4.79366a86.js"><link rel="prefetch" href="/assets/js/40.47c89362.js"><link rel="prefetch" href="/assets/js/41.0e9b77b3.js"><link rel="prefetch" href="/assets/js/42.e93c36a9.js"><link rel="prefetch" href="/assets/js/43.8e4bef73.js"><link rel="prefetch" href="/assets/js/44.f5808021.js"><link rel="prefetch" href="/assets/js/45.3afe2dae.js"><link rel="prefetch" href="/assets/js/46.f597a77f.js"><link rel="prefetch" href="/assets/js/47.11f2d487.js"><link rel="prefetch" href="/assets/js/48.7fef6ef8.js"><link rel="prefetch" href="/assets/js/49.b2d21efe.js"><link rel="prefetch" href="/assets/js/5.9ee91412.js"><link rel="prefetch" href="/assets/js/50.5832583c.js"><link rel="prefetch" href="/assets/js/51.54c00e7a.js"><link rel="prefetch" href="/assets/js/52.bd5535f0.js"><link rel="prefetch" href="/assets/js/53.0d38f84a.js"><link rel="prefetch" href="/assets/js/54.65144b95.js"><link rel="prefetch" href="/assets/js/55.368817a9.js"><link rel="prefetch" href="/assets/js/56.04e15523.js"><link rel="prefetch" href="/assets/js/57.b41a7dc6.js"><link rel="prefetch" href="/assets/js/58.0f0d92dd.js"><link rel="prefetch" href="/assets/js/59.e7dddc9e.js"><link rel="prefetch" href="/assets/js/6.b921ef33.js"><link rel="prefetch" href="/assets/js/60.4038bd0b.js"><link rel="prefetch" href="/assets/js/61.5d51e956.js"><link rel="prefetch" href="/assets/js/62.786b095c.js"><link rel="prefetch" href="/assets/js/63.9da19a49.js"><link rel="prefetch" href="/assets/js/64.48f50f07.js"><link rel="prefetch" href="/assets/js/65.0fd7ee4a.js"><link rel="prefetch" href="/assets/js/66.5d68a363.js"><link rel="prefetch" href="/assets/js/68.224daefc.js"><link rel="prefetch" href="/assets/js/69.420801b1.js"><link rel="prefetch" href="/assets/js/7.e128bbee.js"><link rel="prefetch" href="/assets/js/70.1e62f96f.js"><link rel="prefetch" href="/assets/js/71.62f9fa7c.js"><link rel="prefetch" href="/assets/js/72.ad20df74.js"><link rel="prefetch" href="/assets/js/73.e16fef7c.js"><link rel="prefetch" href="/assets/js/74.c1f72d12.js"><link rel="prefetch" href="/assets/js/75.e1f28980.js"><link rel="prefetch" href="/assets/js/76.2c304c87.js"><link rel="prefetch" href="/assets/js/77.7265d1f0.js"><link rel="prefetch" href="/assets/js/78.c7c2fdd3.js"><link rel="prefetch" href="/assets/js/79.0be55b5d.js"><link rel="prefetch" href="/assets/js/8.b17d0b27.js"><link rel="prefetch" href="/assets/js/80.3c460019.js"><link rel="prefetch" href="/assets/js/81.972b58cd.js"><link rel="prefetch" href="/assets/js/82.6c4d50e0.js"><link rel="prefetch" href="/assets/js/83.89ff3b39.js"><link rel="prefetch" href="/assets/js/84.5629cfb0.js"><link rel="prefetch" href="/assets/js/85.78a9bc3f.js"><link rel="prefetch" href="/assets/js/86.b429e7fb.js"><link rel="prefetch" href="/assets/js/87.5c3ba926.js"><link rel="prefetch" href="/assets/js/88.52737753.js"><link rel="prefetch" href="/assets/js/89.696bb63f.js"><link rel="prefetch" href="/assets/js/9.0874a43d.js"><link rel="prefetch" href="/assets/js/90.60296dbe.js"><link rel="prefetch" href="/assets/js/91.2d2fd4df.js"><link rel="prefetch" href="/assets/js/92.d860f080.js"><link rel="prefetch" href="/assets/js/93.b341ebd9.js"><link rel="prefetch" href="/assets/js/94.ebd37258.js"><link rel="prefetch" href="/assets/js/95.15dbfc06.js"><link rel="prefetch" href="/assets/js/96.041d049b.js"><link rel="prefetch" href="/assets/js/97.e22ed305.js"><link rel="prefetch" href="/assets/js/98.2e23ad42.js"><link rel="prefetch" href="/assets/js/99.e886cd85.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d4a3a82a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar shadow"><div class="con-btns-header"><a href="/" class="home-link router-link-active"><div class="con-logo"><!----> <span class="site-name">Fellow Travellers</span></div></a> <div class="links"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link" data-v-e7cf42d2>主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">三维</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-tech3d/start/" class="nav-link" data-v-e7cf42d2>入门手册</a></li><li class="dropdown-item"><!----> <a href="/doc-tech3d/language/Micro-frontend_Start.html" class="nav-link" data-v-e7cf42d2>开发语言</a></li><li class="dropdown-item"><!----> <a href="/doc-tech3d/production/" class="nav-link" data-v-e7cf42d2>产品</a></li><li class="dropdown-item"><!----> <a href="/doc-tech3d/codelab/Principle_of_Visualizatio_for_WebGL.html" class="nav-link" data-v-e7cf42d2>专题</a></li><li class="dropdown-item"><!----> <a href="/doc-tech3d/other/SuperMap_Questions_and_Answer.html" class="nav-link" data-v-e7cf42d2>其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-frontend/start/" class="nav-link" data-v-e7cf42d2>入门手册</a></li><li class="dropdown-item"><!----> <a href="/doc-frontend/base/EC_ScopChain_Closure.html" class="nav-link" data-v-e7cf42d2>开发基础</a></li><li class="dropdown-item"><!----> <a href="/doc-frontend/web-gis/" class="nav-link" data-v-e7cf42d2>WebGIS开发</a></li><li class="dropdown-item"><!----> <a href="/doc-frontend/solution/" class="nav-link" data-v-e7cf42d2>解决方案</a></li><li class="dropdown-item"><!----> <a href="/doc-frontend/best-practice/" class="nav-link" data-v-e7cf42d2>最佳实践</a></li><li class="dropdown-item"><!----> <a href="/doc-frontend/arithmetic/QuickSort.html" class="nav-link" data-v-e7cf42d2>算法</a></li><li class="dropdown-item"><!----> <a href="/doc-tech3d/other/" class="nav-link" data-v-e7cf42d2>其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">移动</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-mobile/start/" class="nav-link" data-v-e7cf42d2>入门手册</a></li><li class="dropdown-item"><!----> <a href="/doc-mobile/dataResource/sourceCodeLib.html" class="nav-link" data-v-e7cf42d2>数据资源</a></li><li class="dropdown-item"><!----> <a href="/doc-mobile/product/nativeApp.html" class="nav-link" data-v-e7cf42d2>产品分型</a></li><li class="dropdown-item"><!----> <a href="/doc-mobile/appStore/" class="nav-link" data-v-e7cf42d2>应用商店</a></li><li class="dropdown-item"><!----> <a href="/doc-mobile/other/designDocument.html" class="nav-link" data-v-e7cf42d2>其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">计算</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-calc3d/start/XinShouShouCe.html" class="nav-link" data-v-e7cf42d2>入门手册</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/gis/Base_ZBX_ZongJie.html" class="nav-link" data-v-e7cf42d2>GIS</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/database/Oracle_LostSysPassword.html" class="nav-link" data-v-e7cf42d2>数据库</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/language/" class="nav-link" data-v-e7cf42d2>开发语言</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/codelab/" class="nav-link" data-v-e7cf42d2>源码库</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/production/DDP_ArcGIS_BuShuShouCe.html" class="nav-link" data-v-e7cf42d2>产品</a></li><li class="dropdown-item"><!----> <a href="/doc-calc3d/other/" class="nav-link" data-v-e7cf42d2>其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">后台</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-backend/start/" class="nav-link" data-v-e7cf42d2>入门手册</a></li><li class="dropdown-item"><!----> <a href="/doc-backend/database/Mongoazyx.html" class="nav-link" data-v-e7cf42d2>数据库</a></li><li class="dropdown-item"><!----> <a href="/doc-backend/framework/Git.html" class="nav-link" data-v-e7cf42d2>开发基础</a></li><li class="dropdown-item"><!----> <a href="/doc-backend/production/" class="nav-link" data-v-e7cf42d2>产品</a></li><li class="dropdown-item"><!----> <a href="/doc-backend/other/" class="nav-link" data-v-e7cf42d2>其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">基础研发</span></a> <ul class="nav-dropdown"><li class="dropdown-item"><!----> <a href="/doc-base/dist-utils/API.html" class="nav-link" data-v-e7cf42d2>dist-utils</a></li><li class="dropdown-item"><!----> <a href="http://192.168.200.39:18088/EyeMapAPI/" target="_blank" rel="noopener noreferrer" class="nav-link" data-v-e7cf42d2>eyemap业务库</a></li><li class="dropdown-item"><!----> <a href="/doc-base/stylelint-config/" class="nav-link" data-v-e7cf42d2>stylelint-config</a></li></ul></div></div><div class="nav-item"><a href="/doc-share/SuperMap_Pipe3DStrategy.html" class="nav-link" data-v-e7cf42d2>分享</a></div><div class="nav-item"><a href="https://fellowtravellers.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link" data-v-e7cf42d2>社区</a></div><div class="nav-item"><a href="/doc-help/mdRule.html" class="nav-link" data-v-e7cf42d2>帮助</a></div></nav></div></div> <div class="con-redes-download"><a title="GitLab" href="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335/" target="_blank" rel="noopener noreferrer" class="repo-link flaticon-github"></a></div></header> <div class="sidebar-map"><div class="c-sidebar-map"><ul class="sidebar-links-map"><li><div class="sidebar-group first"><ul class="sidebar-group-items"><li><a href="/doc-calc3d/database/Oracle_LostSysPassword.html" class="sidebar-link siderbar-map-item">忘记oracle的sys用户密码怎么修改</a></li></ul></div></li><li><div class="sidebar-group"><ul class="sidebar-group-items"><li><a href="/doc-calc3d/database/PostgreSQL_PostgreSQLAndPostGIS.html" class="sidebar-link siderbar-map-item">数据库计算应用-PostgreSQL,PostGIS</a></li></ul></div></li><li><div class="sidebar-group"><ul class="sidebar-group-items"><li><a href="/doc-calc3d/database/PostGIS_01_JieShao.html" class="sidebar-link siderbar-map-item">PostGIS教程——PostGis介绍</a></li><li><a href="/doc-calc3d/database/PostGIS_02_Install.html" class="sidebar-link siderbar-map-item">PostGIS教程二：PostGIS的安装</a></li><li><a href="/doc-calc3d/database/PostGIS_03_Database.html" class="sidebar-link siderbar-map-item">PostGIS教程三：创建空间数据库</a></li><li><a href="/doc-calc3d/database/PostGIS_04_Function.html" class="sidebar-link siderbar-map-item">PostGIS 常用函数</a></li><li><a href="/doc-calc3d/database/PostGis_05_Geometry.html" class="sidebar-link siderbar-map-item">PostGIS教程七：几何图形（Geometry）</a></li></ul></div></li><li><div class="sidebar-group"><ul class="sidebar-group-items"><li><a href="/doc-calc3d/database/Mongo_01_Install.html" class="sidebar-link siderbar-map-item">Mongo 安装运行（linux,windows,docker）</a></li><li><a href="/doc-calc3d/database/Mongo_02_Base.html" class="sidebar-link siderbar-map-item">db.getCollection('dds_region').find({ &quot;attrs.attrs.qymc&quot;: &quot;全国&quot;})MongoDB 基础</a></li><li><a href="/doc-calc3d/database/Mongo_03_Safe.html" class="sidebar-link siderbar-map-item">数据库安全</a></li><li><a href="/doc-calc3d/database/Mongo_04_Safe.html" class="sidebar-link siderbar-map-item">windows 版 mongo 启动安全认证</a></li><li><a href="/doc-calc3d/database/Mongo_05_Import.html" class="sidebar-link siderbar-map-item">数据导入导出工具</a></li><li><a href="/doc-calc3d/database/Mongo_06_Storage.html" aria-current="page" class="active sidebar-link siderbar-map-item">Mongo 存储文件—GridFS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc-calc3d/database/Mongo_06_Storage.html#简介" class="sidebar-link siderbar-map-item">简介</a></li><li class="sidebar-sub-header"><a href="/doc-calc3d/database/Mongo_06_Storage.html#什么时候使用-gridfs" class="sidebar-link siderbar-map-item">什么时候使用 GridFS</a></li><li class="sidebar-sub-header"><a href="/doc-calc3d/database/Mongo_06_Storage.html#gridfs-怎样存文件" class="sidebar-link siderbar-map-item">GridFS 怎样存文件</a></li><li class="sidebar-sub-header"><a href="/doc-calc3d/database/Mongo_06_Storage.html#如何使用-gridfs" class="sidebar-link siderbar-map-item">如何使用 GridFS</a></li><li class="sidebar-sub-header"><a href="/doc-calc3d/database/Mongo_06_Storage.html#注意事项" class="sidebar-link siderbar-map-item">注意事项</a></li></ul></li></ul></div></li></ul> </div></div> <div class="sidebar"><div class="c-sidebar"> <div class="search-box"><input aria-label="Search" placeholder="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Oracle</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/doc-calc3d/database/Oracle_LostSysPassword.html" class="sidebar-link">忘记oracle的sys用户密码怎么修改</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>PostgreSQL</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/doc-calc3d/database/PostgreSQL_PostgreSQLAndPostGIS.html" class="sidebar-link">数据库计算应用-PostgreSQL,PostGIS</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>PostGIS</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/doc-calc3d/database/PostGIS_01_JieShao.html" class="sidebar-link">PostGIS教程——PostGis介绍</a></li><li><a href="/doc-calc3d/database/PostGIS_02_Install.html" class="sidebar-link">PostGIS教程二：PostGIS的安装</a></li><li><a href="/doc-calc3d/database/PostGIS_03_Database.html" class="sidebar-link">PostGIS教程三：创建空间数据库</a></li><li><a href="/doc-calc3d/database/PostGIS_04_Function.html" class="sidebar-link">PostGIS 常用函数</a></li><li><a href="/doc-calc3d/database/PostGis_05_Geometry.html" class="sidebar-link">PostGIS教程七：几何图形（Geometry）</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>MongoDB</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/doc-calc3d/database/Mongo_01_Install.html" class="sidebar-link">Mongo 安装运行（linux,windows,docker）</a></li><li><a href="/doc-calc3d/database/Mongo_02_Base.html" class="sidebar-link">db.getCollection('dds_region').find({ &quot;attrs.attrs.qymc&quot;: &quot;全国&quot;})MongoDB 基础</a></li><li><a href="/doc-calc3d/database/Mongo_03_Safe.html" class="sidebar-link">数据库安全</a></li><li><a href="/doc-calc3d/database/Mongo_04_Safe.html" class="sidebar-link">windows 版 mongo 启动安全认证</a></li><li><a href="/doc-calc3d/database/Mongo_05_Import.html" class="sidebar-link">数据导入导出工具</a></li><li><a href="/doc-calc3d/database/Mongo_06_Storage.html" aria-current="page" class="active sidebar-link">Mongo 存储文件—GridFS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc-calc3d/database/Mongo_06_Storage.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/doc-calc3d/database/Mongo_06_Storage.html#什么时候使用-gridfs" class="sidebar-link">什么时候使用 GridFS</a></li><li class="sidebar-sub-header"><a href="/doc-calc3d/database/Mongo_06_Storage.html#gridfs-怎样存文件" class="sidebar-link">GridFS 怎样存文件</a></li><li class="sidebar-sub-header"><a href="/doc-calc3d/database/Mongo_06_Storage.html#如何使用-gridfs" class="sidebar-link">如何使用 GridFS</a></li><li class="sidebar-sub-header"><a href="/doc-calc3d/database/Mongo_06_Storage.html#注意事项" class="sidebar-link">注意事项</a></li></ul></li></ul></div></li></ul> </div></div> <!----> <!----> <div class="page"><div class="content-pagex content content__default"><h1 id="mongo-存储文件-gridfs"><a href="#mongo-存储文件-gridfs" class="header-anchor">#</a> Mongo 存储文件—GridFS</h1> <h2 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h2> <ul><li><p>GridFS 是用于存储和检索超过 BSON -文档大小限制为 16 MB 的文件的规范。</p> <ul><li>文件都小于 16 MB 限制，可以将文件存入单个文档中，不使用 GridFS 进行存储</li></ul></li> <li><p>在 MongoDB4.0 版本之前只支持单文档事务操作，在 4.0 版本之后开始支持多文档事务操作，但是 GridFS 不支持多文档事务。</p> <ul><li>执行要么全部成功，要么全部失败来保证数据完整性。</li> <li>如果需要以原子方式更新整个文件的内容，作为替代方案，您可以存储每个文件的多个版本，并在元数据中指定文件的当前版本。您可以在上载新版本的文件后更新在原子更新中指示“最新”状态的元数据字段，并在以后删除以前版本（如果需要）。</li></ul></li> <li><p>GridFS 不是将文件存储在单个文档中，而是将文件分成多个部分或块[<a href="https://docs.mongodb.com/manual/core/gridfs/#chunk-disambiguation" target="_blank" rel="noopener noreferrer">1]<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，并将每个块存储为单独的文档。</p> <ul><li>当您查询 GridFS 文件时，驱动程序将根据需要重新组装块。您可以对通过 GridFS 存储的文件执行范围查询。您还可以从文件的任意部分访问信息，例如“跳过”到视频或音频文件的中间。</li> <li>从大型文件的各个部分访问信息而无需将整个文件加载到内存中，可以使用 GridFS 调用文件的各个部分，而无需将整个文件读入内存。</li></ul></li> <li><p>默认情况下，GridFS 使用默认的块大小 255 kB; 也就是说，GridFS 将文件分成 255 kB 的块，但最后一个块除外。最后一个块只有必要的大小。类似地，不大于块大小的文件只有最终块。</p></li> <li><p>GridFS 使用两个集合来存储文件。一个集合存储文件块，另一个存储文件元数据。</p></li></ul> <h2 id="什么时候使用-gridfs"><a href="#什么时候使用-gridfs" class="header-anchor">#</a> 什么时候使用 GridFS</h2> <ul><li>在 MongoDB 中，使用 GridFS 存储大于 16 MB 的文件。</li> <li>在某些情况下，在 MongoDB 数据库中存储大文件可能比在系统级文件系统上更高效。
<ul><li>如果文件系统限制目录中的文件数，则可以使用 GridFS 根据需要存储任意数量的文件。</li> <li>大文件访问部分信息时更加高效</li> <li>如果要保持文件和元数据在多个系统和设施中自动同步和部署，可以使用 GridFS。MongoDB 可以自动将文件及其元数据分发到多个 <code>mongod</code>实例和工具中。</li></ul></li></ul> <blockquote><p>不支持原子方式更新整个文件的内容</p></blockquote> <h2 id="gridfs-怎样存文件"><a href="#gridfs-怎样存文件" class="header-anchor">#</a> GridFS 怎样存文件</h2> <h3 id="文件结构"><a href="#文件结构" class="header-anchor">#</a> 文件结构</h3> <p><img src="https://i.loli.net/2019/08/23/gJaABzWuofCmtPv.png" alt="mongoFile"></p> <ul><li>GridFS 将文件存储在两个集合中
<ul><li><code>chunks</code>存储二进制块</li> <li><code>files</code>存储文件的元数据</li></ul></li> <li>GridFS 通过在每个集合前面加上桶名(bucket name)，将集合放在一个公共桶(common bucket)中。默认情况下，GridFS 使用两个集合和一个名为 fs 的桶
<ul><li>fs.files 对应生成一个文档。</li> <li>fs.chunk 对应生成多个文档。</li></ul></li> <li>读文件时，先根据查询条件在 files 集合中找到对应的文档，同时得到“_id”字段，再根据“_id”在 chunks 集合中查询所有“files_id”等于“_id”的文档。最后根据“n”字段顺序读取 chunk 的“data”字段数据，还原文件。</li></ul> <h3 id="chunks-collection"><a href="#chunks-collection" class="header-anchor">#</a> chunks Collection</h3> <p>chunks 集合中的每个文档代表 GridFS 中表示的文件的不同块。此集合中的文档具有以下形式：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> &lt;ObjectId&gt;<span class="token punctuation">,</span>    <span class="token comment">// 文档ID，唯一标识</span>
  <span class="token property">&quot;files_id&quot;</span><span class="token operator">:</span> &lt;ObjectId&gt;<span class="token punctuation">,</span>    <span class="token comment">// 对应fs.files文档的ID</span>
  <span class="token property">&quot;n&quot;</span><span class="token operator">:</span> &lt;num&gt;<span class="token punctuation">,</span>           <span class="token comment">// 序号，标识文件的第几个 chunk</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> &lt;binary&gt;      <span class="token comment">// 文件二级制数据</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="files-collection"><a href="#files-collection" class="header-anchor">#</a> files Collection</h3> <p><code>files</code>集合中的每个文档都代表 GridFS 中的一个文件 。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> &lt;ObjectId&gt;<span class="token punctuation">,</span>    <span class="token comment">// 文档ID，唯一标识</span>
  <span class="token property">&quot;chunkSize&quot;</span><span class="token operator">:</span> &lt;num&gt;<span class="token punctuation">,</span>   <span class="token comment">// chunk大小 256kb</span>
  <span class="token property">&quot;uploadDate&quot;</span><span class="token operator">:</span> &lt;timetamp&gt;<span class="token punctuation">,</span> <span class="token comment">//文件上传时间</span>
  <span class="token property">&quot;length&quot;</span><span class="token operator">:</span> &lt;num&gt;<span class="token punctuation">,</span>      <span class="token comment">// 文件长度</span>
  <span class="token property">&quot;md5&quot;</span><span class="token operator">:</span> &lt;string&gt;<span class="token punctuation">,</span>      <span class="token comment">// 文件md5值</span>
  <span class="token property">&quot;filename&quot;</span><span class="token operator">:</span> &lt;string&gt;<span class="token punctuation">,</span> <span class="token comment">// 文件名</span>
  <span class="token property">&quot;contentType&quot;</span><span class="token operator">:</span> &lt;string&gt;<span class="token punctuation">,</span><span class="token comment">// 文件的MIME类型</span>
  <span class="token property">&quot;metadata&quot;</span><span class="token operator">:</span> &lt;dataObject&gt;<span class="token comment">// 文件自定义信息</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>GridFS 使用每个<code>chunks</code>和<code>files</code>集合上的索引来提高效率。符合 GridFS 规范的驱动程序会<strong>自动创建</strong>这些索引以方便使用。
<ul><li>fs.files 集合使用是“filename”与“uploadDate” 字段作为唯一、复合索引。</li> <li>fs.chunk 集合使用的是“files_id”与“n”字段作为唯一、复合索引。</li></ul></li></ul> <h2 id="如何使用-gridfs"><a href="#如何使用-gridfs" class="header-anchor">#</a> 如何使用 GridFS</h2> <h3 id="mongo-files-命令行工具"><a href="#mongo-files-命令行工具" class="header-anchor">#</a> mongo files 命令行工具</h3> <ul><li><code>mongofiles</code>实用程序可以从命令行操作 GridFS 对象中存储在 MongoDB 实例中的文件</li> <li>从系统命令行运行，而不是 mongoshell 中</li></ul> <h4 id="结构"><a href="#结构" class="header-anchor">#</a> 结构</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mongofiles <span class="token operator">&lt;</span>options<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>commands<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>filename<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="所需条件"><a href="#所需条件" class="header-anchor">#</a> 所需条件</h4> <ul><li><p>要使用该选项连接到<code>mongod</code>强制授权<code>--auth</code>，<strong>您必须使用</strong> <code>--username</code>和<code>--password</code>选项。连接用户必须至少拥有：</p> <ul><li>在<code>read</code>使用时，为访问数据库角色 <code>list</code>，<code>search</code>或<code>get</code>命令，</li> <li><code>readWrite</code>使用<code>put</code>或<code>delete</code>命令时访问的数据库的角色。</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code> mongofiles -u <span class="token string">&quot;writeUser&quot;</span> -p <span class="token string">&quot;passwd&quot;</span> --authenticationDatabase admin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h4 id="常用-commands"><a href="#常用-commands" class="header-anchor">#</a> 常用 commands</h4> <ul><li><p><code>list &lt;prefix&gt;</code></p> <p>列出 GridFS 存储中的文件。<code>list</code>（例如<code>&lt;prefix&gt;</code>）之后指定的字符 可选地将返回项的列表限制为以该字符串开头的文件。</p></li> <li><p><code>search &lt;string&gt;</code></p> <p>列出 GridFS 存储中的文件，其名称与任何部分匹配<code>&lt;string&gt;</code>。</p></li> <li><p><code>put &lt;filename&gt;</code></p> <p>将指定文件从本地文件系统复制到 GridFS 存储中。这里，<code>&lt;filename&gt;</code>指的是对象在 GridFS 中的名称，并<code>mongofiles</code>假设它反映了文件在本地文件系统上的名称。如果本地文件名不同，请使用该选项。<code>mongofiles --local</code></p></li> <li><p><code>get &lt;filename&gt;</code></p> <p>将指定文件从 GridFS 存储复制到本地文件系统。这里，<code>&lt;filename&gt;</code>指的是对象在 GridFS 中的名称。<code>mongofiles</code>使用<code>filename</code>GridFS 中的文件将文件写入本地文件系统。要在本地文件系统上为文件选择其他位置，请使用该 <code>--local</code>选项。</p></li> <li><p><code>get_id &quot;&lt;_id&gt;&quot;</code></p> <p>*版本 3.2.0 中的新功能。*将其指定的文件<code>&lt;_id&gt;</code>从 GridFS 存储复制到本地文件系统。这里<code>&lt;_id&gt;</code>指的是<code>_id</code>GridFS 中对象的扩展 JSON ：从 MongoDB 4.2 开始，<code>get_id</code>可以接受 ObjectId 值或非 ObjectId 值<code>&lt;_id&gt;</code>。在 MongoDB 4.0 及更早版本中，<code>get_id</code>只接受<code>&lt;ObjectId&gt;</code>值。<code>mongofiles</code>使用<code>filename</code>GridFS 中的文件将文件写入本地文件系统。要在本地文件系统上为文件选择其他位置，请使用该 <code>--local</code>选项。</p></li> <li><p><code>delete &lt;filename&gt;</code></p> <p>从 GridFS 存储中删除指定的文件。</p></li> <li><p><code>delete_id &quot;&lt;_id&gt;&quot;</code></p> <p><em>版本 3.2.0 中的新功能。</em><code>&lt;_id&gt;</code>从 GridFS 存储中删除由其指定的文件：从 MongoDB 4.2 开始，<code>delete_id</code>可以接受 ObjectId 值或非 ObjectId 值<code>&lt;_id&gt;</code>。在 MongoDB 4.0 及更早版本中，<code>delete_id</code>只接受<code>&lt;ObjectId&gt;</code>值。</p></li></ul> <h4 id="常用-options"><a href="#常用-options" class="header-anchor">#</a> 常用 options</h4> <ul><li><p><strong>--host --port</strong></p> <ul><li>默认值为 localhost:27017</li></ul></li> <li><p><strong>--username <username>, -u <username> --password<code>与</code>--authenticationDatabase`</username></username></strong></p> <ul><li>指定用于向使用身份验证的 MongoDB 数据库进行身份验证的用户名。</li></ul></li> <li><p><code>--db`` &lt;database&gt;``, ``-d`` &lt;database&gt;</code></p></li> <li><p><strong>--uri</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>--uri <span class="token string">&quot;mongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[database][?options]]&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>以下命令行选项不能与<code>--uri</code>选项一起使用：</p> <ul><li><code>--host</code></li> <li><code>--port</code></li> <li><code>--db</code></li> <li><code>--username</code></li> <li><code>--password</code> （如果 URI 连接字符串也包含密码）</li> <li><code>--authenticationDatabase</code></li> <li><code>--authenticationMechanism</code></li></ul> <p>而是将这些选项指定为<code>--uri</code> 连接字符串的一部分。</p></li> <li><p><strong>--local<code>&lt;filename&gt;</code>, <code>-l</code> <filename></filename></strong></p> <p>指定 get 和 put 操作的文件的本地文件系统名称。</p> <p>在<strong>mongofiles put</strong>和<strong>mongofiles 获取</strong>命令中，必需的<code>&lt;filename&gt;</code>修饰符指的是对象在 GridFS 中的名称。<code>mongofiles</code>假设这反映了本地文件系统上的文件名。此设置将覆盖此默认值。</p></li></ul> <h4 id="举例"><a href="#举例" class="header-anchor">#</a> 举例</h4> <p>在系统的 shell 中运行命令</p> <ul><li><p>创建一个可读写的用户 writeUser</p></li> <li><p>上传文件 js-yaml.js 到数据库 files 中</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mongofiles -u <span class="token string">&quot;writeUser&quot;</span> -p <span class="token string">&quot;passwd&quot;</span> --authenticationDatabase admin -d files put js-yaml.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>返回信息</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">2019</span>-08-23T14:09:05.642+0000	connected to: mongodb://localhost/
<span class="token number">2019</span>-08-23T14:09:05.684+0000	added gridFile: js-yaml.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul> <blockquote><p>第二次上传相同文件到数据库中，GridFS 不会对其进行覆盖，会存储两个相同文件</p></blockquote> <ul><li><p>查看数据库 files 中的文件列表</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mongofiles -u <span class="token string">&quot;writeUser&quot;</span> -p <span class="token string">&quot;passwd&quot;</span> --authenticationDatabase admin -d files list
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>返回信息</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">2019</span>-08-23T14:17:46.973+0000	connected to: mongodb://localhost/
js-yaml.js	<span class="token number">108442</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul> <h3 id="mongodb-驱动程序-java-api"><a href="#mongodb-驱动程序-java-api" class="header-anchor">#</a> MongoDB 驱动程序(Java API)</h3> <ul><li>API 可以参考官方文档，源码相关</li></ul> <h4 id="项目实例"><a href="#项目实例" class="header-anchor">#</a> 项目实例</h4> <ul><li><p>SpringBoot 导入 mongo,web-start,io 模块（2.1.7.RELEASE）</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-mongodb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></li> <li><p>application.properties 中</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">spring.data.mongodb.uri</span><span class="token punctuation">=</span><span class="token attr-value">mongodb://192.168.191.156:27017/files</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <ul><li><p>在 springboot 启动类同级目录或者子目录下创建 GridFSApi.java</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>yufh<span class="token punctuation">.</span>springbootmongofiles</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>client<span class="token punctuation">.</span>gridfs<span class="token punctuation">.</span>model</span><span class="token punctuation">.</span><span class="token class-name">GridFSFile</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>bson<span class="token punctuation">.</span>types</span><span class="token punctuation">.</span><span class="token class-name">ObjectId</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>core<span class="token punctuation">.</span>query</span><span class="token punctuation">.</span><span class="token class-name">Criteria</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>core<span class="token punctuation">.</span>query</span><span class="token punctuation">.</span><span class="token class-name">Query</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>gridfs</span><span class="token punctuation">.</span><span class="token class-name">GridFsResource</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>gridfs</span><span class="token punctuation">.</span><span class="token class-name">GridFsTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Controller</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>


<span class="token comment">/**
 * @author yufh
 * @describe
 * @date 2019/8/23
 */</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GridFSApi</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">GridFsTemplate</span> gridFsTemplate<span class="token punctuation">;</span>

    <span class="token comment">//上传文件</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\1.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">ObjectId</span> id <span class="token operator">=</span> gridFsTemplate<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//下载文件</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">download</span><span class="token punctuation">(</span> <span class="token class-name">String</span> fileName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token class-name">Query</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;filename&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">GridFSFile</span>  mongoFile <span class="token operator">=</span> gridFsTemplate<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//gridfs下载在2.x以下版本为</span>

<span class="token comment">//        try {</span>
<span class="token comment">//            mongoFile.writeTo(&quot;D:\\a.txt&quot;);</span>
<span class="token comment">//        } catch (IOException e) {</span>
<span class="token comment">//            e.printStackTrace();</span>
<span class="token comment">//        }</span>

        <span class="token comment">//2.x以上版本。find的返回值进行了更改。</span>
        <span class="token class-name">GridFsResource</span> gs <span class="token operator">=</span> gridFsTemplate<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span>mongoFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">OutputStream</span> os <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> len<span class="token punctuation">;</span>
            <span class="token class-name">InputStream</span> in <span class="token operator">=</span> gs<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            os <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> gs<span class="token punctuation">.</span><span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bs<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                os<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bs<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalStateException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            os<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

	<span class="token comment">//删除文件</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span> <span class="token class-name">String</span> fileName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token class-name">Query</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;filename&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gridFsTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br></div></div></li> <li><p>test 测试类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringbootMongofilesApplicationTests</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Resource</span> <span class="token class-name">GridFSApi</span> gridFSApi<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">downloadFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		gridFSApi<span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span><span class="token string">&quot;a.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">uploadFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		gridFSApi<span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		gridFSApi<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&quot;1.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li></ul> <h2 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h2> <ul><li><p>GridFs 不会自动处理 md5 值相同的文件，也就是说，同一个文件进行两次 put 命令，将会在 GridFS 中对应两个不同的存储，对于存储来说，这是一种浪费。对于 md5 相同的文件，如果想要在 GridFS 中只有一个存储，需要通过 API 进行扩展处理。</p></li> <li><p>MongoDB 不会释放已经占用的硬盘空间。即使删除 db 中的集合 MongoDB 也不会释放磁盘空间。同样，如果使用 GridFS 存储文件，从 GridFS 存储中删除无用的垃圾文件，MongoDB 依然不会释放磁盘空间的。这会造成磁盘一直在消耗，而无法回收利用的问题。</p></li></ul> <h3 id="那么怎样才能释放磁盘空间呢？"><a href="#那么怎样才能释放磁盘空间呢？" class="header-anchor">#</a> 那么怎样才能释放磁盘空间呢？</h3> <ol><li>可以通过修复数据库来回收磁盘空间，即在 mongo shell 中运行 db.repairDatabase()命令或者 db.runCommand({ repairDatabase: 1 })命令。（此命令执行比较慢）。
使用通过修复数据库方法回收磁盘时需要注意，待修复磁盘的剩余空间必须大于等于存储数据集占用空间加上 2G，否则无法完成修复。因此使用 GridFS 大量存储文件必须提前考虑设计磁盘回收方案，以解决 mongoDB 磁盘回收问题。</li> <li>使用 dump &amp; restore 方式，即先删除 mongoDB 数据库中需要清除的数据，然后使用 mongodump 备份数据库。备份完成后，删除 MongoDB 的数据库，使用 Mongorestore 工具恢复备份数据到数据库。</li></ol> <p>当使用 db.repairDatabase()命令没有足够的磁盘剩余空间时，可以采用 dump &amp; restore 方式回收磁盘资源。如果 MongoDB 是副本集模式，dump &amp; restore 方式可以做到对外持续服务，在不影响 MongoDB 正常使用下回收磁盘资源。</p> <p>MogonDB 使用副本集， 实践使用 dump &amp; restore 方式，回收磁盘资源。70G 的数据在 2 小时之内完成数据清理及磁盘回收，并且整个过程不影响 MongoDB 对外服务，同时可以保证处理过程中数据库增量数据的完整。</p> <blockquote><p>参考链接：http://rdc.hundsun.com/portal/article/703.html</p></blockquote></div> <div class="content edit-link"><a href="http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335/edit/master/docs/doc-calc3d/database/Mongo_06_Storage.md" target="_blank" rel="noopener noreferrer">
      编辑此页面
    </a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="content page-nav"><p class="inner"><span class="prev"><a href="/doc-calc3d/database/Mongo_05_Import.html" class="prev">&lt; 数据导入导出工具</a></span> <!----></p></div> <div class="footer">数据中心 研发二部</div></div></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.16cdc938.js" defer></script><script src="/assets/js/3.4f14b16d.js" defer></script><script src="/assets/js/1.02cf7ae9.js" defer></script><script src="/assets/js/67.f4882da2.js" defer></script>
  </body>
</html>
